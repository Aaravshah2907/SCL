<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage">
<head>
<meta xmlns="http://www.w3.org/1999/xhtml" charset="utf-8">
<meta xmlns="http://www.w3.org/1999/xhtml" name="viewport" content="width=device-width, initial-scale=1.0">
<meta xmlns="http://www.w3.org/1999/xhtml" http-equiv="X-UA-Compatible" content="IE=edge">
<title>Acoustics-Based Machine Fault Recognition Code Generation on Raspberry Pi</title>
<script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
      {
      "@context": "http://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement":
      [{
          "@type": "ListItem",
          "position": 1,

          "item": {
          "@id": "../index.html",
          "name": "MATLAB"
}

          } 
        ,
        {
          "@type": "ListItem",
          "position": 2,

          "item": {
          "@id": "../data-import-and-analysis.html",
          "name": "Data Import and Analysis"
}

          }
        ,
        {
          "@type": "ListItem",
          "position": 3,

          "item": {
          "@id": "../data-import-and-export.html",
          "name": "Data Import and Export"
}

          }
        ,
        {
          "@type": "ListItem",
          "position": 4,

          "item": {
          "@id": "../hardware-network-comm.html",
          "name": "Hardware and Network Communication"
}

          }
        ,
        {
          "@type": "ListItem",
          "position": 5,

          "item": {
          "@id": "../hardware-boards-and-kits.html",
          "name": "Hardware Boards and Kits"
}

          }
        ,
        {
          "@type": "ListItem",
          "position": 6,

          "item": {
          "@id": "../raspberrypiio.html",
          "name": "Raspberry Pi Hardware"
}

          }
        ,
        {
          "@type": "ListItem",
          "position": 7,

          "item": {
          "@id": "../raspberrypiio-run-on-hardware.html",
          "name": "Run on Target Hardware"
}

          }]
      }</script><script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "ItemList",
          "name": "VisibleBreadcrumbs",

        "itemListElement":
        [
        "raspberrypiio-run-on-hardware"
        ],
        "itemListOrder": "http://schema.org/ItemListOrderAscending"
        }
        </script><script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "DigitalDocument",
          "headline": "Acoustics-Based Machine Fault Recognition Code Generation on Raspberry Pi",
          "description": "Demonstrates code generation for acoustics-based machine fault recognition using a long short-term memory (LSTM) network and spectral descriptors. This example uses MATLAB&#174; Coder&#8482;, MATLAB Coder Interface for Deep Learning, MATLAB Support Package for Raspberry Pi&#8482; Hardware to generate a standalone executable (.elf) file on a Raspberry Pi that leverages performance of the ARM&#174; Compute Library. The input data consists of acoustics time-series recordings from faulty or healthy air compressors and the output is the state of the mechanical machine predicted by the LSTM network. This standalone executable on Raspberry Pi runs the streaming classifier on the input data received from MATLAB and sends the computed scores for each label to MATLAB. Interaction between MATLAB script and the executable on your Raspberry Pi is handled using the user datagram protocol (UDP). For more details on audio preprocessing and network training, see Acoustics-Based Machine Fault Recognition.",
          "thumbnailURL": "../../examples/deeplearning_shared/win64/MachineFaultRecognitionRaspi.png",
          "genre": "Live Script",
          "isBasedOn": {
          "@type": "Product",
          "name": "MATLAB"

        },
          "identifier": "deeplearning_shared.MachineFaultRecognitionCodeGenOnRaspiExample",
          "name": "MachineFaultRecognitionCodeGenOnRaspiExample",
          "url": "accoustic-based-machine-fault-recognition-code-generation-on-raspberry-p1.html"

        }</script><script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "PropertyValue",
          "name": "open_command",
          "value": "matlab:openExample('deeplearning_shared/MachineFaultRecognitionCodeGenOnRaspiExample')"

        }</script><script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "ItemList",
          "name": "ExampleSourceFiles",

        "itemListElement":
        [
        "MachineFaultRecognitionCodeGenOnRaspiExample.mlx",
        "MachineFaultRecognitionRaspi.png",
        "recognizeAirCompressorFaultRaspi.m",
        "recognizeAirCompressorFault.m"
        ],
        "itemListOrder": "http://schema.org/ItemListOrderAscending"
        }
        </script><link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/bootstrap.min.css" rel="stylesheet" type="text/css">


  <meta xmlns="http://www.w3.org/1999/xhtml" http-equiv="Content-Script-Type" content="text/javascript">
<meta xmlns="http://www.w3.org/1999/xhtml" name="toctype" itemprop="pagetype" content="ug">
<meta xmlns="http://www.w3.org/1999/xhtml" name="infotype" itemprop="infotype" content="other">

<meta xmlns="http://www.w3.org/1999/xhtml" name="description" itemprop="description" content="This example demonstrates code generation for acoustics-based machine fault recognition using a long short-term memory (LSTM) network and spectral descriptors."><meta xmlns="http://www.w3.org/1999/xhtml" content="../../examples/deeplearning_shared/win64/MachineFaultRecognitionRaspi.png" itemprop="thumbnailUrl">
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/jquery/jquery-3.6.0.min.js"></script><script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/jquery/jquery-migrate.min.js"></script>
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6.css" rel="stylesheet" type="text/css">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_lg.css" rel="stylesheet" media="screen and (min-width: 1200px)">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_md.css" rel="stylesheet" media="screen and (min-width: 992px) and (max-width: 1199px)">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_sm+xs.css" rel="stylesheet" media="screen and (max-width: 991px)">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_sm.css" rel="stylesheet" media="screen and (min-width: 768px) and (max-width: 991px)">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_xs.css" rel="stylesheet" media="screen and (max-width: 767px)">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_offcanvas_v2.css" rel="stylesheet" type="text/css">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/shared/highlight/styles/mwdochighlight.min.css" rel="stylesheet" type="text/css">

<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/l10n.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/docscripts.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/f1help.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/docscripts.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/mw.imageanimation.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/jquery.highlight.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/underscore-min.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/use_platform_screenshots.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/suggest.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/overload.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/helpservices.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/productfilter.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/matlab_dialog_shared.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/highlight/highlight.min.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/localstorage.js"></script><script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/product_group.js"></script><script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/saxonjs/SaxonJS2.rt.js"></script><script xmlns="http://www.w3.org/1999/xhtml">
            window.history.replaceState(window.location.href, null, ""); // Initialize
            window.onload = function() {    
            mystylesheetLocation = "../../includes/shared/scripts/product_group-sef.json";
            mysourceLocation = "../../docset/docset.xml";
            product_help_location = "matlab";
            pagetype = "section";
            doccentertype = "product";
            langcode = "";
            getProductFilteredList(mystylesheetLocation, mysourceLocation, product_help_location, pagetype, doccentertype, langcode);  
            }
          </script><script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/livecontrolpopover.js"></script>





<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/jquery/jquery.mobile.custom.min.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/bootstrap.bundle.min.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/global.js"></script>
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/doc_center_base.css" rel="stylesheet" type="text/css">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/doc_center_installed.css" rel="stylesheet" type="text/css">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/doc_center_print.css" rel="stylesheet" type="text/css" media="print">
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/equationrenderer/release/MathRenderer.js"></script>
</head>
<body id="responsive_offcanvas">
<div xmlns="http://www.w3.org/1999/xhtml" id="doc_header_spacer" class="header"></div>
<div xmlns="http://www.w3.org/1999/xhtml" class="section_header level_3"><div class="container-fluid"><div class="row" id="mobile_search_row"><div class="col-sm-6 col-md-7 has_horizontal_local_nav" id="section_header_title"><div class="section_header_content"><div class="section_header_title"><h1><a href="../../documentation-center.html">Help Center</a></h1></div></div></div><div class="col-12 col-sm-6 col-md-5" id="mobile_search"><div class="search_nested_content_container"><form id="docsearch_form" name="docsearch_form" method="get" data-release="R2025b" data-language="en" action="../../templates/searchresults.html"><div class="input-group tokenized_search_field"><label class="visually-hidden form-label">Search Help</label><input type="text" class="form-control conjoined_search" autocomplete="off" name="qdoc" placeholder="Search Help" id="docsearch"> <div><button type="submit" name="submitsearch" id="submitsearch" class="btn icon-search btn_search_adjacent btn_search icon_16" tabindex="-1"></button></div></div></form></div><button class="btn icon-remove btn_search float-end icon_32 d-sm-none" data-bs-toggle="collapse" href="#mobile_search" aria-expanded="false" aria-controls="mobile_search"></button></div><div class="d-sm-none" id="search_actuator"><button class="btn icon-search btn_search float-end icon_16" data-bs-toggle="collapse" href="#mobile_search" aria-expanded="false" aria-controls="mobile_search"></button></div></div></div></div><div class="row-offcanvas row-offcanvas-left">
<div xmlns="http://www.w3.org/1999/xhtml" class="sidebar-offcanvas" id="sidebar">
<nav class="offcanvas_nav" role="navigation">
<div class="offcanvas_actuator" data-bs-toggle="offcanvas" data-bs-target="#sidebar" id="nav_toggle"><button type="button" class="btn"><span class="visually-hidden">Off-Canvas Navigation Menu Toggle
                  Off-Canvas Navigation Menu Toggle</span><span class="icon-menu"></span></button><span class="offcanvas_actuator_label" id="translation_icon-menu" tabindex="-1" aria-hidden="true"></span></div><div class="nav_list_wrapper" id="nav_list_wrapper"><nav class="offcanvas_nav" role="navigation"><ul class="nav_breadcrumb" id="ul_left_nav_ancestors"><li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../../documentation-center.html?s_tid=CRUX_lftnav" itemprop="url"><span itemprop="title">Documentation Home</span></a></li></ul>
<ul class="nav_disambiguation"><li><a href="../index.html?s_tid=CRUX_lftnav" id="index">MATLAB</a>
</li>
<li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../data-import-and-analysis.html?s_tid=CRUX_lftnav" itemprop="url"><span itemprop="title">Data Import and Analysis</span></a></li><li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../data-import-and-export.html?s_tid=CRUX_lftnav" itemprop="url"><span itemprop="title">Data Import and Export</span></a></li><li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../hardware-network-comm.html?s_tid=CRUX_lftnav" itemprop="url"><span itemprop="title">Hardware and Network Communication</span></a></li><li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../hardware-boards-and-kits.html?s_tid=CRUX_lftnav" itemprop="url"><span itemprop="title">Hardware Boards and Kits</span></a></li><li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../raspberrypiio.html?s_tid=CRUX_lftnav" itemprop="url"><span itemprop="title">Raspberry Pi Hardware</span></a></li><li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../raspberrypiio-run-on-hardware.html?s_tid=CRUX_lftnav" itemprop="url" id="mw_8aa46fa2-1931-45fb-af48-20625a7eaffd"><span itemprop="title">Run on Target Hardware</span></a></li></ul><div class="search_refine_v4"><div id="facets_area"><ul class="nav_scrollspy nav list-unstyled" id="pnav">
<li class="nav_scrollspy_function nav-item"><a href="#responsive_offcanvas">Acoustics-Based Machine Fault Recognition Code Generation on Raspberry Pi</a></li>
<li class="nav_scrollspy_title nav-item" id="SSPY810-section">On this page</li>
<!--ADD_REFENTRY_TITLE_HERE 11--><li class="nav-item"><a href="#MachineFaultRecognitionCodeGenOnRaspiExample-1" class="nav-link intrnllnk">Example Requirements</a></li><li class="nav-item"><a href="#MachineFaultRecognitionCodeGenOnRaspiExample-2" class="nav-link intrnllnk">Prepare Input Dataset</a></li><li class="nav-item"><a href="#MachineFaultRecognitionCodeGenOnRaspiExample-3" class="nav-link intrnllnk">Recognize Machine Fault in MATLAB</a></li><li class="nav-item"><a href="#MachineFaultRecognitionCodeGenOnRaspiExample-4" class="nav-link intrnllnk">Prepare MATLAB Code For Deployment</a></li><li class="nav-item"><a href="#MachineFaultRecognitionCodeGenOnRaspiExample-5" class="nav-link intrnllnk">Generate Executable on Raspberry Pi</a></li><li class="nav-item"><a href="#MachineFaultRecognitionCodeGenOnRaspiExample-6" class="nav-link intrnllnk">Perform Machine Fault Recognition Using Deployed Code</a></li><li class="nav-item"><a href="#MachineFaultRecognitionCodeGenOnRaspiExample-7" class="nav-link intrnllnk">Evaluate Execution Time Using Alternative PIL Function Workflow</a></li><li class="nav-item"><a href="#MachineFaultRecognitionCodeGenOnRaspiExample-8" class="nav-link intrnllnk">References</a></li></ul></div></div>
</nav></div></nav>
<script src="../../includes/product/scripts/offcanvas_v2.js"></script></div><!--END.CLASS sidebar-offcanvas-->
<div class="offcanvas_content_container">
<div xmlns="http://www.w3.org/1999/xhtml" class="sticky_header_container"><div class="horizontal_nav"><div class="horizontal_nav_container"><div class="offcanvas_horizontal_nav"><div class="container-fluid"><div class="row"><div class="col-sm-12 d-none d-sm-block"><nav class="navbar navbar-default" role="navigation" id="subnav"><div><ul class="nav navbar-nav crux_browse"><li id="crux_nav_documentation" class="crux_resource active">Documentation</li><li id="crux_nav_example" class="crux_resource"><a href="../examples.html?category=raspberrypiio-run-on-hardware&amp;s_tid=CRUX_topnav">Examples</a></li><li id="crux_nav_function" class="crux_resource"><a href="../referencelist.html?type=function&amp;category=raspberrypiio-run-on-hardware&amp;s_tid=CRUX_topnav">Functions</a></li><li id="crux_nav_app" class="crux_resource"><a href="../referencelist.html?type=app&amp;category=raspberrypiio-run-on-hardware&amp;s_tid=CRUX_topnav">Apps</a></li></ul></div></nav></div><div class="d-sm-none"><div class="container-fluid"><div class="row"><div class="col-9"><div class="mobile_crux_nav_trigger"><div class="btn-group"><button type="button" class="btn btn-default dropdown-toggle" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Resources</button><ul class="dropdown-menu"><li id="crux_nav_mobile_documentation" class="crux_resource active">Documentation</li><li id="crux_nav_mobile_example" class="crux_resource"><a href="../examples.html?category=raspberrypiio-run-on-hardware&amp;s_tid=CRUX_topnav">Examples</a></li><li id="crux_nav_mobile_function" class="crux_resource"><a href="../referencelist.html?type=function&amp;category=raspberrypiio-run-on-hardware&amp;s_tid=CRUX_topnav">Functions</a></li><li id="crux_nav_mobile_app" class="crux_resource"><a href="../referencelist.html?type=app&amp;category=raspberrypiio-run-on-hardware&amp;s_tid=CRUX_topnav">Apps</a></li></ul></div></div></div><div class="col-3"><div class="translate_placeholder"></div></div></div></div></div></div></div></div></div></div></div><div class="content_container" id="content_container" itemprop="content">
<div class="container-fluid">
<div class="row">
<div class="col-12">

<main id="skip_link_anchor" tabindex="-1">
<div xmlns="http://www.w3.org/1999/xhtml" id="product_info_alert"></div><section xmlns="http://www.w3.org/1999/xhtml" id="doc_center_content" lang="en" data-language="en"><div id="pgtype-topic">
<section><h1 class="r2025b" itemprop="title content" id="mw_a819f900-03c8-46d1-844a-150178b53aac">Acoustics-Based Machine Fault Recognition Code Generation on Raspberry Pi</h1><div class="examples_short_list hidden_ios_android" data-products="ML AU NN ML_DEEPLEARNING_LIB RASPPIIO EC"><div data-pane="metadata" class="card metadata_container"><div class="card-body metadata_content"><p class="add_margin_5">This example uses:</p><ul class="list-unstyled add_border_bottom example_product_list" itemprop="requiredprods"><li><a href="matlab:matlab.internal.addons.showAddon('AU')">Audio Toolbox</a></li><li><a href="matlab:matlab.internal.addons.showAddon('NN')">Deep Learning Toolbox</a></li><li><a href="matlab:matlab.internal.addons.showAddon('ML_DEEPLEARNING_LIB')">MATLAB Coder Interface for Deep Learning</a></li><li><a href="matlab:matlab.internal.addons.showAddon('RASPPIIO')">MATLAB Support Package for Raspberry Pi Hardware</a></li><li><a href="matlab:matlab.internal.addons.showAddon('EC')">Embedded Coder</a></li></ul><div class="d-grid"><a class="btn btn_color_blue" href="matlab:openExample('deeplearning_shared/MachineFaultRecognitionCodeGenOnRaspiExample')" data-ex-genre="Live Script">Open Live Script</a></div></div></div></div><div itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage/Example" itemprop="example" class="em_example"><meta itemprop="exampleid" content="deeplearning_shared-MachineFaultRecognitionCodeGenOnRaspiExample"><meta itemprop="exampletitle" content="AcousticsBased Machine Fault Recognition Code Generation on Raspberry Pi"></div><span id="MachineFaultRecognitionCodeGenOnRaspiExample" class="anchor_target"></span><p class="shortdesc">This example demonstrates code generation for <a href="../../audio/ug/acoustics-based-machine-fault-recognition.html" data-docid="audio_ug#mw_bd8f63ae-1356-48ef-a2a0-1733ed2cb126" class="a">Acoustics-Based Machine Fault Recognition</a><span role="cross_prod"> (Audio Toolbox)</span> using a long short-term memory (LSTM) network and spectral descriptors. This example uses MATLAB&#174; Coder&#8482;, MATLAB Coder Interface for Deep Learning, MATLAB Support Package for Raspberry Pi&#8482; Hardware to generate a standalone executable (<code class="literal">.elf</code>) file on a Raspberry Pi that leverages performance of the ARM&#174; Compute Library. The input data consists of acoustics time-series recordings from faulty or healthy air compressors and the output is the state of the mechanical machine predicted by the LSTM network. This standalone executable on Raspberry Pi runs the streaming classifier on the input data received from MATLAB and sends the computed scores for each label to MATLAB. Interaction between MATLAB script and the executable on your Raspberry Pi is handled using the user datagram protocol (UDP). For more details on audio preprocessing and network training, see <a href="../../audio/ug/acoustics-based-machine-fault-recognition.html" data-docid="audio_ug#mw_bd8f63ae-1356-48ef-a2a0-1733ed2cb126" class="a">Acoustics-Based Machine Fault Recognition</a><span role="cross_prod"> (Audio Toolbox)</span>.</p><div class="procedure"><h3 class="title" id="MachineFaultRecognitionCodeGenOnRaspiExample-1">Example Requirements</h3><div class="itemizedlist"><ul><li><p>The MATLAB Coder Interface for Deep Learning Support Package</p></li><li><p>ARM processor that supports the NEON extension</p></li><li><p>ARM Compute Library version 20.02.1 (on the target ARM hardware)</p></li><li><p>Environment variables for the compilers and libraries</p></li></ul></div><p>For supported versions of libraries and for information about setting up environment variables, see <a href="../../coder/ug/prerequisites-for-deep-learning-with-matlab-coder.html" data-docid="coder_ug#mw_99a4acec-aced-453c-aadd-a18e83133574" class="a">Prerequisites for Deep Learning with MATLAB Coder</a><span role="cross_prod"> (MATLAB Coder)</span></p><h3 class="title" id="MachineFaultRecognitionCodeGenOnRaspiExample-2">Prepare Input Dataset</h3><p>Specify a sample rate <code class="literal">fs</code> of 16 kHz and a <code class="literal">windowLength</code> of 512 samples, as defined in <a href="../../audio/ug/acoustics-based-machine-fault-recognition.html" data-docid="audio_ug#mw_bd8f63ae-1356-48ef-a2a0-1733ed2cb126" class="a">Acoustics-Based Machine Fault Recognition</a><span role="cross_prod"> (Audio Toolbox)</span>. Set <code class="literal">numFrames</code> to <code class="literal">100</code>.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>fs = 16000;
windowLength = 512;
numFrames = 100;</pre></div></div></div><p>To run the Example on a test signal, generate a pink noise signal. To test the performance of the system on a real dataset, download the air compressor dataset <a href="accoustic-based-machine-fault-recognition-code-generation-on-raspberry-p1.html#mw_rtc_MachineFaultRecognitionCodeGenOnRaspiExample_M_290327A6" class="intrnllnk">[1]</a>.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>downloadDataset = <span class="live_control_container"><img tabindex="-1" alt="" src="../../examples/deeplearning_shared/win64/MachineFaultRecognitionCodeGenOnRaspiExample_05.png"><span data-examplename="openExample('deeplearning_shared/MachineFaultRecognitionCodeGenOnRaspiExample')" tabindex="0" data-controlvalue="false;" data-bs-trigger="focus" data-bs-container="body" data-bs-toggle="popover" data-bs-placement="top" data-bs-html="true" class="popover_trigger add_cursor_pointer live_control_equivalent_value">false;</span></span>

<span style="color:#0000FF">if</span> ~downloadDataset
    pinkNoiseSignal = pinknoise(windowLength*numFrames);
<span style="color:#0000FF">else</span>
    <span style="color:#228B22">% Download AirCompressorDataset.zip </span>
    component = <span style="color:#A020F0">'audio'</span>;
    filename = <span style="color:#A020F0">'AirCompressorDataset/AirCompressorDataset.zip'</span>;
    localfile = matlab.internal.examples.downloadSupportFile(component,filename);
    
    <span style="color:#228B22">% Unzip the downloaded zip file to the downloadFolder</span>
    downloadFolder = fileparts(localfile);
    <span style="color:#0000FF">if</span> ~exist(fullfile(downloadFolder,<span style="color:#A020F0">'AirCompressorDataset'</span>),<span style="color:#A020F0">'dir'</span>)
        unzip(localfile, downloadFolder)
    <span style="color:#0000FF">end</span>
    
    <span style="color:#228B22">% Create an audioDatastore object dataStore, to manage, the data.</span>
    dataStore = audioDatastore(downloadFolder,<span style="color:#A020F0">'IncludeSubfolders'</span>,true,<span style="color:#A020F0">'LabelSource'</span>,<span style="color:#A020F0">'foldernames'</span>);

    <span style="color:#228B22">% Use countEachLabel to get the number of samples of each category in the dataset.</span>
    countEachLabel(dataStore)
<span style="color:#0000FF">end</span></pre></div></div></div><h3 class="title" id="MachineFaultRecognitionCodeGenOnRaspiExample-3">Recognize Machine Fault in MATLAB</h3><p>To run the streaming classifier in MATLAB, download and unzip the system developed in <a href="../../audio/ug/acoustics-based-machine-fault-recognition.html" data-docid="audio_ug#mw_bd8f63ae-1356-48ef-a2a0-1733ed2cb126" class="a">Acoustics-Based Machine Fault Recognition</a><span role="cross_prod"> (Audio Toolbox)</span>.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>component = <span style="color:#A020F0">'audio'</span>;
filename = <span style="color:#A020F0">'AcousticsBasedMachineFaultRecognition/AcousticsBasedMachineFaultRecognition.zip'</span>;
localfile = matlab.internal.examples.downloadSupportFile(component,filename);

downloadFolder = fullfile(fileparts(localfile),<span style="color:#A020F0">'system'</span>);
<span style="color:#0000FF">if</span> ~exist(downloadFolder,<span style="color:#A020F0">'dir'</span>)    
    unzip(localfile,downloadFolder)
<span style="color:#0000FF">end</span></pre></div></div></div><p>To access the <a href="matlab:openExample('deeplearning_shared/AcousticsBasedMachineFaultRecognitionExample','supportingFile','recognizeAirCompressorFault.m')" target="_blank"><code class="literal">recognizeAirCompressorFault</code></a> function of the system, add <code class="literal">downloadFolder</code> to the search path.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>addpath(downloadFolder)</pre></div></div></div><p>Create a <a href="../../dsp/ref/dsp.asyncbuffer-system-object.html" data-docid="dsp_ref#bvkqgmw-1" class="a"><code class="olink">dsp.AsyncBuffer</code></a><span role="cross_prod"> (DSP System Toolbox)</span> object to read audio in a streaming fashion and a <a href="../../dsp/ref/dsp.asyncbuffer-system-object.html" data-docid="dsp_ref#bvkqgmw-1" class="a"><code class="olink">dsp.AsyncBuffer</code></a><span role="cross_prod"> (DSP System Toolbox)</span> object to accumulate scores.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>audioSource = dsp.AsyncBuffer;
scoreBuffer = dsp.AsyncBuffer;</pre></div></div></div><p>Load the pretrained network and extract labels from the network.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>airCompNet = coder.loadDeepLearningNetwork(<span style="color:#A020F0">'AirCompressorFaultRecognitionModel.mat'</span>);
labels = string(airCompNet.Layers(end).Classes);</pre></div></div></div><p>Initialize <code class="literal">signalToBeTested</code> to <code class="literal">pinkNoiseSignal</code> or select a signal from the drop-down list to test the file of your choice from the dataset.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre><span style="color:#0000FF">if</span> ~downloadDataset
    signalToBeTested = pinkNoiseSignal;
<span style="color:#0000FF">else</span>
    [allFiles,~] = splitEachLabel(dataStore,1);
    allData = readall(allFiles);
    signalToBeTested = <span class="live_control_container"><img tabindex="-1" alt="" src="../../examples/deeplearning_shared/win64/MachineFaultRecognitionCodeGenOnRaspiExample_06.png"><span data-examplename="openExample('deeplearning_shared/MachineFaultRecognitionCodeGenOnRaspiExample')" tabindex="0" data-controlvalue="allData(1)" data-bs-trigger="focus" data-bs-container="body" data-bs-toggle="popover" data-bs-placement="top" data-bs-html="true" class="popover_trigger add_cursor_pointer live_control_equivalent_value">allData(1)</span></span>;
    signalToBeTested = cell2mat(signalToBeTested);
<span style="color:#0000FF">end</span></pre></div></div></div><span id="mw_rtc_MachineFaultRecognitionCodeGenOnRaspiExample_M_88F7C377" class="anchor_target"></span><p>Stream one audio frame at a time to represent the system as it would be deployed in a real-time embedded system. Use <a href="matlab:openExample('deeplearning_shared/AcousticsBasedMachineFaultRecognitionExample','supportingFile','recognizeAirCompressorFault.m')" target="_blank"><code class="literal">recognizeAirCompressorFault</code></a> developed in <a href="../../audio/ug/acoustics-based-machine-fault-recognition.html" data-docid="audio_ug#mw_bd8f63ae-1356-48ef-a2a0-1733ed2cb126" class="a">Acoustics-Based Machine Fault Recognition</a><span role="cross_prod"> (Audio Toolbox)</span> to compute audio features and perform deep learning classification.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>write(audioSource,signalToBeTested);
resetNetworkState = true;

<span style="color:#0000FF">while</span> audioSource.NumUnreadSamples &gt;= windowLength
    
    <span style="color:#228B22">% Get a frame of audio data</span>
    x = read(audioSource,windowLength);
    
    <span style="color:#228B22">% Apply streaming classifier function</span>
    score = recognizeAirCompressorFault(x,resetNetworkState);
   
    <span style="color:#228B22">% Store score for analysis</span>
    write(scoreBuffer,score);
    
    resetNetworkState = false;
<span style="color:#0000FF">end</span></pre></div></div></div><p>Compute the recognized fault from scores and display it. </p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>scores = read(scoreBuffer);
[~,labelIndex] = max(scores(end,:),[],2);
detectedFault = labels(labelIndex)</pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>detectedFault = 
"Flywheel"
</pre></div></div></div><p>Plot the scores of each label for each frame.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>plot(scores)
legend(<span style="color:#A020F0">""</span> + labels,<span style="color:#A020F0">'Location'</span>,<span style="color:#A020F0">'northwest'</span>) 
xlabel(<span style="color:#A020F0">"Time Step"</span>)
ylabel(<span style="color:#A020F0">"Score"</span>)
str = sprintf(<span style="color:#A020F0">"Predicted Scores Over Time Steps.\nPredicted Class: %s"</span>,detectedFault);
title(str)</pre></div></div></div><div class="informalfigure"><div id="d126e123073" class="mediaobject"><p><img src="../../examples/deeplearning_shared/win64/MachineFaultRecognitionCodeGenOnRaspiExample_01.png" width="560"></p></div></div><p>Reset the asynchronous buffer <code class="literal">audioSource</code>.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>reset(audioSource)</pre></div></div></div><h3 class="title" id="MachineFaultRecognitionCodeGenOnRaspiExample-4">Prepare MATLAB Code For Deployment</h3><p>This example uses the <a href="../../dsp/ref/dsp.udpsender-system-object.html" data-docid="dsp_ref#bsnb6ao-1" class="a"><code class="olink">dsp.UDPSender</code></a><span role="cross_prod"> (DSP System Toolbox)</span> System object to send the audio frame to the executable running on Raspberry Pi and the <a href="../../dsp/ref/dsp.udpreceiver-system-object.html" data-docid="dsp_ref#bsnb8kx-1" class="a"><code class="olink">dsp.UDPReceiver</code></a><span role="cross_prod"> (DSP System Toolbox)</span> System object to receive the score vector from the Raspberry Pi. Create a <a href="../../dsp/ref/dsp.udpsender-system-object.html" data-docid="dsp_ref#bsnb6ao-1" class="a"><code class="olink">dsp.UDPSender</code></a><span role="cross_prod"> (DSP System Toolbox)</span> system object to send audio captured in MATLAB to your Raspberry Pi. Set the <code class="literal">targetIPAddress</code> to the IP address of your Raspberry Pi. Set the <code class="literal">RemoteIPPort</code> to <code class="literal">25000</code>. Raspberry Pi receives the input audio frame from the same port using the <a href="../../dsp/ref/dsp.udpreceiver-system-object.html" data-docid="dsp_ref#bsnb8kx-1" class="a"><code class="olink">dsp.UDPReceiver</code></a><span role="cross_prod"> (DSP System Toolbox)</span> system object.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>targetIPAddress = <span style="color:#A020F0">'172.31.164.247'</span>;
UDPSend = dsp.UDPSender(<span style="color:#A020F0">'RemoteIPPort'</span>,25000,<span style="color:#A020F0">'RemoteIPAddress'</span>,targetIPAddress); </pre></div></div></div><p>Create a <a href="../../dsp/ref/dsp.udpreceiver-system-object.html" data-docid="dsp_ref#bsnb8kx-1" class="a"><code class="olink">dsp.UDPReceiver</code></a><span role="cross_prod"> (DSP System Toolbox)</span> system object to receive predicted scores from your Raspberry Pi. Each UDP packet received from the Raspberry Pi is a vector of scores and each vector element is a score for a state of the air compressor. The maximum message length for the <a href="../../dsp/ref/dsp.udpreceiver-system-object.html" data-docid="dsp_ref#bsnb8kx-1" class="a"><code class="olink">dsp.UDPReceiver</code></a><span role="cross_prod"> (DSP System Toolbox)</span> object is 65507 bytes. Calculate the buffer size to accommodate the maximum number of UDP packets.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>sizeOfDoubleInBytes = 8;
numScores = 8;
maxUDPMessageLength = floor(65507/sizeOfDoubleInBytes);
numPackets = floor(maxUDPMessageLength/numScores);
bufferSize = numPackets*numScores*sizeOfDoubleInBytes;

UDPReceive = dsp.UDPReceiver(<span style="color:#A020F0">"LocalIPPort"</span>,21000, <span style="color:#0000FF">...</span><span style="color:#228B22">  </span>
    <span style="color:#A020F0">"MessageDataType"</span>,<span style="color:#A020F0">"single"</span>, <span style="color:#0000FF">...</span>
    <span style="color:#A020F0">"MaximumMessageLength"</span>,numScores, <span style="color:#0000FF">...</span>
    <span style="color:#A020F0">"ReceiveBufferSize"</span>,bufferSize);</pre></div></div></div><p>Create a supporting function, <a href="matlab:openExample('deeplearning_shared/MachineFaultRecognitionCodeGenOnRaspiExample','supportingFile','recognizeAirCompressorFault.m')" target="_blank"><code class="literal">recognizeAirCompressorFaultRaspi</code></a>, that receives an audio frame using <a href="../../dsp/ref/dsp.udpreceiver-system-object.html" data-docid="dsp_ref#bsnb8kx-1" class="a"><code class="olink">dsp.UDPReceiver</code></a><span role="cross_prod"> (DSP System Toolbox)</span> and applies the streaming classifier and sends the predicted score vector to MATLAB using <a href="../../dsp/ref/dsp.udpsender-system-object.html" data-docid="dsp_ref#bsnb6ao-1" class="a"><code class="olink">dsp.UDPSender</code></a><span role="cross_prod"> (DSP System Toolbox)</span>.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>type <span style="color:#A020F0">recognizeAirCompressorFaultRaspi</span></pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>function recognizeAirCompressorFaultRaspi(hostIPAddress)
% This function receives acoustic input using dsp.UDPReceiver and runs a
% streaming classifier by calling recognizeAirCompressorFault, developed in
% the Acoustics-Based Machine Fault Recognition - MATLAB Example. 
% Computed scores are sent to MATLAB using dsp.UDPSender.
%#codegen

%   Copyright 2021 The MathWorks, Inc.

frameLength = 512;

% Configure UDP Sender System Object
UDPSend = dsp.UDPSender('RemoteIPPort',21000,'RemoteIPAddress',hostIPAddress);

% Configure UDP Receiver system object
sizeOfDoubleInBytes = 8;
maxUDPMessageLength = floor(65507/sizeOfDoubleInBytes);
numPackets = floor(maxUDPMessageLength/frameLength);
bufferSize = numPackets*frameLength*sizeOfDoubleInBytes;
UDPReceiveRaspi = dsp.UDPReceiver('LocalIPPort',25000, ...
    'MaximumMessageLength',frameLength, ...
    'ReceiveBufferSize',bufferSize, ...
    'MessageDataType','double');

% Reset network state for first call
resetNetworkState = true;

while true
    % Receive audio frame of size frameLength x 1
    x = UDPReceiveRaspi();

    if(~isempty(x))

        x = x(1:frameLength,1);

        % Apply streaming classifier function
        scores = recognizeAirCompressorFault(x,resetNetworkState);

        %Send output to the host machine
        UDPSend(scores);

        resetNetworkState = false;
    end
end
</pre></div></div></div><h3 class="title" id="MachineFaultRecognitionCodeGenOnRaspiExample-5">Generate Executable on Raspberry Pi</h3><p>Replace the <code class="literal">hostIPAddress</code> with your machine's address. Your Raspberry Pi sends the predicted scores to the IP address you specify.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>hostIPAddress = coder.Constant(<span style="color:#A020F0">'172.18.230.30'</span>);</pre></div></div></div><p>Create a code generation configuration object to generate an executable program. Specify the target language as C++.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>cfg = coder.config(<span style="color:#A020F0">'exe'</span>);
cfg.TargetLang = <span style="color:#A020F0">'C++'</span>;</pre></div></div></div><p>Create a configuration object for deep learning code generation with the ARM compute library that is on your Raspberry Pi. Specify the architecture of the Raspberry Pi and attach the deep learning configuration object to the code generation configuration object.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>dlcfg = coder.DeepLearningConfig(<span style="color:#A020F0">'arm-compute'</span>);
dlcfg.ArmArchitecture = <span style="color:#A020F0">'armv7'</span>;
dlcfg.ArmComputeVersion = <span style="color:#A020F0">'20.02.1'</span>;
cfg.DeepLearningConfig = dlcfg;</pre></div></div></div><p>Use the Raspberry Pi Support Package function <code class="literal">raspi</code> to create a connection to your Raspberry Pi. In the next block of code, replace:</p><div class="itemizedlist"><ul><li><p><code class="literal">raspiname</code> with the name of your Raspberry Pi</p></li><li><p><code class="literal">pi</code> with your user name</p></li><li><p><code class="literal">password</code> with your password</p></li></ul></div><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre><span style="color:#0000FF">if</span> (~exist(<span style="color:#A020F0">'r'</span>,<span style="color:#A020F0">'var'</span>))
  r = raspi(<span style="color:#A020F0">'raspiname'</span>,<span style="color:#A020F0">'pi'</span>,<span style="color:#A020F0">'password'</span>);
<span style="color:#0000FF">end</span></pre></div></div></div><p>Create a <a href="../../coder/ref/coder.hardware.html" data-docid="coder_ref#mw_c0d3d077-d33a-4dca-b85d-76027b3170b7" class="a"><code class="olink">coder.hardware</code></a><span role="cross_prod"> (MATLAB Coder)</span> object for Raspberry Pi and attach it to the code generation configuration object.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>hw = coder.hardware(<span style="color:#A020F0">'Raspberry Pi'</span>);
cfg.Hardware = hw;</pre></div></div></div><p>Specify the build folder on the Raspberry Pi.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>buildDir = <span style="color:#A020F0">'~/remoteBuildDir'</span>;
cfg.Hardware.BuildDir = buildDir;</pre></div></div></div><p>Use an autogenerated C++ main file to generate a standalone executable.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>cfg.GenerateExampleMain = <span style="color:#A020F0">'GenerateCodeAndCompile'</span>;</pre></div></div></div><p>Call the <a href="../../coder/ref/codegen.html" data-docid="coder_ref#br46oyi-1" class="a"><code class="olink">codegen</code></a><span role="cross_prod"> (MATLAB Coder)</span> function from MATLAB Coder to generate C++ code and the executable on your Raspberry Pi. By default, the Raspberry Pi executable has the same name as the MATLAB function. You get a warning in the code generation logs <code class="literal">that</code> you can disregard because <a href="matlab:openExample('deeplearning_shared/MachineFaultRecognitionCodeGenOnRaspiExample','supportingFile','recognizeAirCompressorFault.m')" target="_blank"><code class="literal">recognizeAirCompressorFaultRaspi</code></a> has an infinite loop that looks for an audio frame from MATLAB.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>codegen <span style="color:#A020F0">-config</span> <span style="color:#A020F0">cfg</span> <span style="color:#A020F0">recognizeAirCompressorFaultRaspi</span> <span style="color:#A020F0">-args</span> <span style="color:#A020F0">{hostIPAddress}</span> <span style="color:#A020F0">-report</span></pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre> Deploying code. This may take a few minutes. 
Warning: Function 'recognizeAirCompressorFaultRaspi' does not terminate due to an infinite loop.

Warning in ==&gt; recognizeAirCompressorFaultRaspi Line: 1 Column: 1
Code generation successful (with warnings): View report
</pre></div></div></div><h3 class="title" id="MachineFaultRecognitionCodeGenOnRaspiExample-6">Perform Machine Fault Recognition Using Deployed Code</h3><p>Create a command to open the <a href="matlab:openExample('deeplearning_shared/MachineFaultRecognitionCodeGenOnRaspiExample','supportingFile','recognizeAirCompressorFaultRaspi.m')" target="_blank"><code class="literal">recognizeAirCompressorFaultRaspi</code></a> application on a Raspberry Pi. Use <a href="../ref/system.html" data-docid="matlab_ref#btnrzs7-1" class="a"><code class="olink">system</code></a> to send the command to your Raspberry Pi.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>applicationName = <span style="color:#A020F0">'recognizeAirCompressorFaultRaspi'</span>;

applicationDirPaths = raspi.utils.getRemoteBuildDirectory(<span style="color:#A020F0">'applicationName'</span>,applicationName);
targetDirPath = applicationDirPaths{1}.directory;

exeName = strcat(applicationName,<span style="color:#A020F0">'.elf'</span>);
command = [<span style="color:#A020F0">'cd '</span>,targetDirPath,<span style="color:#A020F0">'; ./'</span>,exeName,<span style="color:#A020F0">' &amp;&gt; 1 &amp;'</span>];

system(r,command);</pre></div></div></div><p>Initialize <code class="literal">signalToBeTested</code> to <code class="literal">pinkNoiseSignal</code> or select a signal from the drop-down list to test the file of your choice from the dataset.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre><span style="color:#0000FF">if</span> ~downloadDataset
    signalToBeTested = pinkNoiseSignal;
<span style="color:#0000FF">else</span>
    [allFiles,~] = splitEachLabel(dataStore,1);
    allData = readall(allFiles);
    signalToBeTested = <span class="live_control_container"><img tabindex="-1" alt="" src="../../examples/deeplearning_shared/win64/MachineFaultRecognitionCodeGenOnRaspiExample_07.png"><span data-examplename="openExample('deeplearning_shared/MachineFaultRecognitionCodeGenOnRaspiExample')" tabindex="0" data-controlvalue="allData(1)" data-bs-trigger="focus" data-bs-container="body" data-bs-toggle="popover" data-bs-placement="top" data-bs-html="true" class="popover_trigger add_cursor_pointer live_control_equivalent_value">allData(1)</span></span>;
    signalToBeTested = cell2mat(signalToBeTested);
<span style="color:#0000FF">end</span></pre></div></div></div><p>Stream one audio frame at a time to represent a system as it would be deployed in a real-time embedded system. Use the generated MEX file <code class="literal">recognizeAirCompressorFault_mex</code> to compute audio features and perform deep learning classification.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>write(audioSource,signalToBeTested);

<span style="color:#0000FF">while</span> audioSource.NumUnreadSamples &gt;= windowLength
    x = read(audioSource,windowLength);
    UDPSend(x);
    score = UDPReceive();
    <span style="color:#0000FF">if</span> ~isempty(score)    
        write(scoreBuffer,score');
    <span style="color:#0000FF">end</span>
<span style="color:#0000FF">end</span></pre></div></div></div><p>Compute the recognized fault from scores and display it. </p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>scores = read(scoreBuffer);
[~,labelIndex] = max(scores(end,:),[],2);
detectedFault = labels(labelIndex)</pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>detectedFault = 
"Flywheel"
</pre></div></div></div><p>Plot the scores of each label for each frame.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>plot(scores)
legend(<span style="color:#A020F0">""</span> + labels,<span style="color:#A020F0">'Location'</span>,<span style="color:#A020F0">'northwest'</span>) 
xlabel(<span style="color:#A020F0">"Time Step"</span>)
ylabel(<span style="color:#A020F0">"Score"</span>)
str = sprintf(<span style="color:#A020F0">"Predicted Scores Over Time Steps.\nPredicted Class: %s"</span>,detectedFault);
title(str)</pre></div></div></div><div class="informalfigure"><div id="d126e123223" class="mediaobject"><p><img src="../../examples/deeplearning_shared/win64/MachineFaultRecognitionCodeGenOnRaspiExample_02.png" width="560"></p></div></div><p>Terminate the standalone executable running on Raspberry Pi.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>stopExecutable(codertarget.raspi.raspberrypi,exeName)</pre></div></div></div><h3 class="title" id="MachineFaultRecognitionCodeGenOnRaspiExample-7"><strong class="emphasis bold">Evaluate Execution Time Using Alternative PIL Function Workflow</strong></h3><p>To evaluate execution time taken by standalone executable on Raspberry Pi, use a PIL (processor-in-loop) workflow. To perform PIL profiling, generate a PIL function for the supporting function <a href="matlab:openExample('deeplearning_shared/AcousticsBasedMachineFaultRecognitionExample','supportingFile','recognizeAirCompressorFault.m')" target="_blank"><code class="literal">recognizeAirCompressorFault</code></a>.</p><p>Create a code generation configuration object to generate the PIL function.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>cfg = coder.config(<span style="color:#A020F0">'lib'</span>,<span style="color:#A020F0">'ecoder'</span>,true);
cfg.VerificationMode = <span style="color:#A020F0">'PIL'</span>;</pre></div></div></div><p>Set the ARM compute library and architecture.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>dlcfg = coder.DeepLearningConfig(<span style="color:#A020F0">'arm-compute'</span>);
cfg.DeepLearningConfig = dlcfg ;
cfg.DeepLearningConfig.ArmArchitecture = <span style="color:#A020F0">'armv7'</span>;
cfg.DeepLearningConfig.ArmComputeVersion = <span style="color:#A020F0">'20.02.1'</span>;</pre></div></div></div><p>Set up the connection with your target hardware.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre><span style="color:#0000FF">if</span> (~exist(<span style="color:#A020F0">'r'</span>,<span style="color:#A020F0">'var'</span>))
  r = raspi(<span style="color:#A020F0">'raspiname'</span>,<span style="color:#A020F0">'pi'</span>,<span style="color:#A020F0">'password'</span>);
<span style="color:#0000FF">end</span>
hw = coder.hardware(<span style="color:#A020F0">'Raspberry Pi'</span>);
cfg.Hardware = hw;</pre></div></div></div><p>Set the build directory and target language.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>buildDir = <span style="color:#A020F0">'~/remoteBuildDir'</span>;
cfg.Hardware.BuildDir = buildDir;
cfg.TargetLang = <span style="color:#A020F0">'C++'</span>;</pre></div></div></div><p>Enable profiling and generate the PIL code. A MEX file named <code class="literal">recognizeAirCompressorFault_pil</code> is generated in your current folder.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>cfg.CodeExecutionProfiling = true;
audioFrame = ones(windowLength,1);
resetNetworkStateFlag = true;
codegen <span style="color:#A020F0">-config</span> <span style="color:#A020F0">cfg</span> <span style="color:#A020F0">recognizeAirCompressorFault</span> <span style="color:#A020F0">-args</span> <span style="color:#A020F0">{audioFrame,resetNetworkStateFlag}</span></pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre> Deploying code. This may take a few minutes. 
### Connectivity configuration for function 'recognizeAirCompressorFault': 'Raspberry Pi'
Location of the generated elf : /home/pi/remoteBuildDir/MATLAB_ws/R2021b/S/MATLAB/Examples/ExampleManager/sporwal.Bdoc21b.j1720794/deeplearning_shared-ex44063374/codegen/lib/recognizeAirCompressorFault/pil
Code generation successful.
</pre></div></div></div><p>Call the generated PIL function 50 times to get the average execution time.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>totalCalls = 50;

<span style="color:#0000FF">for</span> k = 1:totalCalls
    x = pinknoise(windowLength,1);
    score = recognizeAirCompressorFault_pil(x,resetNetworkStateFlag);
    resetNetworkStateFlag = false;
<span style="color:#0000FF">end</span></pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>### Starting application: 'codegen\lib\recognizeAirCompressorFault\pil\recognizeAirCompressorFault.elf'
    To terminate execution: clear recognizeAirCompressorFault_pil
### Launching application recognizeAirCompressorFault.elf...
    Execution profiling data is available for viewing. Open Simulation Data Inspector.
    Execution profiling report available after termination.
</pre></div></div></div><p>Terminate the PIL execution.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>clear <span style="color:#A020F0">recognizeAirCompressorFault_pil</span></pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>### Host application produced the following standard output (stdout) and standard error (stderr) messages:

### Connectivity configuration for function 'recognizeAirCompressorFault': 'Raspberry Pi'
    Execution profiling report: report(getCoderExecutionProfile('recognizeAirCompressorFault'))
</pre></div></div></div><p>Generate an execution profile report to evaluate execution time.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>executionProfile = getCoderExecutionProfile(<span style="color:#A020F0">'recognizeAirCompressorFault'</span>);
report(executionProfile, <span style="color:#0000FF">...</span>
       <span style="color:#A020F0">'Units'</span>,<span style="color:#A020F0">'Seconds'</span>, <span style="color:#0000FF">...</span>
       <span style="color:#A020F0">'ScaleFactor'</span>,<span style="color:#A020F0">'1e-03'</span>, <span style="color:#0000FF">...</span>
       <span style="color:#A020F0">'NumericFormat'</span>,<span style="color:#A020F0">'%0.4f'</span>);</pre></div></div></div><div class="informalfigure"><div id="d126e123273" class="mediaobject"><p><img src="../../examples/deeplearning_shared/win64/MachineFaultRecognitionCodeGenOnRaspiExample_03.png" height="770" width="1049"></p></div></div><div class="informalfigure"><div id="d126e123278" class="mediaobject"><p><img src="../../examples/deeplearning_shared/win64/MachineFaultRecognitionCodeGenOnRaspiExample_04.png" height="562" width="1051"></p></div></div><p>The average execution time of <code class="literal">recognizeAirCompressorFault_pil</code> function is <code class="literal">0.423</code> <code class="literal">ms</code>, which is well below the <code class="literal">32</code> <code class="literal">ms</code> budget for real-time performance. The first call of <code class="literal">recognizeAirCompressorFault_pil</code> consumes around <code class="literal">12</code> times of the average execution time as it includes loading of network and resetting of the states. However, in a real, deployed system, that initialization time is incurred only once. This example ends here. For deploying machine fault recognition on desktops, see <a href="../../audio/ug/acoustics-based-machine-fault-recognition-code-generation-with-intel-mkl-dnn.html" data-docid="audio_ug#mw_5069c8b8-2ee2-4dec-b2f8-57d6df31ea1f" class="a">Acoustics-Based Machine Fault Recognition Code Generation</a><span role="cross_prod"> (Audio Toolbox)</span>.</p><h3 class="title" id="MachineFaultRecognitionCodeGenOnRaspiExample-8">References</h3><span id="mw_rtc_MachineFaultRecognitionCodeGenOnRaspiExample_M_290327A6" class="anchor_target"></span><p>[1] Verma, Nishchal K., et al. "Intelligent Condition Based Monitoring Using Acoustic Signals for Air Compressors." <span class="emphasis"><em>IEEE Transactions on Reliability</em></span>, vol. 65, no. 1, Mar. 2016, pp. 291&#8211;309. DOI.org (Crossref), doi:10.1109/TR.2015.2459684.</p></div></section>
    </div></section><div xmlns="http://www.w3.org/1999/xhtml" class="clearfix"></div>
<div xmlns="http://www.w3.org/1999/xhtml" align="center" class="feedbackblock" id="mw_docsurvey"><script src="https://www.mathworks.com/help/docsurvey/docfeedback.js"></script>
<script>loadSurveyHidden();</script>
<link rel="stylesheet" href="https://www.mathworks.com/help/docsurvey/release/index-css.css" type="text/css">
<script src="https://www.mathworks.com/help/docsurvey/release/bundle.index.js"></script>

<script>initDocSurvey();</script></div></main>


</div>
</div>
</div>
</div><!--close_0960-->
<footer xmlns="http://www.w3.org/1999/xhtml" id="footer" class="bs-footer">
<div class="container-fluid">
<div class="footer">
<div class="row">
<div class="col-12">
<p class="copyright"> 1994-2025 The MathWorks, Inc.</p>
<ul class="footernav"><li class="footernav_help"><a href="matlab:web(matlab.internal.licenseAgreement)">Terms of Use</a></li><li class="footernav_patents"><a href="matlab:web([matlabroot '/patents.txt'])">Patents</a></li><li class="footernav_trademarks"><a href="matlab:web([matlabroot '/trademarks.txt'])">Trademarks</a></li><li class="footernav_piracy"><a href="matlab:web([docroot '/acknowledgments.html'])">Acknowledgments</a></li></ul></div>
</div>
</div>
</div>
</footer>
</div><!--close row-offcanvas-->
</div><!--close_0970-->
</body>
</html>
