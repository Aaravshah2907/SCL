<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage">
<head>
<meta xmlns="http://www.w3.org/1999/xhtml" charset="utf-8">
<meta xmlns="http://www.w3.org/1999/xhtml" name="viewport" content="width=device-width, initial-scale=1.0">
<meta xmlns="http://www.w3.org/1999/xhtml" http-equiv="X-UA-Compatible" content="IE=edge">
<title>IoT-Based Automatic Cooling Fan Control Using ThingSpeak and Arduino Hardware</title>
<script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
      {
      "@context": "http://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement":
      [{
          "@type": "ListItem",
          "position": 1,

          "item": {
          "@id": "../index.html",
          "name": "MATLAB"
}

          } 
        ,
        {
          "@type": "ListItem",
          "position": 2,

          "item": {
          "@id": "../data-import-and-analysis.html",
          "name": "Data Import and Analysis"
}

          }
        ,
        {
          "@type": "ListItem",
          "position": 3,

          "item": {
          "@id": "../data-import-and-export.html",
          "name": "Data Import and Export"
}

          }
        ,
        {
          "@type": "ListItem",
          "position": 4,

          "item": {
          "@id": "../hardware-network-comm.html",
          "name": "Hardware and Network Communication"
}

          }
        ,
        {
          "@type": "ListItem",
          "position": 5,

          "item": {
          "@id": "../hardware-boards-and-kits.html",
          "name": "Hardware Boards and Kits"
}

          }
        ,
        {
          "@type": "ListItem",
          "position": 6,

          "item": {
          "@id": "../arduinoio.html",
          "name": "Arduino Hardware"
}

          }
        ,
        {
          "@type": "ListItem",
          "position": 7,

          "item": {
          "@id": "../arduinoio-sensors.html",
          "name": "Sensors"
}

          }]
      }</script><script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "ItemList",
          "name": "VisibleBreadcrumbs",

        "itemListElement":
        [
        "arduinoio-sensors"
        ],
        "itemListOrder": "http://schema.org/ItemListOrderAscending"
        }
        </script><script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "DigitalDocument",
          "headline": "IoT-Based Automatic Cooling Fan Control Using ThingSpeak and Arduino Hardware",
          "description": "Create a ThingSpeak&#8482; channel and use the MATLAB&#174; functions to collect the temperature data from a BMP280 sensor connected to your Arduino&#174; board, and then use MATLAB Analysis in ThingSpeak to trigger the automatic control of a CPU cooling fan kept in the room and then monitor the usage of the fan by calculating the runtime. This example also shows you how to set up an email alert if the fan turns on, by using MATLAB functions in ThingSpeak.",
          "thumbnailURL": "../../examples/arduinoio/win64/IoTBasedAutomaticCoolingFanControlThingSpeakArduinoExample_09.png",
          "genre": "Live Script",
          "isBasedOn": {
          "@type": "Product",
          "name": "MATLAB"

        },
          "identifier": "arduinoio.IoTBasedAutomaticCoolingFanControlThingSpeakArduinoExample",
          "name": "IoTBasedAutomaticCoolingFanControlThingSpeakArduinoExample",
          "url": "iot-automatic-cooling-fan-arduino-example.html"

        }</script><script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "PropertyValue",
          "name": "open_command",
          "value": "matlab:openExample('arduinoio/IoTBasedAutomaticCoolingFanControlThingSpeakArduinoExample')"

        }</script><script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "ItemList",
          "name": "ExampleSourceFiles",

        "itemListElement":
        [
        "IoTBasedAutomaticCoolingFanControlThingSpeakArduinoExample.mlx"
        ],
        "itemListOrder": "http://schema.org/ItemListOrderAscending"
        }
        </script><link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/bootstrap.min.css" rel="stylesheet" type="text/css">


  <meta xmlns="http://www.w3.org/1999/xhtml" http-equiv="Content-Script-Type" content="text/javascript">
<meta xmlns="http://www.w3.org/1999/xhtml" name="toctype" itemprop="pagetype" content="ug">
<meta xmlns="http://www.w3.org/1999/xhtml" name="infotype" itemprop="infotype" content="other">

<meta xmlns="http://www.w3.org/1999/xhtml" name="description" itemprop="description" content="This example shows how to create a ThingSpeak&#8482; channel and use the MATLAB&#174; functions to collect the temperature data from a BMP280 sensor connected to your Arduino&#174; board, and then use MATLAB Analysis in ThingSpeak to trigger the automatic control of a CPU cooling fan kept in the room and then monitor the usage of the fan by calculating the runtime."><meta xmlns="http://www.w3.org/1999/xhtml" content="../../examples/arduinoio/win64/IoTBasedAutomaticCoolingFanControlThingSpeakArduinoExample_09.png" itemprop="thumbnailUrl">
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/jquery/jquery-3.6.0.min.js"></script><script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/jquery/jquery-migrate.min.js"></script>
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6.css" rel="stylesheet" type="text/css">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_lg.css" rel="stylesheet" media="screen and (min-width: 1200px)">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_md.css" rel="stylesheet" media="screen and (min-width: 992px) and (max-width: 1199px)">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_sm+xs.css" rel="stylesheet" media="screen and (max-width: 991px)">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_sm.css" rel="stylesheet" media="screen and (min-width: 768px) and (max-width: 991px)">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_xs.css" rel="stylesheet" media="screen and (max-width: 767px)">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_offcanvas_v2.css" rel="stylesheet" type="text/css">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/shared/highlight/styles/mwdochighlight.min.css" rel="stylesheet" type="text/css">

<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/l10n.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/docscripts.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/f1help.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/docscripts.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/mw.imageanimation.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/jquery.highlight.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/underscore-min.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/use_platform_screenshots.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/suggest.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/overload.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/helpservices.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/productfilter.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/matlab_dialog_shared.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/highlight/highlight.min.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/localstorage.js"></script><script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/product_group.js"></script><script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/saxonjs/SaxonJS2.rt.js"></script><script xmlns="http://www.w3.org/1999/xhtml">
            window.history.replaceState(window.location.href, null, ""); // Initialize
            window.onload = function() {    
            mystylesheetLocation = "../../includes/shared/scripts/product_group-sef.json";
            mysourceLocation = "../../docset/docset.xml";
            product_help_location = "matlab";
            pagetype = "section";
            doccentertype = "product";
            langcode = "";
            getProductFilteredList(mystylesheetLocation, mysourceLocation, product_help_location, pagetype, doccentertype, langcode);  
            }
          </script>




<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/jquery/jquery.mobile.custom.min.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/bootstrap.bundle.min.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/global.js"></script>
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/doc_center_base.css" rel="stylesheet" type="text/css">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/doc_center_installed.css" rel="stylesheet" type="text/css">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/doc_center_print.css" rel="stylesheet" type="text/css" media="print">
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/equationrenderer/release/MathRenderer.js"></script>
</head>
<body id="responsive_offcanvas">
<div xmlns="http://www.w3.org/1999/xhtml" id="doc_header_spacer" class="header"></div>
<div xmlns="http://www.w3.org/1999/xhtml" class="section_header level_3"><div class="container-fluid"><div class="row" id="mobile_search_row"><div class="col-sm-6 col-md-7 has_horizontal_local_nav" id="section_header_title"><div class="section_header_content"><div class="section_header_title"><h1><a href="../../documentation-center.html">Help Center</a></h1></div></div></div><div class="col-12 col-sm-6 col-md-5" id="mobile_search"><div class="search_nested_content_container"><form id="docsearch_form" name="docsearch_form" method="get" data-release="R2025b" data-language="en" action="../../templates/searchresults.html"><div class="input-group tokenized_search_field"><label class="visually-hidden form-label">Search Help</label><input type="text" class="form-control conjoined_search" autocomplete="off" name="qdoc" placeholder="Search Help" id="docsearch"> <div><button type="submit" name="submitsearch" id="submitsearch" class="btn icon-search btn_search_adjacent btn_search icon_16" tabindex="-1"></button></div></div></form></div><button class="btn icon-remove btn_search float-end icon_32 d-sm-none" data-bs-toggle="collapse" href="#mobile_search" aria-expanded="false" aria-controls="mobile_search"></button></div><div class="d-sm-none" id="search_actuator"><button class="btn icon-search btn_search float-end icon_16" data-bs-toggle="collapse" href="#mobile_search" aria-expanded="false" aria-controls="mobile_search"></button></div></div></div></div><div class="row-offcanvas row-offcanvas-left">
<div xmlns="http://www.w3.org/1999/xhtml" class="sidebar-offcanvas" id="sidebar">
<nav class="offcanvas_nav" role="navigation">
<div class="offcanvas_actuator" data-bs-toggle="offcanvas" data-bs-target="#sidebar" id="nav_toggle"><button type="button" class="btn"><span class="visually-hidden">Off-Canvas Navigation Menu Toggle
                  Off-Canvas Navigation Menu Toggle</span><span class="icon-menu"></span></button><span class="offcanvas_actuator_label" id="translation_icon-menu" tabindex="-1" aria-hidden="true"></span></div><div class="nav_list_wrapper" id="nav_list_wrapper"><nav class="offcanvas_nav" role="navigation"><ul class="nav_breadcrumb" id="ul_left_nav_ancestors"><li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../../documentation-center.html?s_tid=CRUX_lftnav" itemprop="url"><span itemprop="title">Documentation Home</span></a></li></ul>
<ul class="nav_disambiguation"><li><a href="../index.html?s_tid=CRUX_lftnav" id="index">MATLAB</a>
</li>
<li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../data-import-and-analysis.html?s_tid=CRUX_lftnav" itemprop="url"><span itemprop="title">Data Import and Analysis</span></a></li><li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../data-import-and-export.html?s_tid=CRUX_lftnav" itemprop="url"><span itemprop="title">Data Import and Export</span></a></li><li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../hardware-network-comm.html?s_tid=CRUX_lftnav" itemprop="url"><span itemprop="title">Hardware and Network Communication</span></a></li><li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../hardware-boards-and-kits.html?s_tid=CRUX_lftnav" itemprop="url"><span itemprop="title">Hardware Boards and Kits</span></a></li><li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../arduinoio.html?s_tid=CRUX_lftnav" itemprop="url"><span itemprop="title">Arduino Hardware</span></a></li><li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../arduinoio-sensors.html?s_tid=CRUX_lftnav" itemprop="url" id="mw_a50129d8-52cc-41a2-a650-07e612c999b7"><span itemprop="title">Sensors</span></a></li></ul><div class="search_refine_v4"><div id="facets_area"><ul class="nav_scrollspy nav list-unstyled" id="pnav">
<li class="nav_scrollspy_function nav-item"><a href="#responsive_offcanvas">IoT-Based Automatic Cooling Fan Control Using ThingSpeak and Arduino Hardware</a></li>
<li class="nav_scrollspy_title nav-item" id="SSPY810-section">On this page</li>
<!--ADD_REFENTRY_TITLE_HERE 11--><li class="nav-item"><a href="#IoTBasedAutomaticCoolingFanControlThingSpeakArduinoExample-1" class="nav-link intrnllnk">Hardware Setup</a></li><li class="nav-item"><a href="#IoTBasedAutomaticCoolingFanControlThingSpeakArduinoExample-3" class="nav-link intrnllnk">Create ThingSpeak Channel and Add Widgets</a></li><li class="nav-item"><a href="#IoTBasedAutomaticCoolingFanControlThingSpeakArduinoExample-5" class="nav-link intrnllnk">Identify API Keys in ThingSpeak</a></li><li class="nav-item"><a href="#IoTBasedAutomaticCoolingFanControlThingSpeakArduinoExample-6" class="nav-link intrnllnk">Run MATLAB Code to Obtain Temperature Data from BMP280 Sensor</a></li><li class="nav-item"><a href="#IoTBasedAutomaticCoolingFanControlThingSpeakArduinoExample-7" class="nav-link intrnllnk">Set Up Email Alert for Temperature Beyond Threshold Using ThingSpeak</a></li></ul></div></div>
</nav></div></nav>
<script src="../../includes/product/scripts/offcanvas_v2.js"></script></div><!--END.CLASS sidebar-offcanvas-->
<div class="offcanvas_content_container">
<div xmlns="http://www.w3.org/1999/xhtml" class="sticky_header_container"><div class="horizontal_nav"><div class="horizontal_nav_container"><div class="offcanvas_horizontal_nav"><div class="container-fluid"><div class="row"><div class="col-sm-12 d-none d-sm-block"><nav class="navbar navbar-default" role="navigation" id="subnav"><div><ul class="nav navbar-nav crux_browse"><li id="crux_nav_documentation" class="crux_resource active">Documentation</li><li id="crux_nav_example" class="crux_resource"><a href="../examples.html?category=arduinoio-sensors&amp;s_tid=CRUX_topnav">Examples</a></li><li id="crux_nav_function" class="crux_resource"><a href="../referencelist.html?type=function&amp;category=arduinoio-sensors&amp;s_tid=CRUX_topnav">Functions</a></li><li id="crux_nav_app" class="crux_resource"><a href="../referencelist.html?type=app&amp;category=arduinoio-sensors&amp;s_tid=CRUX_topnav">Apps</a></li></ul></div></nav></div><div class="d-sm-none"><div class="container-fluid"><div class="row"><div class="col-9"><div class="mobile_crux_nav_trigger"><div class="btn-group"><button type="button" class="btn btn-default dropdown-toggle" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Resources</button><ul class="dropdown-menu"><li id="crux_nav_mobile_documentation" class="crux_resource active">Documentation</li><li id="crux_nav_mobile_example" class="crux_resource"><a href="../examples.html?category=arduinoio-sensors&amp;s_tid=CRUX_topnav">Examples</a></li><li id="crux_nav_mobile_function" class="crux_resource"><a href="../referencelist.html?type=function&amp;category=arduinoio-sensors&amp;s_tid=CRUX_topnav">Functions</a></li><li id="crux_nav_mobile_app" class="crux_resource"><a href="../referencelist.html?type=app&amp;category=arduinoio-sensors&amp;s_tid=CRUX_topnav">Apps</a></li></ul></div></div></div><div class="col-3"><div class="translate_placeholder"></div></div></div></div></div></div></div></div></div></div></div><div class="content_container" id="content_container" itemprop="content">
<div class="container-fluid">
<div class="row">
<div class="col-12">

<main id="skip_link_anchor" tabindex="-1">
<div xmlns="http://www.w3.org/1999/xhtml" id="product_info_alert"></div><section xmlns="http://www.w3.org/1999/xhtml" id="doc_center_content" lang="en" data-language="en"><div id="pgtype-topic">
<section><h1 class="r2025b" itemprop="title content" id="mw_fb35a6d9-1c9b-4c12-ba50-dfacb4a947bf">IoT-Based Automatic Cooling Fan Control Using ThingSpeak and Arduino Hardware</h1><div class="examples_short_list hidden_ios_android" data-products="ML ML_ARDUINO TSP"><div data-pane="metadata" class="card metadata_container"><div class="card-body metadata_content"><p class="add_margin_5">This example uses:</p><ul class="list-unstyled add_border_bottom example_product_list" itemprop="requiredprods"><li><a href="matlab:matlab.internal.addons.showAddon('ML_ARDUINO')">MATLAB Support Package for Arduino Hardware</a></li><li><a href="matlab:matlab.internal.addons.showAddon('TSP')">ThingSpeak</a></li></ul><div class="d-grid"><a class="btn btn_color_blue" href="matlab:openExample('arduinoio/IoTBasedAutomaticCoolingFanControlThingSpeakArduinoExample')" data-ex-genre="Live Script">Open Live Script</a></div></div></div></div><div itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage/Example" itemprop="example" class="em_example"><meta itemprop="exampleid" content="arduinoio-IoTBasedAutomaticCoolingFanControlThingSpeakArduinoExample"><meta itemprop="exampletitle" content="IoTBased Automatic Cooling Fan Control Using ThingSpeak and Arduino Hardware"></div><span id="IoTBasedAutomaticCoolingFanControlThingSpeakArduinoExample" class="anchor_target"></span><p class="shortdesc">This example shows how to create a ThingSpeak&#8482; channel and use the MATLAB&#174; functions to collect the temperature data from a BMP280 sensor connected to your Arduino&#174; board, and then use MATLAB Analysis in ThingSpeak to trigger the automatic control of a CPU cooling fan kept in the room and then monitor the usage of the fan by calculating the runtime. This example also shows you how to set up an email alert if the fan turns on, by using MATLAB functions in ThingSpeak.</p><div class="procedure"><h3 class="title" id="IoTBasedAutomaticCoolingFanControlThingSpeakArduinoExample-1">Hardware Setup</h3><p>This example uses:</p><div class="itemizedlist"><ul><li><p>Arduino Uno</p></li><li><p>Arduino Sensor Kit - Base</p></li><li><p>BMP280 sensor </p></li><li><p>CPU cooling fan (12V DC)</p></li><li><p>5V General Purpose Relay Module</p></li><li><p>XL6009 DC-DC Step-Up Converter</p></li><li><p>Input power source (5V)</p></li></ul></div><h4 class="title" id="IoTBasedAutomaticCoolingFanControlThingSpeakArduinoExample-2">Hardware Connection</h4><div class="orderedlist"><ol style="list-style: decimal;"><li><p>Place the Base Shield that is part of the Arduino Sensor Kit, on top of Arduino Uno board. </p></li><li><p>Connect the BMP280 sensor to one of the I2C grove connectors on the Base Shield.</p></li><li><p>Connect the Arduino Uno to the computer running MATLAB via USB.</p></li><li><p>Connect the Vcc pin of the relay to 5V pin of Arduino Uno, and connect the GND pin of relay to GND pin of Arduino Uno.</p></li><li><p>Connect the IN pin of the relay to D2 pin of Arduino Uno.</p></li><li><p>Connect the output pins of relay to the + and - power inputs of XL6009 DC-DC Step-Up Converter. Make the connections such that the LED on the relay glows till it receives input signal from Arduino board (NC - Normally Closed condition).</p></li><li><p>Connect the + and - terminals of the fan to the output of the XL6009 DC-DC Step-Up Converter.</p></li></ol></div><div class="informalfigure"><div id="d126e80369" class="mediaobject"><p><img src="../../examples/arduinoio/win64/IoTBasedAutomaticCoolingFanControlThingSpeakArduinoExample_01.png" alt="fancontrol-arduino-setup1.png" height="526" width="1200"></p></div></div><h3 class="title" id="IoTBasedAutomaticCoolingFanControlThingSpeakArduinoExample-3">Create ThingSpeak Channel and Add Widgets</h3><p>ThingSpeak is an IoT analytics platform service that allows you to aggregate, visualize, and analyze live data streams in the cloud. For more details, refer to <a href="https://www.mathworks.com/help/thingspeak/getting-started-with-thingspeak.html" data-docid="thingspeak_doccenter#bu36ili" class="a">Get Started with ThingSpeak</a><span role="cross_prod"> (ThingSpeak)</span>. You need to first create a new channel in ThingSpeak by defining multiple fields, which help you to collect the data and then write the analyzed data to the same channel.</p><div class="orderedlist"><ol style="list-style: decimal;"><li><p><a href="https://thingspeak.com/login" target="_blank">Sign In</a> to ThingSpeak&#8482; using your MathWorks&#174; Account credentials, or create a new account.</p></li><li><p>Click <strong class="emphasis bold">Channels</strong> &gt; <strong class="emphasis bold">MyChannels</strong>.</p></li><li><p>On the Channels page, click <strong class="emphasis bold">New Channel</strong>.</p></li><li><p>In Channel Settings, select the check boxes next to Fields 1&#8211;4. Enter these values for the field names (the unit of temperature in this example is assumed to be degrees Celsius):</p></li></ol></div><div class="itemizedlist"><ul><li><p><strong class="emphasis bold">Name</strong>: <code class="literal">Automatic Fan Control</code></p></li><li><p><strong class="emphasis bold">Field 1</strong>: <code class="literal">Temperature</code></p></li><li><p><strong class="emphasis bold">Field 2</strong>: <code class="literal">Status</code></p></li><li><p><strong class="emphasis bold">Field 3</strong>: <code class="literal">Runtime</code></p></li><li><p><strong class="emphasis bold">Field 4</strong>: <code class="literal">Overall Runtime</code></p></li></ul></div><div class="informalfigure"><div id="d126e80434" class="mediaobject"><p><img src="../../examples/arduinoio/win64/IoTBasedAutomaticCoolingFanControlThingSpeakArduinoExample_02.png" alt="add-channel-fan.png" height="524" width="542"></p></div></div><p>Click <strong class="emphasis bold">Save Channel</strong> to save the settings. The Channel Stats area of the new channel displays four charts (which correspond to the four fields that you configured). However, for this example, we use only Field 1 Chart, and use widgets for the other three fields.</p><h4 class="title" id="IoTBasedAutomaticCoolingFanControlThingSpeakArduinoExample-4">Add Widgets</h4><p>In the window that displays the saved channel (<code class="literal">Automatic Fan Control</code>), click <strong class="emphasis bold">Add Widgets</strong>, select <strong class="emphasis bold">Lamp Indicator</strong> and then click <strong class="emphasis bold">Next</strong>.</p><div class="informalfigure"><div id="d126e80459" class="mediaobject"><p><img src="../../examples/arduinoio/win64/IoTBasedAutomaticCoolingFanControlThingSpeakArduinoExample_03.png" alt="add-widgets-lampindicator.png" height="525" width="801"></p></div></div><p>Configure the widget by specifying the name as <strong class="emphasis bold">Status</strong> and by selecting <strong class="emphasis bold">Field 2</strong>.</p><div class="informalfigure"><div id="d126e80472" class="mediaobject"><p><img src="../../examples/arduinoio/win64/IoTBasedAutomaticCoolingFanControlThingSpeakArduinoExample_04.png" alt="configure-widget-status.png" height="466" width="642"></p></div></div><p>For Field 3 and Field 4, add <strong class="emphasis bold">Numeric Display</strong> widgets with the names <code class="literal">Runtime</code> and <code class="literal">Overall Runtime</code> respectively. The updated widgets look like this in the Channel Stats area.</p><div class="informalfigure"><div id="d126e80486" class="mediaobject"><p><img src="../../examples/arduinoio/win64/IoTBasedAutomaticCoolingFanControlThingSpeakArduinoExample_05.png" alt="all-widgets.png" height="718" width="1004"></p></div></div><h3 class="title" id="IoTBasedAutomaticCoolingFanControlThingSpeakArduinoExample-5">Identify API Keys in ThingSpeak</h3><p>Before you write the MATLAB code, it is required that you identify the API Keys of the ThinkSpeak channel because these will be used in the code.</p><p>To identify the API Keys, click <strong class="emphasis bold">API Keys</strong> among the options available for configuring the channel.</p><div class="informalfigure"><div id="d126e80499" class="mediaobject"><p><img src="../../examples/arduinoio/win64/IoTBasedAutomaticCoolingFanControlThingSpeakArduinoExample_06.png" alt="apikeys-channel-fancontrol.png" height="522" width="552"></p></div></div><h3 class="title" id="IoTBasedAutomaticCoolingFanControlThingSpeakArduinoExample-6">Run MATLAB Code to Obtain Temperature Data from BMP280 Sensor</h3><p>You can run the MATLAB code on the Arduino board that has BMP280 sensor connected. The MATLAB code uses channel ID and its Write API Key to publish data over IoT to the ThingSpeak channel.</p><p>The <code class="literal">bmp280</code> object in MATLAB Support Package for Arduino Hardware establishes a connection to the connected BMP280 sensor and reads the temperature data.</p><p>In this example, we use a custom MATLAB code that reads temperature data from the channel (the data which is originally obtained from the BMP280 sensor) and triggers a signal when temperature crosses a threshold, and then writes the result back to the channel.</p><p>To explore the data from the sensor and find the temperature using ThingSpeak, we use the Read API Key. After comparing the temperature against a threshold (26 degrees Celsius), we use the Write API Key to send the signal that triggers the fan control on pin D2 of Arduino board that is connected to the relay, and also to send the calculated run time values to the same channel.</p><p>Run these commands, one after the other, in the MATLAB command window (it is assumed that Arduino board is connected to COM9 port). Replace the values of ChannelID, ReadAPI and WriteAPI variables to match the actual values corresponding to your channel. In this example, we set the <code class="literal">threshold</code> to 26 degrees Celsius (you can change it, if required).</p><div class="code_responsive"><pre id="d126e80516" class="programlisting">a=arduino(<span style="color:#A020F0">'COM9'</span>,<span style="color:#A020F0">'Uno'</span>,<span style="color:#A020F0">'Libraries'</span>,<span style="color:#A020F0">'I2C'</span>)

sensorObj=bmp280(a);

<span style="color:#228B22">%Setting to trigger relay</span>
configurePin(a,<span style="color:#A020F0">'D2'</span>,<span style="color:#A020F0">'DigitalOutput'</span>);

writeDigitalPin(a,<span style="color:#A020F0">'D2'</span>,1); <span style="color:#228B22">% Writing 1 to D2 disconnects the relay switch</span>

temp=readTemperature(sensorObj);

<span style="color:#228B22">%Setting up ThingSpeak Parameters</span>
ChannelID=XXXXXXXX;
threshold=26;
ReadAPI=<span style="color:#A020F0">'XXXXXXXXXXX'</span>;
WriteAPI=<span style="color:#A020F0">'XXXXXXXXXXX'</span>;
flag=0; <span style="color:#228B22">% start/stop the timer based on this variable</span>
Runtime=0;
overallRuntime=0;
thingSpeakWrite(ChannelID,[temp,0,0,0],<span style="color:#A020F0">'WriteKey'</span>,WriteAPI,<span style="color:#A020F0">'Fields'</span>,[1,2,3,4]);
pause(1);

<span style="color:#0000FF">while</span> 1
    <span style="color:#228B22">% Read Data </span>
    temp=readTemperature(sensorObj);
    <span style="color:#0000FF">if</span> (temp&gt;threshold)
        <span style="color:#0000FF">if</span> flag==0
            tic;
            flag=1;

            <span style="color:#228B22">% Switching on the relay and turning on the fan</span>
            writeDigitalPin(a,<span style="color:#A020F0">'D2'</span>,0);

            <span style="color:#228B22">% Read previous entry</span>
            y=thingSpeakRead(ChannelID,<span style="color:#A020F0">'ReadKey'</span>,ReadAPI,<span style="color:#A020F0">'Fields'</span>,[3,4]);

            <span style="color:#228B22">%Update all the fields</span>
            thingSpeakWrite(ChannelID,[temp,1,y(1),y(2)],<span style="color:#A020F0">'WriteKey'</span>,WriteAPI,<span style="color:#A020F0">'Fields'</span>,[1,2,3,4]); 
            pause(1);
        <span style="color:#0000FF">end</span>
    <span style="color:#0000FF">else</span> 
        <span style="color:#0000FF">if</span> flag==1
            Runtime=toc;
            flag=0;

            <span style="color:#228B22">%Turn off the fan</span>
            writeDigitalPin(a,<span style="color:#A020F0">'D2'</span>,1);

            <span style="color:#228B22">% Read previous entry</span>
            x=thingSpeakRead(ChannelID,<span style="color:#A020F0">'ReadKey'</span>,ReadAPI,<span style="color:#A020F0">'Fields'</span>,4);

            <span style="color:#228B22">%Calculate overall runtime</span>
            overallRuntime = Runtime + x;
        <span style="color:#0000FF">end</span>
        <span style="color:#228B22">% Update all the fields</span>
        thingSpeakWrite(ChannelID,[temp,0,Runtime,overallRuntime],<span style="color:#A020F0">'WriteKey'</span>,WriteAPI,<span style="color:#A020F0">'Fields'</span>,[1,2,3,4]);
           
    <span style="color:#0000FF">end</span>
    pause(5);
<span style="color:#0000FF">end</span>
</pre></div><p><strong class="emphasis bold">Note</strong>: To stop the <code class="literal">while</code> loop and stop executing the code (to stop sending data to the ThingSpeak channel), press Ctrl+C in the MATLAB Command Window.</p><p>The data from BMP280 sensor is sent to the channel. You can view the <strong class="emphasis bold">Channel Stats</strong> in ThingSpeak and observe the live temperature, the status of the fan, and the runtime values. This figure shows an example of recorded data based on live temperature sent from BMP280 sensor over IoT using ThingSpeak. The figure shows the plot of temperature variation, the status of the fan (ON), and the display in the two Numeric Display widgets that you added.</p><div class="informalfigure"><div id="d126e80530" class="mediaobject"><p><img src="../../examples/arduinoio/win64/IoTBasedAutomaticCoolingFanControlThingSpeakArduinoExample_07.png" alt="channel-stats-final-fan.png" height="728" width="1196"></p></div></div><h3 class="title" id="IoTBasedAutomaticCoolingFanControlThingSpeakArduinoExample-7">Set Up Email Alert for Temperature Beyond Threshold Using ThingSpeak</h3><p>After the data from the BMP280 sensor connected to Arduino board is available in the ThinkSpeak channel, you can set up an email alert that triggers an email. The email will be sent to the email ID registered with your ThinkSpeak account, whenever the temperature exceeds a threshold.</p><p>To set up the email alert:</p><div class="orderedlist"><ol style="list-style: decimal;"><li><p>In ThingSpeak, click <strong class="emphasis bold">Apps</strong> &gt; <strong class="emphasis bold">MATLAB Analysis</strong>.</p></li><li><p>Click <strong class="emphasis bold">New</strong> to get started with your code.</p></li><li><p>Under <strong class="emphasis bold">Examples</strong>, select <strong class="emphasis bold">Read channel to trigger email</strong>, and then click <strong class="emphasis bold">Create</strong>.</p></li><li><p>In the <strong class="emphasis bold">MATLAB Code</strong> area, customize the code as shown below. Ensure that you change the values assigned to readChannelID and readAPIKey fields to match the actual values corresponding to your channel. The alertAPIKey is the one associated with your profile in ThingSpeak. After you write the code, click <strong class="emphasis bold">Save and Run</strong>.</p></li></ol></div><div class="code_responsive"><pre id="d126e80575" class="programlisting"><span style="color:#228B22">% Enter your MATLAB Code below </span>
readChannelID = XXXXXXXX;  
<span style="color:#228B22">% Temperature Field ID  </span>
TemperatureFieldID = 1;  

<span style="color:#228B22">% Channel Read API Key    </span>
<span style="color:#228B22">% If your channel is private, then enter the read API Key between the '' below:  </span>
readAPIKey = <span style="color:#A020F0">'XXXXXXXXXXXX'</span>;  

<span style="color:#228B22">% Read temperature data for the last 24 hours </span>

[tempF,timeStamp] = thingSpeakRead(readChannelID,<span style="color:#A020F0">'Fields'</span>,TemperatureFieldID, <span style="color:#0000FF">...</span><span style="color:#228B22"> </span>

                                                <span style="color:#A020F0">'numDays'</span>,1,<span style="color:#A020F0">'ReadKey'</span>,readAPIKey);  

<span style="color:#228B22">% Calculate the maximum and minimum temperatures  </span>
[maxTempF,maxTempIndex] = max(tempF);  
[minTempF,minTempIndex] = min(tempF); 
 
alertApiKey=<span style="color:#A020F0">'XXXXXXXXXXXXXXXX'</span>; 
alertURL = <span style="color:#A020F0">"https://api.thingspeak.com/alerts/send"</span>; 
options = weboptions(<span style="color:#A020F0">"HeaderFields"</span>, [<span style="color:#A020F0">"ThingSpeak-Alerts-API-Key"</span>, alertApiKey ]); 
alertBody = sprintf(<span style="color:#A020F0">"The temperature is %0.2f°F.Turning on the Fan"</span>, maxTempF); 
alertSubject = sprintf(<span style="color:#A020F0">"Temperature exceeded threshold"</span>); 
<span style="color:#0000FF">try</span> 
    webwrite(alertURL, <span style="color:#A020F0">"body"</span>, alertBody, <span style="color:#A020F0">"subject"</span>, alertSubject, options); 
<span style="color:#0000FF">catch</span> 
    <span style="color:#228B22">% Code execution will end up here when a 429 (error due to frequent request) is caught </span>
<span style="color:#0000FF">end</span> 
</pre></div><p>Next, let's set up a React app that triggers the email alert, as configured above, when the temperature exceeds 26 degrees Celsius. </p><p>To do this, click <strong class="emphasis bold">Apps</strong> &gt; <strong class="emphasis bold">Actions</strong> &gt; <strong class="emphasis bold">React</strong>, and then configure the app as shown in this image (the MATLAB Analysis app that you configured as shown above is saved with the name, <code class="literal">Alert</code>).</p><div class="informalfigure"><div id="d126e80592" class="mediaobject"><p><img src="../../examples/arduinoio/win64/IoTBasedAutomaticCoolingFanControlThingSpeakArduinoExample_08.png" alt="react-with-alert-fan.png" height="759" width="527"></p></div></div><p>Click <strong class="emphasis bold">Save React</strong>. Whenever the room temperature, as read by the BMP280 sensor, exceeds 26 degree Celsius, an email is sent to the ThingSpeak-registered email ID. This figure shows a sample email based on the <code class="literal">alertBody</code> and <code class="literal">alertSubject</code> fields that you configured in the MATLAB Analysis app.</p><div class="informalfigure"><div id="d126e80606" class="mediaobject"><p><img src="../../examples/arduinoio/win64/IoTBasedAutomaticCoolingFanControlThingSpeakArduinoExample_09.png" alt="email-alert-fancontrol.png" height="402" width="780"></p></div></div></div></section>
    </div></section><div xmlns="http://www.w3.org/1999/xhtml" class="clearfix"></div>
<div xmlns="http://www.w3.org/1999/xhtml" align="center" class="feedbackblock" id="mw_docsurvey"><script src="https://www.mathworks.com/help/docsurvey/docfeedback.js"></script>
<script>loadSurveyHidden();</script>
<link rel="stylesheet" href="https://www.mathworks.com/help/docsurvey/release/index-css.css" type="text/css">
<script src="https://www.mathworks.com/help/docsurvey/release/bundle.index.js"></script>

<script>initDocSurvey();</script></div></main>


</div>
</div>
</div>
</div><!--close_0960-->
<footer xmlns="http://www.w3.org/1999/xhtml" id="footer" class="bs-footer">
<div class="container-fluid">
<div class="footer">
<div class="row">
<div class="col-12">
<p class="copyright">© 1994-2025 The MathWorks, Inc.</p>
<ul class="footernav"><li class="footernav_help"><a href="matlab:web(matlab.internal.licenseAgreement)">Terms of Use</a></li><li class="footernav_patents"><a href="matlab:web([matlabroot '/patents.txt'])">Patents</a></li><li class="footernav_trademarks"><a href="matlab:web([matlabroot '/trademarks.txt'])">Trademarks</a></li><li class="footernav_piracy"><a href="matlab:web([docroot '/acknowledgments.html'])">Acknowledgments</a></li></ul></div>
</div>
</div>
</div>
</footer>
</div><!--close row-offcanvas-->
</div><!--close_0970-->
</body>
</html>
