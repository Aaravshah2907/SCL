<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage">
<head>
<meta xmlns="http://www.w3.org/1999/xhtml" charset="utf-8">
<meta xmlns="http://www.w3.org/1999/xhtml" name="viewport" content="width=device-width, initial-scale=1.0">
<meta xmlns="http://www.w3.org/1999/xhtml" http-equiv="X-UA-Compatible" content="IE=edge">
<title>Classify and Count Fruits Using Arduino Nano 33 BLE Sense, ThingSpeak, and Machine Learning</title>
<script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
      {
      "@context": "http://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement":
      [{
          "@type": "ListItem",
          "position": 1,

          "item": {
          "@id": "../index.html",
          "name": "MATLAB"
}

          } 
        ,
        {
          "@type": "ListItem",
          "position": 2,

          "item": {
          "@id": "../data-import-and-analysis.html",
          "name": "Data Import and Analysis"
}

          }
        ,
        {
          "@type": "ListItem",
          "position": 3,

          "item": {
          "@id": "../data-import-and-export.html",
          "name": "Data Import and Export"
}

          }
        ,
        {
          "@type": "ListItem",
          "position": 4,

          "item": {
          "@id": "../hardware-network-comm.html",
          "name": "Hardware and Network Communication"
}

          }
        ,
        {
          "@type": "ListItem",
          "position": 5,

          "item": {
          "@id": "../hardware-boards-and-kits.html",
          "name": "Hardware Boards and Kits"
}

          }
        ,
        {
          "@type": "ListItem",
          "position": 6,

          "item": {
          "@id": "../arduinoio.html",
          "name": "Arduino Hardware"
}

          }
        ,
        {
          "@type": "ListItem",
          "position": 7,

          "item": {
          "@id": "../arduinoio-sensors.html",
          "name": "Sensors"
}

          }]
      }</script><script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "ItemList",
          "name": "VisibleBreadcrumbs",

        "itemListElement":
        [
        "arduinoio-sensors"
        ],
        "itemListOrder": "http://schema.org/ItemListOrderAscending"
        }
        </script><script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "DigitalDocument",
          "headline": "Classify and Count Fruits Using Arduino Nano 33 BLE Sense, ThingSpeak, and Machine Learning",
          "description": "Collect RGB values of three types of fruits using the APDS9960 sensor embedded in an Arduino&#174; Nano 33 BLE board and use the MATLAB&#174; Classification Learner app to train a machine learning model with the RGB values to classify the fruits. This example also shows how to use the ThingSpeak&#8482; platform for tracking the number of fruits in a box and setting up an email alert if the number of any one of the three types of fruits drops to zero.",
          "thumbnailURL": "../../examples/arduinoio/win64/IoTMLFruitClassificationCountingNano33BLESenseThingSpeakExample_19.png",
          "genre": "Live Script",
          "isBasedOn": {
          "@type": "Product",
          "name": "MATLAB"

        },
          "identifier": "arduinoio.IoTMLFruitClassificationCountingNano33BLESenseThingSpeakExample",
          "name": "IoTMLFruitClassificationCountingNano33BLESenseThingSpeakExample",
          "url": "IoT-and-Machine-Learning-Based-Fruit-Classification-and-Counting-System.html"

        }</script><script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "PropertyValue",
          "name": "open_command",
          "value": "matlab:openExample('arduinoio/IoTMLFruitClassificationCountingNano33BLESenseThingSpeakExample')"

        }</script><script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "ItemList",
          "name": "ExampleSourceFiles",

        "itemListElement":
        [
        "IoTMLFruitClassificationCountingNano33BLESenseThingSpeakExample.mlx",
        "AlertApiKeyImage.png",
        "All_and_Train_ALL.png",
        "Box_of_fruits.png",
        "DataSet.png",
        "Email_alert.png",
        "ExportModel.png",
        "FinalDashBoard.png",
        "GIF_Black_reduced.gif",
        "MatlabAnalysis.png",
        "Model_suggestions.png",
        "RefillAlert.m",
        "Sensor_close_to_fruit.png",
        "ThingSpeakAPPS.png",
        "ThingSpeakChannelSettings.png",
        "ThingSpeakChannelView.png",
        "ThingSpeakKeys.png",
        "ThingSpeakMatlabCodeArea.png",
        "Training_data_variable.png",
        "Trigger.png",
        "Workspace_variable.png",
        "captureRGB.m",
        "classification_learner_app_FromWorkspace.png",
        "classification_learner_app_Toolbox.png",
        "trainedModel.mat",
        "trainedModelVariable.png",
        "ScreenAfterChosingNewButton.png"
        ],
        "itemListOrder": "http://schema.org/ItemListOrderAscending"
        }
        </script><link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/bootstrap.min.css" rel="stylesheet" type="text/css">


  <meta xmlns="http://www.w3.org/1999/xhtml" http-equiv="Content-Script-Type" content="text/javascript">
<meta xmlns="http://www.w3.org/1999/xhtml" name="toctype" itemprop="pagetype" content="ug">
<meta xmlns="http://www.w3.org/1999/xhtml" name="infotype" itemprop="infotype" content="other">

<meta xmlns="http://www.w3.org/1999/xhtml" name="description" itemprop="description" content="This example shows how to collect RGB values of three types of fruits using the APDS9960 sensor embedded in an Arduino&#174; Nano 33 BLE board and use the MATLAB&#174; Classification Learner app to train a machine learning model with the RGB values to classify the fruits."><meta xmlns="http://www.w3.org/1999/xhtml" content="../../examples/arduinoio/win64/IoTMLFruitClassificationCountingNano33BLESenseThingSpeakExample_19.png" itemprop="thumbnailUrl">
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/jquery/jquery-3.6.0.min.js"></script><script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/jquery/jquery-migrate.min.js"></script>
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6.css" rel="stylesheet" type="text/css">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_lg.css" rel="stylesheet" media="screen and (min-width: 1200px)">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_md.css" rel="stylesheet" media="screen and (min-width: 992px) and (max-width: 1199px)">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_sm+xs.css" rel="stylesheet" media="screen and (max-width: 991px)">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_sm.css" rel="stylesheet" media="screen and (min-width: 768px) and (max-width: 991px)">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_xs.css" rel="stylesheet" media="screen and (max-width: 767px)">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_offcanvas_v2.css" rel="stylesheet" type="text/css">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/shared/highlight/styles/mwdochighlight.min.css" rel="stylesheet" type="text/css">

<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/l10n.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/docscripts.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/f1help.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/docscripts.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/mw.imageanimation.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/jquery.highlight.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/underscore-min.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/use_platform_screenshots.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/suggest.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/overload.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/helpservices.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/productfilter.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/matlab_dialog_shared.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/highlight/highlight.min.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/localstorage.js"></script><script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/product_group.js"></script><script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/saxonjs/SaxonJS2.rt.js"></script><script xmlns="http://www.w3.org/1999/xhtml">
            window.history.replaceState(window.location.href, null, ""); // Initialize
            window.onload = function() {    
            mystylesheetLocation = "../../includes/shared/scripts/product_group-sef.json";
            mysourceLocation = "../../docset/docset.xml";
            product_help_location = "matlab";
            pagetype = "section";
            doccentertype = "product";
            langcode = "";
            getProductFilteredList(mystylesheetLocation, mysourceLocation, product_help_location, pagetype, doccentertype, langcode);  
            }
          </script>




<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/jquery/jquery.mobile.custom.min.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/bootstrap.bundle.min.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/global.js"></script>
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/doc_center_base.css" rel="stylesheet" type="text/css">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/doc_center_installed.css" rel="stylesheet" type="text/css">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/doc_center_print.css" rel="stylesheet" type="text/css" media="print">
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/equationrenderer/release/MathRenderer.js"></script>
</head>
<body id="responsive_offcanvas">
<div xmlns="http://www.w3.org/1999/xhtml" id="doc_header_spacer" class="header"></div>
<div xmlns="http://www.w3.org/1999/xhtml" class="section_header level_3"><div class="container-fluid"><div class="row" id="mobile_search_row"><div class="col-sm-6 col-md-7 has_horizontal_local_nav" id="section_header_title"><div class="section_header_content"><div class="section_header_title"><h1><a href="../../documentation-center.html">Help Center</a></h1></div></div></div><div class="col-12 col-sm-6 col-md-5" id="mobile_search"><div class="search_nested_content_container"><form id="docsearch_form" name="docsearch_form" method="get" data-release="R2025b" data-language="en" action="../../templates/searchresults.html"><div class="input-group tokenized_search_field"><label class="visually-hidden form-label">Search Help</label><input type="text" class="form-control conjoined_search" autocomplete="off" name="qdoc" placeholder="Search Help" id="docsearch"> <div><button type="submit" name="submitsearch" id="submitsearch" class="btn icon-search btn_search_adjacent btn_search icon_16" tabindex="-1"></button></div></div></form></div><button class="btn icon-remove btn_search float-end icon_32 d-sm-none" data-bs-toggle="collapse" href="#mobile_search" aria-expanded="false" aria-controls="mobile_search"></button></div><div class="d-sm-none" id="search_actuator"><button class="btn icon-search btn_search float-end icon_16" data-bs-toggle="collapse" href="#mobile_search" aria-expanded="false" aria-controls="mobile_search"></button></div></div></div></div><div class="row-offcanvas row-offcanvas-left">
<div xmlns="http://www.w3.org/1999/xhtml" class="sidebar-offcanvas" id="sidebar">
<nav class="offcanvas_nav" role="navigation">
<div class="offcanvas_actuator" data-bs-toggle="offcanvas" data-bs-target="#sidebar" id="nav_toggle"><button type="button" class="btn"><span class="visually-hidden">Off-Canvas Navigation Menu Toggle
                  Off-Canvas Navigation Menu Toggle</span><span class="icon-menu"></span></button><span class="offcanvas_actuator_label" id="translation_icon-menu" tabindex="-1" aria-hidden="true"></span></div><div class="nav_list_wrapper" id="nav_list_wrapper"><nav class="offcanvas_nav" role="navigation"><ul class="nav_breadcrumb" id="ul_left_nav_ancestors"><li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../../documentation-center.html?s_tid=CRUX_lftnav" itemprop="url"><span itemprop="title">Documentation Home</span></a></li></ul>
<ul class="nav_disambiguation"><li><a href="../index.html?s_tid=CRUX_lftnav" id="index">MATLAB</a>
</li>
<li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../data-import-and-analysis.html?s_tid=CRUX_lftnav" itemprop="url"><span itemprop="title">Data Import and Analysis</span></a></li><li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../data-import-and-export.html?s_tid=CRUX_lftnav" itemprop="url"><span itemprop="title">Data Import and Export</span></a></li><li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../hardware-network-comm.html?s_tid=CRUX_lftnav" itemprop="url"><span itemprop="title">Hardware and Network Communication</span></a></li><li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../hardware-boards-and-kits.html?s_tid=CRUX_lftnav" itemprop="url"><span itemprop="title">Hardware Boards and Kits</span></a></li><li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../arduinoio.html?s_tid=CRUX_lftnav" itemprop="url"><span itemprop="title">Arduino Hardware</span></a></li><li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../arduinoio-sensors.html?s_tid=CRUX_lftnav" itemprop="url" id="mw_a50129d8-52cc-41a2-a650-07e612c999b7"><span itemprop="title">Sensors</span></a></li></ul><div class="search_refine_v4"><div id="facets_area"><ul class="nav_scrollspy nav list-unstyled" id="pnav">
<li class="nav_scrollspy_function nav-item"><a href="#responsive_offcanvas">Classify and Count Fruits Using Arduino Nano 33 BLE Sense, ThingSpeak, and Machine Learning</a></li>
<li class="nav_scrollspy_title nav-item" id="SSPY810-section">On this page</li>
<!--ADD_REFENTRY_TITLE_HERE 11--><li class="nav-item"><a href="#IoTMLFruitClassificationCountingNano33BLESenseThingSpeakExample-1" class="nav-link intrnllnk">Overview</a></li><li class="nav-item"><a href="#IoTMLFruitClassificationCountingNano33BLESenseThingSpeakExample-2" class="nav-link intrnllnk">Create Data Set from RGB Values of Fruits</a></li><li class="nav-item"><a href="#IoTMLFruitClassificationCountingNano33BLESenseThingSpeakExample-3" class="nav-link intrnllnk">Export Classification Algorithm</a></li><li class="nav-item"><a href="#IoTMLFruitClassificationCountingNano33BLESenseThingSpeakExample-4" class="nav-link intrnllnk">Create ThingSpeak Channel and Add Widgets to Count Fruits</a></li><li class="nav-item"><a href="#IoTMLFruitClassificationCountingNano33BLESenseThingSpeakExample-5" class="nav-link intrnllnk">Identify API Keys in ThingSpeak</a></li><li class="nav-item"><a href="#IoTMLFruitClassificationCountingNano33BLESenseThingSpeakExample-6" class="nav-link intrnllnk">Execute MATLAB Code to Classify and Count Fruits</a></li><li class="nav-item"><a href="#IoTMLFruitClassificationCountingNano33BLESenseThingSpeakExample-7" class="nav-link intrnllnk">GIF_Black_reduced.gif</a></li><li class="nav-item"><a href="#IoTMLFruitClassificationCountingNano33BLESenseThingSpeakExample-8" class="nav-link intrnllnk">Set Up Email Alert</a></li></ul></div></div>
</nav></div></nav>
<script src="../../includes/product/scripts/offcanvas_v2.js"></script></div><!--END.CLASS sidebar-offcanvas-->
<div class="offcanvas_content_container">
<div xmlns="http://www.w3.org/1999/xhtml" class="sticky_header_container"><div class="horizontal_nav"><div class="horizontal_nav_container"><div class="offcanvas_horizontal_nav"><div class="container-fluid"><div class="row"><div class="col-sm-12 d-none d-sm-block"><nav class="navbar navbar-default" role="navigation" id="subnav"><div><ul class="nav navbar-nav crux_browse"><li id="crux_nav_documentation" class="crux_resource active">Documentation</li><li id="crux_nav_example" class="crux_resource"><a href="../examples.html?category=arduinoio-sensors&amp;s_tid=CRUX_topnav">Examples</a></li><li id="crux_nav_function" class="crux_resource"><a href="../referencelist.html?type=function&amp;category=arduinoio-sensors&amp;s_tid=CRUX_topnav">Functions</a></li><li id="crux_nav_app" class="crux_resource"><a href="../referencelist.html?type=app&amp;category=arduinoio-sensors&amp;s_tid=CRUX_topnav">Apps</a></li></ul></div></nav></div><div class="d-sm-none"><div class="container-fluid"><div class="row"><div class="col-9"><div class="mobile_crux_nav_trigger"><div class="btn-group"><button type="button" class="btn btn-default dropdown-toggle" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Resources</button><ul class="dropdown-menu"><li id="crux_nav_mobile_documentation" class="crux_resource active">Documentation</li><li id="crux_nav_mobile_example" class="crux_resource"><a href="../examples.html?category=arduinoio-sensors&amp;s_tid=CRUX_topnav">Examples</a></li><li id="crux_nav_mobile_function" class="crux_resource"><a href="../referencelist.html?type=function&amp;category=arduinoio-sensors&amp;s_tid=CRUX_topnav">Functions</a></li><li id="crux_nav_mobile_app" class="crux_resource"><a href="../referencelist.html?type=app&amp;category=arduinoio-sensors&amp;s_tid=CRUX_topnav">Apps</a></li></ul></div></div></div><div class="col-3"><div class="translate_placeholder"></div></div></div></div></div></div></div></div></div></div></div><div class="content_container" id="content_container" itemprop="content">
<div class="container-fluid">
<div class="row">
<div class="col-12">

<main id="skip_link_anchor" tabindex="-1">
<div xmlns="http://www.w3.org/1999/xhtml" id="product_info_alert"></div><section xmlns="http://www.w3.org/1999/xhtml" id="doc_center_content" lang="en" data-language="en"><div id="pgtype-topic">
<section><h1 class="r2025b" itemprop="title content" id="mw_f4487048-742c-44b9-9242-4f6dc7daea8d">Classify and Count Fruits Using Arduino Nano 33 BLE Sense, ThingSpeak, and Machine Learning</h1><div class="examples_short_list hidden_ios_android" data-products="ML ML_ARDUINO ST TSP"><div data-pane="metadata" class="card metadata_container"><div class="card-body metadata_content"><p class="add_margin_5">This example uses:</p><ul class="list-unstyled add_border_bottom example_product_list" itemprop="requiredprods"><li><a href="matlab:matlab.internal.addons.showAddon('ML_ARDUINO')">MATLAB Support Package for Arduino Hardware</a></li><li><a href="matlab:matlab.internal.addons.showAddon('ST')">Statistics and Machine Learning Toolbox</a></li><li><a href="matlab:matlab.internal.addons.showAddon('TSP')">ThingSpeak</a></li></ul><div class="d-grid"><a class="btn btn_color_blue" href="matlab:openExample('arduinoio/IoTMLFruitClassificationCountingNano33BLESenseThingSpeakExample')" data-ex-genre="Live Script">Open Live Script</a></div></div></div></div><div itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage/Example" itemprop="example" class="em_example"><meta itemprop="exampleid" content="arduinoio-IoTMLFruitClassificationCountingNano33BLESenseThingSpeakExample"><meta itemprop="exampletitle" content="Classify and Count Fruits Using Arduino Nano 33 BLE Sense, ThingSpeak, and Machine Learning"></div><span id="IoTMLFruitClassificationCountingNano33BLESenseThingSpeakExample" class="anchor_target"></span><p class="shortdesc">This example shows how to collect RGB values of three types of fruits using the APDS9960 sensor embedded in an Arduino&#174; Nano 33 BLE board and use the MATLAB&#174; <a href="../../stats/classificationlearner-app.html" data-docid="stats_ug#buggk6h" class="a">Classification Learner</a><span role="cross_prod"> (Statistics and Machine Learning Toolbox)</span> app to train a machine learning model with the RGB values to classify the fruits. This example also shows how to use the ThingSpeak&#8482; platform for tracking the number of fruits in a box and setting up an email alert if the number of any one of the three types of fruits drops to zero. </p><p>This example creates a classification and counting system for three types of fruits, namely apple, guava, and banana. </p><p>To access all the files for this example, click the <strong class="emphasis bold">Open Live Script</strong> button and download the files.</p><div class="procedure"><h3 class="title" id="IoTMLFruitClassificationCountingNano33BLESenseThingSpeakExample-1"><strong class="emphasis bold">Overview</strong><span id="mw_rtc_IoTMLFruitClassificationCountingNano33BLESenseThingSpeakExample_H_6F7DFA54" class="anchor_target"></span></h3><p>This example uses an Arduino Nano BLE 33 Sense board that you can connect to your machine using a micro USB cable. The algorithm in the example completes these steps.</p><div class="orderedlist"><ol style="list-style: decimal;"><li><p>Capture the RGB values using the Arduino Nano BLE 33 Sense board and create a data set.</p></li><li><p>Use the Classification Learner<strong class="emphasis bold"> </strong>app to determine the classification model and export the trained model. </p></li><li><p>Create a ThingsSpeak channel to track the number of fruits in a box.</p></li><li><p>Set up an email alert if the number of any one of the three types of fruits drops to zero.</p></li></ol></div><p>You can use the trained model included with this example instead of training the model on your own.  </p><p>If you are using the trained model, skip the Create Data Set from RGB Values of Fruits<strong class="emphasis bold"> </strong>and Export Classification Algorithm section.</p><h3 class="title" id="IoTMLFruitClassificationCountingNano33BLESenseThingSpeakExample-2"><strong class="emphasis bold">Create Data Set from RGB Values of Fruits </strong><span id="mw_rtc_IoTMLFruitClassificationCountingNano33BLESenseThingSpeakExample_H_487E8CDD" class="anchor_target"></span></h3><p>Place the Arduino Nano 33 BLE Sense board near the fruit for which you want to capture the RBG values. This image shows a person capturing the RBG data for an apple. </p><p>   <span class="guiicon"><span class="inlinemediaobject"><img src="../../examples/arduinoio/win64/IoTMLFruitClassificationCountingNano33BLESenseThingSpeakExample_01.png" height="208" width="424"></span></span></p><p>Download the <code class="literal">captureRGB.m</code> file by clicking the Open Live Script button. Execute the file and complete the instructions that display in the Command Window. Once you complete executing the file, you can view the <code class="literal">trainingData</code> variable of size <code class="literal">2001X3 </code>in the MATLAB workspace. Add a fourth field, <code class="literal">fruit</code>, to the <code class="literal">trainingData</code> table. Change all the entries in the column under the new field to <code class="literal">Apple</code>.</p><div class="code_responsive"><pre id="d126e70344" class="programlisting">trainingData.fruit(:) = <span style="color:#A020F0">"Apple"</span> ;
</pre></div><p>Create a training data variable for apples.</p><div class="code_responsive"><pre id="d126e70347" class="programlisting">trainingDataApple = trainingData ;
</pre></div><p>The new <code class="literal">trainingDataApple</code> variable of size <code class="literal">2001x4 is</code> now visible in the MATLAB workspace. </p><p>To capture the RGB values for bananas, execute the <code class="literal">captureRBG.m</code> file again. Create a new field called <code class="literal">Banana</code> and a training data variable for bananas.</p><div class="code_responsive"><pre id="d126e70361" class="programlisting">trainingData.fruit(:) = <span style="color:#A020F0">"Banana"</span> ;
trainingDataBanana = trainingData ;
</pre></div><p>To capture the RGB values for guavas, execute the <code class="literal">captureRBG.m</code> file again. Create a new field called <code class="literal">Guava</code> and a training data variable for guavas.</p><div class="code_responsive"><pre id="d126e70370" class="programlisting">trainingData.fruit(:) = <span style="color:#A020F0">"Guava"</span> ;
trainingDataGuava = trainingData ;
</pre></div><p>The new <code class="literal">trainingDataBanana</code> and <code class="literal">trainingDataGuava</code> variables of size <code class="literal">2001x4</code> are now visible in the MATLAB workspace. </p><p>Store the training data for the three fruits in a single variable <code class="literal">finalTrainingData</code>. The <code class="literal">finalTrainingData</code> variable must be of the size <code class="literal">6003x4.</code></p><div class="code_responsive"><pre id="d126e70387" class="programlisting">finalTrainingData = [trainingDataApple; trainingDataBanana; trainingDataGuava];
</pre></div><h3 class="title" id="IoTMLFruitClassificationCountingNano33BLESenseThingSpeakExample-3"><strong class="emphasis bold">Export Classification Algorithm</strong><span id="mw_rtc_IoTMLFruitClassificationCountingNano33BLESenseThingSpeakExample_H_851C04E9" class="anchor_target"></span></h3><p>Use the Classification Learner app to select a classification model. In the <strong class="emphasis bold">Apps</strong> tab on the MATLAB toolstrip, search for the <strong class="emphasis bold">Classification Learner </strong>app.                <span class="guiicon"><span class="inlinemediaobject"><img src="../../examples/arduinoio/win64/IoTMLFruitClassificationCountingNano33BLESenseThingSpeakExample_02.png" height="145" width="1234"></span></span></p><p>In the app, click the <strong class="emphasis bold">New Session</strong> button, and then click <strong class="emphasis bold">From Workspace</strong>.     </p><div class="informalfigure"><div id="d126e70415" class="mediaobject"><p><img src="../../examples/arduinoio/win64/IoTMLFruitClassificationCountingNano33BLESenseThingSpeakExample_03.png" height="312" width="1229"></p></div></div><p>In the <strong class="emphasis bold">Data set</strong> pane, select the training variable <code class="literal">finalTrainingData</code> and click <strong class="emphasis bold">Start Session</strong>.</p><p> <span class="guiicon"><span class="inlinemediaobject"><img src="../../examples/arduinoio/win64/IoTMLFruitClassificationCountingNano33BLESenseThingSpeakExample_04.png" height="631" width="799"></span></span></p><p>On the app toolstrip, in the Models section, click <strong class="emphasis bold">All, </strong>and in the<strong class="emphasis bold"> Train </strong>section<strong class="emphasis bold">, </strong>click <strong class="emphasis bold">Train All</strong>.</p><p><span class="guiicon"><span class="inlinemediaobject"><img src="../../examples/arduinoio/win64/IoTMLFruitClassificationCountingNano33BLESenseThingSpeakExample_05.png" height="149" width="1179"></span></span>.</p><p>The app provides you with a list of classification models and their results. For this example, select the model with highest accuracy.</p><p><span class="guiicon"><span class="inlinemediaobject"><img src="../../examples/arduinoio/win64/IoTMLFruitClassificationCountingNano33BLESenseThingSpeakExample_06.png" height="614" width="645"></span></span>                                                                                                                                      </p><p>On the app toolstrip, click <strong class="emphasis bold">Export </strong>and then click <strong class="emphasis bold">Export Model.</strong></p><div class="informalfigure"><div id="d126e70470" class="mediaobject"><p><img src="../../examples/arduinoio/win64/IoTMLFruitClassificationCountingNano33BLESenseThingSpeakExample_07.png" height="314" width="645"></p></div></div><p>Select <strong class="emphasis bold">Include the training data in the exported model</strong> and export the model.</p><div class="informalfigure"><div id="d126e70479" class="mediaobject"><p><img src="../../examples/arduinoio/win64/IoTMLFruitClassificationCountingNano33BLESenseThingSpeakExample_08.png" height="251" width="538"></p></div></div><h3 class="title" id="IoTMLFruitClassificationCountingNano33BLESenseThingSpeakExample-4"><strong class="emphasis bold">Create ThingSpeak Channel and Add Widgets to Count Fruits</strong><span id="mw_rtc_IoTMLFruitClassificationCountingNano33BLESenseThingSpeakExample_H_4BD3929C" class="anchor_target"></span></h3><p>If you are using the trained model included with this example, skip the Create Data Set from RGB Values of Fruits and Export Classification Algorithm sections and start with this section.</p><p>To download the trained model included with this example, click the <strong class="emphasis bold">Open Live Script</strong> button. To load the trained model, type this command at the MATLAB command line.</p><div class="code_responsive"><pre id="d126e70493" class="programlisting">load <span style="color:#A020F0">trainedModel.mat</span>
</pre></div><p>ThingSpeak is an IoT analytics platform service that you can use to aggregate, visualize, and analyze live data streams in the cloud. For more information, see <a href="https://www.mathworks.com/help/thingspeak/getting-started-with-thingspeak.html" data-docid="thingspeak_doccenter#bu36ili" class="a">Get Started with ThingSpeak</a><span role="cross_prod"> (ThingSpeak)</span>. </p><p>To track the number of fruits in the box using ThingSpeak&#8482;, sign in using your MathWorks&#174; Account credentials, or create a new account. Create a new channel in ThingSpeak to collect and analyze the fruit count data. To create a new channel in ThingSpeak, on the <strong class="emphasis bold">Channels</strong> tab, click <code class="literal">My Channels</code>. In the <code class="literal">My Channels</code> window, click <strong class="emphasis bold">New Channel</strong> and enter these values to customize the channel.</p><div class="orderedlist"><ol style="list-style: decimal;"><li><p><strong class="emphasis bold">Name</strong>: <code class="literal">Fruit Count</code></p></li><li><p><strong class="emphasis bold">Field 1</strong>: <code class="literal">Apple Count</code></p></li><li><p><strong class="emphasis bold">Field 2</strong>: <code class="literal">Guava Count</code></p></li><li><p><strong class="emphasis bold">Field 3</strong>: <code class="literal">Banana Count</code></p></li><li><p><strong class="emphasis bold">Field 4</strong>: <code class="literal">isEmpty</code></p></li></ol></div><p>ThingSpeak uses the<strong class="emphasis bold"> Field 4 </strong>field to track if the number of any one of the three types of fruits drops to zero.</p><p> <span class="guiicon"><span class="inlinemediaobject"><img src="../../examples/arduinoio/win64/IoTMLFruitClassificationCountingNano33BLESenseThingSpeakExample_09.png" height="705" width="1174"></span></span></p><p>Click <strong class="emphasis bold">Save Channel</strong> to save the channel settings. In the Channels window, click <strong class="emphasis bold">Add Widgets</strong> to add three numeric display widgets to track the number of fruits.</p><div class="informalfigure"><div id="d126e70562" class="mediaobject"><p><img src="../../examples/arduinoio/win64/IoTMLFruitClassificationCountingNano33BLESenseThingSpeakExample_10.png" height="823" width="1120"></p></div></div><h3 class="title" id="IoTMLFruitClassificationCountingNano33BLESenseThingSpeakExample-5"><strong class="emphasis bold">Identify API Keys in ThingSpeak</strong><span id="mw_rtc_IoTMLFruitClassificationCountingNano33BLESenseThingSpeakExample_H_DFA8A1AA" class="anchor_target"></span></h3><p>Before you write the MATLAB code to track the number of fruits, identify the API keys of the ThingSpeak channel. These keys allow you to read data from and write data to your channel.</p><p>To identify the API keys, on the <strong class="emphasis bold">Channels</strong> tab, click <strong class="emphasis bold">API Keys</strong>.</p><div class="informalfigure"><div id="d126e70580" class="mediaobject"><p><img src="../../examples/arduinoio/win64/IoTMLFruitClassificationCountingNano33BLESenseThingSpeakExample_11.png" height="507" width="345"></p></div></div><h3 class="title" id="IoTMLFruitClassificationCountingNano33BLESenseThingSpeakExample-6"><strong class="emphasis bold">Execute MATLAB Code to Classify and Count Fruits</strong><span id="mw_rtc_IoTMLFruitClassificationCountingNano33BLESenseThingSpeakExample_H_68EDD1A0" class="anchor_target"></span></h3><p>To track the number of fruits in the box, whenever you take a fruit from the box, place the fruit near the sensor. The sensor then classifies the fruit and updates the fruit count in the ThingSpeak channel.</p><p>You can execute the following MATLAB code to read RGB data from the sensor and use this data to predict the type of fruit based on a pretrained model and publish the data to ThingSpeak using the channel ID and the Write API key of the channel. Run these commands, one after another, in the MATLAB Command Window. This example assumes that the box contains 50 guavas, 40 bananas. This example also assumes that 30 apples and the Arduino board is connected to the COM14 port. </p><div class="code_responsive"><pre id="d126e70590" class="programlisting"><span style="color:#228B22">% Create the arduino object with required library</span>
arduinoObj = arduino(<span style="color:#A020F0">"COM14"</span>,<span style="color:#A020F0">"Nano33BLE"</span>,<span style="color:#A020F0">"Libraries"</span>,<span style="color:#A020F0">"APDS9960"</span>);

<span style="color:#228B22">% Create an APDS9960 object</span>
apds9960Obj = apds9960(arduinoObj, <span style="color:#A020F0">"Bus"</span>, 1, <span style="color:#A020F0">"BitRate"</span>, 100000);


<span style="color:#228B22">% Variable to track the number of apples, bananas, and guavas</span>
guavaCount = 50;
bananaCount = 40;
appleCount = 30;

<span style="color:#228B22">%the variable to track if the fruit count of one of the fruits drops to zero</span>
isEmpty = 0; 


<span style="color:#228B22">%isEmpty variable changes to 1 if the fruit count of one of the fruits drops to zero</span>
<span style="color:#0000FF">if</span>(guavaCount == 0 || bananaCount == 0 || appleCount == 0)
    isEmpty = 1;
<span style="color:#0000FF">end</span>

<span style="color:#228B22">% ThingSpeak configurations</span>
channelID = xxxxxxx;
writeAPI = <span style="color:#A020F0">'xxxxxxxxxxxxxxxx'</span>; <span style="color:#228B22">%Update this to the writeAPI key identified your Thingspeak Channels page</span>

<span style="color:#228B22">% Write the value to ThingSpeak channel</span>
thingSpeakWrite(channelID,[appleCount,guavaCount,bananaCount,isEmpty],<span style="color:#A020F0">'WriteKey'</span>,writeAPI,<span style="color:#A020F0">'Fields'</span>,[1,2,3,4]);

<span style="color:#0000FF">while</span>(1)
    <span style="color:#228B22">% Continuously read the proximity readings</span>
    proximReadings = readProximity(apds9960Obj);
    flag = 0;
    <span style="color:#0000FF">while</span>(proximReadings&gt;0.1)
        <span style="color:#0000FF">if</span>(flag == 0)
            <span style="color:#228B22">% Alert to bring the object near the sensor</span>
            disp(<span style="color:#A020F0">"Bring object near sensor"</span>);
        <span style="color:#0000FF">end</span>
        proximReadings = readProximity(apds9960Obj);
        flag = 1;
    <span style="color:#0000FF">end</span>

    <span style="color:#228B22">% Turn on the built-in LED when the object is near</span>
    writeDigitalPin(arduinoObj, <span style="color:#A020F0">'D13'</span>, 1);

    <span style="color:#228B22">% Read the RGB value from apds9960</span>
    colorData = readColor(apds9960Obj);

    <span style="color:#228B22">% Convert colorData to table format</span>
    colorDataInTableFormat = array2table(colorData);

    <span style="color:#228B22">% Call predict function</span>
    [predictedFruit,scores] = trainedModel.predictFcn(colorDataInTableFormat);
    message = [<span style="color:#A020F0">"The object detected is "</span>,predictedFruit];
    disp(message);

    <span style="color:#228B22">% Update the fruit count according to the prediction</span>
    <span style="color:#0000FF">if</span>(predictedFruit==<span style="color:#A020F0">"Apple"</span>)
        appleCount = appleCount-1;
    <span style="color:#0000FF">elseif</span>(predictedFruit==<span style="color:#A020F0">"Banana"</span>)
        bananaCount = bananaCount-1;
    <span style="color:#0000FF">elseif</span>(predictedFruit==<span style="color:#A020F0">"Guava"</span>)
        guavaCount = guavaCount-1;
    <span style="color:#0000FF">end</span>
   
    <span style="color:#0000FF">while</span>(proximReadings &lt;0.1)
        proximReadings = readProximity(apds9960Obj);
    <span style="color:#0000FF">end</span>

    <span style="color:#0000FF">if</span>(guavaCount == 0 || bananaCount == 0 || appleCount == 0)
      isEmpty = 1;
    <span style="color:#0000FF">end</span>

    <span style="color:#228B22">% Turn off the LED</span>
    writeDigitalPin(arduinoObj, <span style="color:#A020F0">'D13'</span>, 0);

    <span style="color:#228B22">% Write data to ThingSpeak channel</span>
    thingSpeakWrite(channelID,[appleCount,guavaCount,bananaCount,isEmpty],<span style="color:#A020F0">'WriteKey'</span>,writeAPI,<span style="color:#A020F0">'Fields'</span>,[1,2,3,4]);

    
<span style="color:#0000FF">end</span>
</pre></div><p>This GIF shows the channel dashboard when you remove one fruit from the box.</p><h3 class="title" id="IoTMLFruitClassificationCountingNano33BLESenseThingSpeakExample-7"><div class="informalfigure"><div id="d126e70596" class="mediaobject"><p><img src="../../examples/arduinoio/win64/IoTMLFruitClassificationCountingNano33BLESenseThingSpeakExample_12.gif" alt="GIF_Black_reduced.gif" height="309" width="1111"></p></div></div><span id="mw_rtc_IoTMLFruitClassificationCountingNano33BLESenseThingSpeakExample_H_FA15EE56" class="anchor_target"></span></h3><h3 class="title" id="IoTMLFruitClassificationCountingNano33BLESenseThingSpeakExample-8"><strong class="emphasis bold">Set Up Email Alert</strong><span id="mw_rtc_IoTMLFruitClassificationCountingNano33BLESenseThingSpeakExample_H_3516F904" class="anchor_target"></span></h3><p>Configure ThingSpeak to alert you via email if the number of any one of the three types of fruits drops to zero. ThingSpeak sends the email to the email address associated with your ThingSpeak account.</p><p>To set up the email alert, on the <strong class="emphasis bold">Apps</strong> tab on the ThingSpeak toolstrip, click <code class="literal">MATLAB Analysis</code>.</p><p> <span class="guiicon"><span class="inlinemediaobject"><img src="../../examples/arduinoio/win64/IoTMLFruitClassificationCountingNano33BLESenseThingSpeakExample_13.png" height="250" width="718"></span></span></p><p>Click <strong class="emphasis bold">New</strong> to select a code template.</p><div class="informalfigure"><div id="d126e70626" class="mediaobject"><p><img src="../../examples/arduinoio/win64/IoTMLFruitClassificationCountingNano33BLESenseThingSpeakExample_14.png" height="170" width="530"></p></div></div><p>Select the <code class="literal">Custom (no starter code)</code> option and then click <strong class="emphasis bold">Create</strong> to create the template. </p><div class="informalfigure"><div id="d126e70637" class="mediaobject"><p><img src="../../examples/arduinoio/win64/IoTMLFruitClassificationCountingNano33BLESenseThingSpeakExample_15.png" height="473" width="355"></p></div></div><p>Set the <strong class="emphasis bold">Name</strong> to <code class="literal">RefillAlert</code> and enter the code in the <strong class="emphasis bold">MATLAB Code</strong> window or copy the sample code from the<strong class="emphasis bold"> </strong><code class="literal">RefillAlert.m</code><strong class="emphasis bold"> </strong>file<strong class="emphasis bold"> </strong>provided with this example. To access the <code class="literal">RefillAlert.m </code>file, click the <strong class="emphasis bold">Open Live Script</strong> button and download the file.</p><p> <span class="guiicon"><span class="inlinemediaobject"><img src="../../examples/arduinoio/win64/IoTMLFruitClassificationCountingNano33BLESenseThingSpeakExample_16.png" height="975" width="641"></span></span></p><p>Specify the channel ID, <strong class="emphasis bold">Read API</strong> key, and <strong class="emphasis bold">Alerts API</strong> key corresponding to your channel in code. You can access the alerts key from your ThingSpeak profile page.</p><div class="informalfigure"><div id="d126e70681" class="mediaobject"><p><img src="../../examples/arduinoio/win64/IoTMLFruitClassificationCountingNano33BLESenseThingSpeakExample_17.png" height="360" width="363"></p></div></div><p>To set up an email alert for when the number of any one of the three types of fruits drops to zero, on the <strong class="emphasis bold">Apps</strong> tab in ThingSpeak, click <strong class="emphasis bold">Actions</strong>, and then click <strong class="emphasis bold">React. </strong>In the React window, set these parameters.</p><div class="itemizedlist"><ul><li><p><strong class="emphasis bold">React Name</strong><strong class="emphasis bold"> </strong>&#8212; Enter a unique name for your alert. For this example, set it to <code class="literal">Fruit Empty Trigger</code>.</p></li><li><p><strong class="emphasis bold">Condition Type</strong> &#8212; Select <code class="literal">Numeric.</code></p></li><li><p><strong class="emphasis bold">Test Frequency</strong><strong class="emphasis bold"> </strong>&#8212; Select <code class="literal">On Data Insertion</code>.</p></li><li><p><strong class="emphasis bold">Condition </strong>&#8212; Select the name of your channel and the field and set the condition for your alert. In this example, select field <code class="literal">4 (isEmpty) </code>and<code class="literal"> </code>set the condition to <code class="literal">is equal to 1.</code></p></li><li><p><strong class="emphasis bold">Action</strong> &#8212; Select <strong class="emphasis bold">MATLAB Analysis</strong>.<strong class="emphasis bold"> </strong>In the <strong class="emphasis bold">code to execute</strong><strong class="emphasis bold"> </strong>list, select the name of the MATLAB file where you stored the analysis code. For this example, select Refill<code class="literal">Alert.</code></p></li><li><p><strong class="emphasis bold">Options </strong>&#8212; Select <code class="literal">Run action only the first time the condition is met</code>.</p></li></ul></div><p> Click <strong class="emphasis bold">Save React </strong>to save your alert.</p><p> <span class="guiicon"><span class="inlinemediaobject"><img src="../../examples/arduinoio/win64/IoTMLFruitClassificationCountingNano33BLESenseThingSpeakExample_18.png" height="625" width="357"></span></span></p><p>When the number of any one of the three types of fruits drops to zero, ThingSpeak sends an email to the registered email address. This is an image of a sample email sent by ThingSpeak. </p><div class="informalfigure"><div id="d126e70767" class="mediaobject"><p><img src="../../examples/arduinoio/win64/IoTMLFruitClassificationCountingNano33BLESenseThingSpeakExample_19.png" height="244" width="517"></p></div></div></div></section>
    </div></section><div xmlns="http://www.w3.org/1999/xhtml" class="clearfix"></div>
<div xmlns="http://www.w3.org/1999/xhtml" align="center" class="feedbackblock" id="mw_docsurvey"><script src="https://www.mathworks.com/help/docsurvey/docfeedback.js"></script>
<script>loadSurveyHidden();</script>
<link rel="stylesheet" href="https://www.mathworks.com/help/docsurvey/release/index-css.css" type="text/css">
<script src="https://www.mathworks.com/help/docsurvey/release/bundle.index.js"></script>

<script>initDocSurvey();</script></div></main>


</div>
</div>
</div>
</div><!--close_0960-->
<footer xmlns="http://www.w3.org/1999/xhtml" id="footer" class="bs-footer">
<div class="container-fluid">
<div class="footer">
<div class="row">
<div class="col-12">
<p class="copyright">Â© 1994-2025 The MathWorks, Inc.</p>
<ul class="footernav"><li class="footernav_help"><a href="matlab:web(matlab.internal.licenseAgreement)">Terms of Use</a></li><li class="footernav_patents"><a href="matlab:web([matlabroot '/patents.txt'])">Patents</a></li><li class="footernav_trademarks"><a href="matlab:web([matlabroot '/trademarks.txt'])">Trademarks</a></li><li class="footernav_piracy"><a href="matlab:web([docroot '/acknowledgments.html'])">Acknowledgments</a></li></ul></div>
</div>
</div>
</div>
</footer>
</div><!--close row-offcanvas-->
</div><!--close_0970-->
</body>
</html>
