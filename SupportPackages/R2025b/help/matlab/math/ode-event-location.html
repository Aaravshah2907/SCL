<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage">
<head>
<meta xmlns="http://www.w3.org/1999/xhtml" charset="utf-8">
<meta xmlns="http://www.w3.org/1999/xhtml" name="viewport" content="width=device-width, initial-scale=1.0">
<meta xmlns="http://www.w3.org/1999/xhtml" http-equiv="X-UA-Compatible" content="IE=edge">
<title>ODE Event Location</title>
<script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
      {
      "@context": "http://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement":
      [{
          "@type": "ListItem",
          "position": 1,

          "item": {
          "@id": "../index.html",
          "name": "MATLAB"
}

          } 
        ,
        {
          "@type": "ListItem",
          "position": 2,

          "item": {
          "@id": "../mathematics.html",
          "name": "Mathematics"
}

          }
        ,
        {
          "@type": "ListItem",
          "position": 3,

          "item": {
          "@id": "../numerical-integration-and-differential-equations.html",
          "name": "Numerical Integration and Differential Equations"
}

          }
        ,
        {
          "@type": "ListItem",
          "position": 4,

          "item": {
          "@id": "../ordinary-differential-equations.html",
          "name": "Ordinary Differential Equations"
}

          }]
      }</script><script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "ItemList",
          "name": "VisibleBreadcrumbs",

        "itemListElement":
        [
        "ordinary-differential-equations"
        ],
        "itemListOrder": "http://schema.org/ItemListOrderAscending"
        }
        </script><link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/bootstrap.min.css" rel="stylesheet" type="text/css">


  <meta xmlns="http://www.w3.org/1999/xhtml" http-equiv="Content-Script-Type" content="text/javascript">
<meta xmlns="http://www.w3.org/1999/xhtml" name="toctype" itemprop="pagetype" content="ug">
<meta xmlns="http://www.w3.org/1999/xhtml" name="infotype" itemprop="infotype" content="ex">

<meta xmlns="http://www.w3.org/1999/xhtml" name="description" itemprop="description" content="Detect events during solution of ODE."><script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/jquery/jquery-3.6.0.min.js"></script><script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/jquery/jquery-migrate.min.js"></script>
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6.css" rel="stylesheet" type="text/css">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_lg.css" rel="stylesheet" media="screen and (min-width: 1200px)">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_md.css" rel="stylesheet" media="screen and (min-width: 992px) and (max-width: 1199px)">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_sm+xs.css" rel="stylesheet" media="screen and (max-width: 991px)">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_sm.css" rel="stylesheet" media="screen and (min-width: 768px) and (max-width: 991px)">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_xs.css" rel="stylesheet" media="screen and (max-width: 767px)">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_offcanvas_v2.css" rel="stylesheet" type="text/css">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/shared/highlight/styles/mwdochighlight.min.css" rel="stylesheet" type="text/css">

<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/l10n.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/docscripts.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/f1help.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/docscripts.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/mw.imageanimation.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/jquery.highlight.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/underscore-min.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/use_platform_screenshots.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/suggest.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/overload.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/helpservices.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/productfilter.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/matlab_dialog_shared.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/highlight/highlight.min.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/localstorage.js"></script><script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/product_group.js"></script><script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/saxonjs/SaxonJS2.rt.js"></script><script xmlns="http://www.w3.org/1999/xhtml">
            window.history.replaceState(window.location.href, null, ""); // Initialize
            window.onload = function() {    
            mystylesheetLocation = "../../includes/shared/scripts/product_group-sef.json";
            mysourceLocation = "../../docset/docset.xml";
            product_help_location = "matlab";
            pagetype = "section";
            doccentertype = "product";
            langcode = "";
            getProductFilteredList(mystylesheetLocation, mysourceLocation, product_help_location, pagetype, doccentertype, langcode);  
            }
          </script>




<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/jquery/jquery.mobile.custom.min.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/bootstrap.bundle.min.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/global.js"></script>
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/doc_center_base.css" rel="stylesheet" type="text/css">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/doc_center_installed.css" rel="stylesheet" type="text/css">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/doc_center_print.css" rel="stylesheet" type="text/css" media="print">
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/equationrenderer/release/MathRenderer.js"></script>
</head>
<body id="responsive_offcanvas">
<div xmlns="http://www.w3.org/1999/xhtml" id="doc_header_spacer" class="header"></div>
<div xmlns="http://www.w3.org/1999/xhtml" class="section_header level_3"><div class="container-fluid"><div class="row" id="mobile_search_row"><div class="col-sm-6 col-md-7 has_horizontal_local_nav" id="section_header_title"><div class="section_header_content"><div class="section_header_title"><h1><a href="../../documentation-center.html">Help Center</a></h1></div></div></div><div class="col-12 col-sm-6 col-md-5" id="mobile_search"><div class="search_nested_content_container"><form id="docsearch_form" name="docsearch_form" method="get" data-release="R2025b" data-language="en" action="../../templates/searchresults.html"><div class="input-group tokenized_search_field"><label class="visually-hidden form-label">Search Help</label><input type="text" class="form-control conjoined_search" autocomplete="off" name="qdoc" placeholder="Search Help" id="docsearch"> <div><button type="submit" name="submitsearch" id="submitsearch" class="btn icon-search btn_search_adjacent btn_search icon_16" tabindex="-1"></button></div></div></form></div><button class="btn icon-remove btn_search float-end icon_32 d-sm-none" data-bs-toggle="collapse" href="#mobile_search" aria-expanded="false" aria-controls="mobile_search"></button></div><div class="d-sm-none" id="search_actuator"><button class="btn icon-search btn_search float-end icon_16" data-bs-toggle="collapse" href="#mobile_search" aria-expanded="false" aria-controls="mobile_search"></button></div></div></div></div><div class="row-offcanvas row-offcanvas-left">
<div xmlns="http://www.w3.org/1999/xhtml" class="sidebar-offcanvas" id="sidebar">
<nav class="offcanvas_nav" role="navigation">
<div class="offcanvas_actuator" data-bs-toggle="offcanvas" data-bs-target="#sidebar" id="nav_toggle"><button type="button" class="btn"><span class="visually-hidden">Off-Canvas Navigation Menu Toggle
                  Off-Canvas Navigation Menu Toggle</span><span class="icon-menu"></span></button><span class="offcanvas_actuator_label" id="translation_icon-menu" tabindex="-1" aria-hidden="true"></span></div><div class="nav_list_wrapper" id="nav_list_wrapper"><nav class="offcanvas_nav" role="navigation"><ul class="nav_breadcrumb" id="ul_left_nav_ancestors"><li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../../documentation-center.html?s_tid=CRUX_lftnav" itemprop="url"><span itemprop="title">Documentation Home</span></a></li></ul>
<ul class="nav_disambiguation"><li><a href="../index.html?s_tid=CRUX_lftnav" id="index">MATLAB</a>
</li>
<li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../mathematics.html?s_tid=CRUX_lftnav" itemprop="url"><span itemprop="title">Mathematics</span></a></li><li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../numerical-integration-and-differential-equations.html?s_tid=CRUX_lftnav" itemprop="url"><span itemprop="title">Numerical Integration and Differential Equations</span></a></li><li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../ordinary-differential-equations.html?s_tid=CRUX_lftnav" itemprop="url" id="ordinary-differential-equations"><span itemprop="title">Ordinary Differential Equations</span></a></li></ul><div class="search_refine_v4"><div id="facets_area"><ul class="nav_scrollspy nav list-unstyled" id="pnav">
<li class="nav_scrollspy_function nav-item"><a href="#responsive_offcanvas">ODE Event Location</a></li>
<li class="nav_scrollspy_title nav-item" id="SSPY810-section">On this page</li>
<!--ADD_REFENTRY_TITLE_HERE 11--><li class="nav-item"><a href="#bu7wfrc" class="nav-link intrnllnk">What is Event Location?</a></li><li class="nav-item"><a href="#bu7wfry" class="nav-link intrnllnk">Writing an Event Function</a></li><li class="nav-item"><a href="#bu7whm8" class="nav-link intrnllnk">Event Information</a></li><li class="nav-item"><a href="#bu7whe8" class="nav-link intrnllnk">Limitations</a></li><li class="nav-item"><a href="#bu7wjcg" class="nav-link intrnllnk">Simple Event Location: A Bouncing Ball</a></li><li class="nav-item"><a href="#bu1yk16" class="nav-link intrnllnk">Advanced Event Location: Restricted Three Body Problem</a></li><li class="nav-item"><a href="#d126e30533" class="nav-link intrnllnk">See Also</a></li></ul></div></div>
</nav></div></nav>
<script src="../../includes/product/scripts/offcanvas_v2.js"></script></div><!--END.CLASS sidebar-offcanvas-->
<div class="offcanvas_content_container">
<div xmlns="http://www.w3.org/1999/xhtml" class="sticky_header_container"><div class="horizontal_nav"><div class="horizontal_nav_container"><div class="offcanvas_horizontal_nav"><div class="container-fluid"><div class="row"><div class="col-sm-12 d-none d-sm-block"><nav class="navbar navbar-default" role="navigation" id="subnav"><div><ul class="nav navbar-nav crux_browse"><li id="crux_nav_documentation" class="crux_resource active">Documentation</li><li id="crux_nav_example" class="crux_resource"><a href="../examples.html?category=ordinary-differential-equations&amp;s_tid=CRUX_topnav">Examples</a></li><li id="crux_nav_function" class="crux_resource"><a href="../referencelist.html?type=function&amp;category=ordinary-differential-equations&amp;s_tid=CRUX_topnav">Functions</a></li><li id="crux_nav_app" class="crux_resource"><a href="../referencelist.html?type=app&amp;category=ordinary-differential-equations&amp;s_tid=CRUX_topnav">Apps</a></li></ul></div></nav></div><div class="d-sm-none"><div class="container-fluid"><div class="row"><div class="col-9"><div class="mobile_crux_nav_trigger"><div class="btn-group"><button type="button" class="btn btn-default dropdown-toggle" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Resources</button><ul class="dropdown-menu"><li id="crux_nav_mobile_documentation" class="crux_resource active">Documentation</li><li id="crux_nav_mobile_example" class="crux_resource"><a href="../examples.html?category=ordinary-differential-equations&amp;s_tid=CRUX_topnav">Examples</a></li><li id="crux_nav_mobile_function" class="crux_resource"><a href="../referencelist.html?type=function&amp;category=ordinary-differential-equations&amp;s_tid=CRUX_topnav">Functions</a></li><li id="crux_nav_mobile_app" class="crux_resource"><a href="../referencelist.html?type=app&amp;category=ordinary-differential-equations&amp;s_tid=CRUX_topnav">Apps</a></li></ul></div></div></div><div class="col-3"><div class="translate_placeholder"></div></div></div></div></div></div></div></div></div></div></div><div class="content_container" id="content_container" itemprop="content">
<div class="container-fluid">
<div class="row">
<div class="col-12">

<main id="skip_link_anchor" tabindex="-1">
<div xmlns="http://www.w3.org/1999/xhtml" id="product_info_alert"></div><section xmlns="http://www.w3.org/1999/xhtml" id="doc_center_content" lang="en" data-language="en"><div id="pgtype-topic">
<section><h2 class="title r2025b" itemprop="title content" id="bu1mo4r-1">ODE Event Location</h2><span id="MATLAB_HELP_EVENTS" class="anchor_target"></span><p>This topic describes how to detect events while solving an ODE using solver functions
                (<code class="function">ode45</code>, <code class="function">ode15s</code>, and so on).</p><section><h3 class="title" id="bu7wfrc">What is Event Location?</h3><p>Part of the difficulty in solving some systems of ODEs is determining an
                appropriate time to stop the solution. The final time in the interval of integration
                might be defined by a specific event and not by a number. An example is an apple
                falling from a tree. The ODE solver should stop once the apple hits the ground, but
                you might not know when that event would occur beforehand. Similarly, some problems
                involve events that do not terminate the solution. An example is a moon orbiting a
                planet. In this case you might not want to stop the integration early, but you still
                want to detect each time the moon completes one period around the larger
                body.</p><p>Use event functions to detect when certain events occur during the solution of an
                ODE. Event functions take an expression that you specify, and detect an event when
                that expression is equal to zero. They can also signal the ODE solver to halt
                integration when they detect an event.</p></section><section><h3 class="title" id="bu7wfry">Writing an Event Function</h3><p>Use the <code class="literal">'Events'</code> option of the <a href="../ref/odeset.html"><code class="function">odeset</code></a> function to specify an event function. The event function
                must have the general form</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>[value,isterminal,direction] = myEventsFcn(t,y)</pre></div></div></div><p>In the case of <code class="function">ode15i</code>, the event function must also accept a
                third input argument for <code class="literal">yp</code>.</p><p>The output arguments <code class="literal">value</code>, <code class="literal">isterminal</code>, and
                    <code class="literal">direction</code> are vectors whose <code class="literal">i</code>th element
                corresponds to the <code class="literal">i</code>th event:</p><div class="itemizedlist"><ul><li><p><code class="literal">value(i)</code> is a mathematical expression describing the
                            <code class="literal">i</code>th event. An event occurs when
                            <code class="literal">value(i)</code> is equal to zero.</p></li><li><p><code class="literal">isterminal(i) = 1</code> if the integration is to terminate
                        when the <code class="literal">i</code>th event occurs. Otherwise, it is
                            <code class="literal">0</code>.</p></li><li><p><code class="literal">direction(i) = 0</code> if all zeros are to be located (the
                        default). A value of <code class="literal">+1</code> locates only zeros where the
                        event function is increasing, and <code class="literal remove_text_wrapping">-1</code> locates only zeros
                        where the event function is decreasing. Specify <code class="literal">direction =
                            []</code> to use the default value of <code class="literal">0</code> for all
                        events.</p></li></ul></div><p>Again, consider the case of an apple falling from a tree. The ODE that represents
                the falling body is</p><div id="d126e30307" class="mediaobject"><div class="code_responsive"><p class="programlistingindent"><math xmlns="http://www.w3.org/1998/Math/MathML" altimg-valign="-7px" display="block"><mrow><mi>y</mi><mo>'</mo><mo>'</mo><mo>=</mo><mo>−</mo><mn>1</mn><mo>+</mo><mi>y</mi><msup><mo>'</mo><mrow><mtext> </mtext><mn>2</mn></mrow></msup><mtext> </mtext><mo>,</mo></mrow></math></p></div></div><p>with the initial conditions <span class="inlineequation"><span class="inlinemediaobject"><math xmlns="http://www.w3.org/1998/Math/MathML" altimg-valign="-8px" display="block"><mrow><mi>y</mi><mrow><mo>(</mo><mn>0</mn><mo>)</mo></mrow><mo>=</mo><mn>1</mn></mrow></math></span></span> and <span class="inlineequation"><span class="inlinemediaobject"><math xmlns="http://www.w3.org/1998/Math/MathML" altimg-valign="-8px" display="block"><mrow><mi>y</mi><mo>'</mo><mrow><mo>(</mo><mn>0</mn><mo>)</mo></mrow><mo>=</mo><mn>0</mn></mrow></math></span></span>. You can use an event function to determine when <span class="inlineequation"><span class="inlinemediaobject"><math xmlns="http://www.w3.org/1998/Math/MathML" altimg-valign="-8px" display="block"><mrow><mi>y</mi><mrow><mo>(</mo><mi>t</mi><mo>)</mo></mrow><mo>=</mo><mn>0</mn></mrow></math></span></span>, which is when the apple hits the ground. For this problem, an
                event function that detects when the apple hits the ground is</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre><span style="color:#0000FF">function</span> [position,isterminal,direction] = appleEventsFcn(t,y)
  position = y(1); <span style="color:#228B22">% The value that we want to be zero</span>
  isterminal = 1;  <span style="color:#228B22">% Halt integration </span>
  direction = 0;   <span style="color:#228B22">% The zero can be approached from either direction</span>
<span style="color:#0000FF">end</span></pre></div></div></div></section><section><h3 class="title" id="bu7whm8">Event Information</h3><p>If you specify an events function, then call the ODE solver with three extra
                output arguments, as</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>[t,y,te,ye,ie] = odeXY(odefun,tspan,y0,options)</pre></div></div></div><p>The three additional outputs returned by the solver correspond to the detected
                events:</p><div class="itemizedlist"><ul><li><p><code class="literal">te</code> is a column vector of the times at which events
                        occurred.</p></li><li><p><code class="literal">ye</code> contains the solution value at each of the event
                        times in <code class="literal">te</code>.</p></li><li><p><code class="literal">ie</code> contains indices into the vector returned by the
                        event function. The values indicate which event the solver detected.</p></li></ul></div><p>Alternatively, you can call the solver with a single output, as</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>sol = odeXY(odefun,tspan,y0,options)</pre></div></div></div><p>In this case, the event information is stored in the structure as
                    <code class="literal">sol.te</code>, <code class="literal">sol.ye</code>, and
                    <code class="literal">sol.ie</code>.</p></section><section><h3 class="title" id="bu7whe8">Limitations</h3><p>The root-finding mechanism employed by the ODE solver in conjunction with the
                event function has these limitations:</p><div class="itemizedlist"><ul><li><p>If a terminal event occurs during the first step of the integration, then
                        the solver registers the event as nonterminal and continues
                        integrating.</p></li><li><p>If more than one terminal event occurs during the first step, then only
                        the first event registers and the solver continues integrating.</p></li><li><p>Zeros are determined by sign crossings between steps. Therefore, zeros of
                        functions with an even number of crossings between steps can be
                        missed.</p></li></ul></div><p>If the solver steps past events, try reducing <code class="literal">RelTol</code> and
                    <code class="literal">AbsTol</code> to improve accuracy. Alternatively, set
                    <code class="literal">MaxStep</code> to place an upper bound on the step size. Adjusting
                    <code class="literal">tspan</code> does not change the steps taken by the solver.</p></section><section><h3 class="title" id="bu7wjcg">Simple Event Location: A Bouncing Ball</h3><div class="examples_short_list hidden_ios_android" data-products="ML"><div data-pane="metadata" class="card metadata_container"><div class="card-body metadata_content"><div class="d-grid"><a class="btn btn_color_blue" href="matlab:openExample('matlab/SimpleEventLocationABouncingBallExample')" data-ex-genre="Script">Open Script</a></div></div></div></div><script type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "DigitalDocument",
          "headline": "Simple Event Location: A Bouncing Ball",
          "description": "Write a simple event function for use with an ODE solver. The example file ballode models the motion of a bouncing ball. The events function halts the integration each time the ball bounces, and the integration then restarts with new initial conditions. As the ball bounces, the integration stops and restarts several times.",
          "thumbnailURL": "../../examples/matlab/win64/SimpleEventLocationABouncingBallExample_01.png",
          "genre": "Script",
          "isBasedOn": {
          "@type": "Product",
          "name": "MATLAB"

        },
          "isPartOf": {
          "@type": "CreativeWork",
          "url": "ode-event-location.html"

        },
          "identifier": "matlab.SimpleEventLocationABouncingBallExample",
          "name": "SimpleEventLocationABouncingBallExample",
          "url": "ode-event-location.html#bu7wjcg"

        }</script><script type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "PropertyValue",
          "name": "open_command",
          "value": "matlab:openExample('matlab/SimpleEventLocationABouncingBallExample')"

        }</script><script type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "ItemList",
          "name": "ExampleSourceFiles",

        "itemListElement":
        [
        "SimpleEventLocationABouncingBallExample.m",
        "bounceEvents.m"
        ],
        "itemListOrder": "http://schema.org/ItemListOrderAscending"
        }
        </script><div itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage/Example" itemprop="example" class="em_example"><meta itemprop="exampleid" content="matlab-SimpleEventLocationABouncingBallExample"><meta itemprop="exampletitle" content="Simple Event Location: A Bouncing Ball"></div><span id="SimpleEventLocationABouncingBallExample" class="anchor_target"></span>



<p class="shortdesc">This example shows how to write a simple event function for use with an ODE solver. The example file <code class="literal">ballode</code> models the motion of a bouncing ball. The events function halts the integration each time the ball bounces, and the integration then restarts with new initial conditions. As the ball bounces, the integration stops and restarts several times.</p>


<div class="procedure"><p>The equations for the bouncing ball are</p><p>
<span class="inlineequation"><span class="inlinemediaobject"><img src="../../examples/matlab/win64/SimpleEventLocationABouncingBallExample_eq13777444723527878236.png" alt="$$\begin{array}{cl} y'_1 &amp;#38;= y_2\\ y'_2 &amp;#38;= -9.8 . \end{array}$$"></span></span></p><p>A ball bounce occurs when the height of the ball <span class="inlineequation"><span class="inlinemediaobject"><img src="../../examples/matlab/win64/SimpleEventLocationABouncingBallExample_eq12483773744067418790.png" alt="$y_1(t)$"></span></span> is equal to zero after decreasing. An events function that codes this behavior is</p><div class="code_responsive"><pre id="d126e30437" class="programlisting">
<span style="color:#0000FF">function</span> [value,isterminal,direction] = bounceEvents(t,y)
value = y(1);     <span style="color:#228B22">% Detect height = 0</span>
isterminal = 1;   <span style="color:#228B22">% Stop the integration</span>
direction = -1;   <span style="color:#228B22">% Negative direction only</span>

</pre></div><p>Type <code class="literal">ballode</code> to run the example and illustrate the use of an events function to simulate the bouncing of a ball.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>ballode
</pre></div></div></div><div class="informalfigure"><div id="d126e30446" class="mediaobject"><p><img src="../../examples/matlab/win64/SimpleEventLocationABouncingBallExample_01.png"></p></div></div></div></section><section><h3 class="title" id="bu1yk16">Advanced Event Location: Restricted Three Body Problem</h3><div class="examples_short_list hidden_ios_android" data-products="ML"><div data-pane="metadata" class="card metadata_container"><div class="card-body metadata_content"><div class="d-grid"><a class="btn btn_color_blue" href="matlab:openExample('matlab/AdvancedEventLocationRestrictedThreeBodyProblemExample')" data-ex-genre="Script">Open Script</a></div></div></div></div><script type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "DigitalDocument",
          "headline": "Advanced Event Location: Restricted Three Body Problem",
          "description": "Use the directional components of an event function. The example file orbitode simulates a restricted three body problem where one body is orbiting two much larger bodies. The events function determines the points in the orbit where the orbiting body is closest and farthest away. Since the value of the events function is the same at the closest and farthest points of the orbit, the direction of zero crossing is what distinguishes them.",
          "thumbnailURL": "../../examples/matlab/win64/AdvancedEventLocationRestrictedThreeBodyProblemExample_02.png",
          "genre": "Script",
          "isBasedOn": {
          "@type": "Product",
          "name": "MATLAB"

        },
          "isPartOf": {
          "@type": "CreativeWork",
          "url": "ode-event-location.html"

        },
          "identifier": "matlab.AdvancedEventLocationRestrictedThreeBodyProblemExample",
          "name": "AdvancedEventLocationRestrictedThreeBodyProblemExample",
          "url": "ode-event-location.html#bu1yk16"

        }</script><script type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "PropertyValue",
          "name": "open_command",
          "value": "matlab:openExample('matlab/AdvancedEventLocationRestrictedThreeBodyProblemExample')"

        }</script><script type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "ItemList",
          "name": "ExampleSourceFiles",

        "itemListElement":
        [
        "AdvancedEventLocationRestrictedThreeBodyProblemExample.m",
        "orbitEvents.m"
        ],
        "itemListOrder": "http://schema.org/ItemListOrderAscending"
        }
        </script><div itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage/Example" itemprop="example" class="em_example"><meta itemprop="exampleid" content="matlab-AdvancedEventLocationRestrictedThreeBodyProblemExample"><meta itemprop="exampletitle" content="Advanced Event Location: Restricted Three Body Problem"></div><span id="AdvancedEventLocationRestrictedThreeBodyProblemExample" class="anchor_target"></span>



<p class="shortdesc">This example shows how to use the directional components of an event function. The example file <code class="literal">orbitode</code> simulates a restricted three body problem where one body is orbiting two much larger bodies. The events function determines the points in the orbit where the orbiting body is closest and farthest away. Since the value of the events function is the same at the closest and farthest points of the orbit, the direction of zero crossing is what distinguishes them.</p>


<div class="procedure"><p>The equations for the restricted three body problem are</p><p>
<span class="inlineequation"><span class="inlinemediaobject"><img src="../../examples/matlab/win64/AdvancedEventLocationRestrictedThreeBodyProblemExample_eq02789970335472242207.png" alt="$$\begin{array}{cl} y'_1 &amp;#38;= y_3\\ y'_2 &amp;#38;= y_4 \\ y'_3 &amp;#38;= 2y_4 + y_1 -&amp;#10;\frac{\mu^* (y_1 + \mu)}{r_1^3} - \frac{\mu(y_1 - \mu^*}{r_2^3}\\ y'_4 &amp;#38;=&amp;#10;-2y_3 + y_2 - \frac{\mu^* y_2}{r_1^3} - \frac{\mu y_2}{r_2^3},&amp;#10;\end{array}$$"></span></span></p><p>where</p><p>
<span class="inlineequation"><span class="inlinemediaobject"><img src="../../examples/matlab/win64/AdvancedEventLocationRestrictedThreeBodyProblemExample_eq06023268274410986916.png" alt="$$\begin{array}{cl} \mu &amp;#38;= 1/82.45\\ \mu^* &amp;#38;= 1-\mu\\ r_1 &amp;#38;=&amp;#10;\sqrt{(y_1+\mu)^2+y_2^2}\\ r_2 &amp;#38;= \sqrt{(y_1-\mu^*)^2 +&amp;#10;y_2^2}.\end{array}$$"></span></span></p><p>The first two solution components are coordinates of the body of infinitesimal mass, so plotting one against the other gives the orbit of the body.</p><p>The events function nested in <code class="literal">orbitode.m</code> searches for two events. One event locates the point of maximum distance from the starting point, and the other locates the point where the spaceship returns to the starting point. The events are located accurately, even though the step sizes used by the integrator are not determined by the locations of the events. In this example, the ability to specify the direction of the zero crossing is critical. Both the point of return to the starting point and the point of maximum distance from the starting point have the same event values, and the direction of the crossing is used to distinguish them. An events function that codes this behavior is</p><div class="code_responsive"><pre id="d126e30511" class="programlisting">
<span style="color:#0000FF">function</span> [value,isterminal,direction] = orbitEvents(t,y)
<span style="color:#228B22">% dDSQdt is the derivative of the equation for current distance. Local</span>
<span style="color:#228B22">% minimum/maximum occurs when this value is zero.</span>
dDSQdt = 2 * ((y(1:2)-y0(1:2))' * y(3:4)); 
value = [dDSQdt; dDSQdt];  
isterminal = [1;  0];         <span style="color:#228B22">% stop at local minimum</span>
direction  = [1; -1];         <span style="color:#228B22">% [local minimum, local maximum]</span>
<span style="color:#0000FF">end</span>

</pre></div><p>Type <code class="literal">orbitode</code> to run the example.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>orbitode
</pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>
This is an example of event location where the ability to
specify the direction of the zero crossing is critical.  Both
the point of return to the initial point and the point of
maximum distance have the same event function value, and the
direction of the crossing is used to distinguish them.

Calling ODE45 with event functions active...

Note that the step sizes used by the integrator are NOT
determined by the location of the events, and the events are
still located accurately.

</pre></div></div></div><div class="informalfigure"><div id="d126e30522" class="mediaobject"><p><img src="../../examples/matlab/win64/AdvancedEventLocationRestrictedThreeBodyProblemExample_01.png"></p></div></div><div class="informalfigure"><div id="d126e30527" class="mediaobject"><p><img src="../../examples/matlab/win64/AdvancedEventLocationRestrictedThreeBodyProblemExample_02.png"></p></div></div></div></section>
            <h2 id="d126e30533">See Also</h2><p><span itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage/SeeAlso" itemprop="seealso"><a itemprop="url" href="../ref/odeset.html"><span itemprop="name"><code class="function">odeset</code></span></a></span> | <span itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage/SeeAlso" itemprop="seealso"><a itemprop="url" href="../ref/odeget.html"><span itemprop="name"><code class="function">odeget</code></span></a></span></p>
            
            <h3 id="d126e30544">Topics</h3><ul class="list-unstyled"><li><a href="choose-an-ode-solver.html" class="a">Choose an ODE Solver</a></li><li><a href="summary-of-ode-options.html" class="a">Summary of ODE Options</a></li><li><a href="parameterizing-functions.html" class="a">Parameterizing Functions</a></li></ul>
            
        </section>
    </div></section><div xmlns="http://www.w3.org/1999/xhtml" class="clearfix"></div>
<div xmlns="http://www.w3.org/1999/xhtml" align="center" class="feedbackblock" id="mw_docsurvey"><script src="https://www.mathworks.com/help/docsurvey/docfeedback.js"></script>
<script>loadSurveyHidden();</script>
<link rel="stylesheet" href="https://www.mathworks.com/help/docsurvey/release/index-css.css" type="text/css">
<script src="https://www.mathworks.com/help/docsurvey/release/bundle.index.js"></script>

<script>initDocSurvey();</script></div></main>


</div>
</div>
</div>
</div><!--close_0960-->
<footer xmlns="http://www.w3.org/1999/xhtml" id="footer" class="bs-footer">
<div class="container-fluid">
<div class="footer">
<div class="row">
<div class="col-12">
<p class="copyright">© 1994-2025 The MathWorks, Inc.</p>
<ul class="footernav"><li class="footernav_help"><a href="matlab:web(matlab.internal.licenseAgreement)">Terms of Use</a></li><li class="footernav_patents"><a href="matlab:web([matlabroot '/patents.txt'])">Patents</a></li><li class="footernav_trademarks"><a href="matlab:web([matlabroot '/trademarks.txt'])">Trademarks</a></li><li class="footernav_piracy"><a href="matlab:web([docroot '/acknowledgments.html'])">Acknowledgments</a></li></ul></div>
</div>
</div>
</div>
</footer>
</div><!--close row-offcanvas-->
</div><!--close_0970-->
</body>
</html>
