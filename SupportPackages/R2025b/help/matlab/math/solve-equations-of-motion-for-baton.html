<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage">
<head>
<meta xmlns="http://www.w3.org/1999/xhtml" charset="utf-8">
<meta xmlns="http://www.w3.org/1999/xhtml" name="viewport" content="width=device-width, initial-scale=1.0">
<meta xmlns="http://www.w3.org/1999/xhtml" http-equiv="X-UA-Compatible" content="IE=edge">
<title>Solve Equations of Motion for Baton Thrown into Air</title>
<script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
      {
      "@context": "http://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement":
      [{
          "@type": "ListItem",
          "position": 1,

          "item": {
          "@id": "../index.html",
          "name": "MATLAB"
}

          } 
        ,
        {
          "@type": "ListItem",
          "position": 2,

          "item": {
          "@id": "../mathematics.html",
          "name": "Mathematics"
}

          }
        ,
        {
          "@type": "ListItem",
          "position": 3,

          "item": {
          "@id": "../numerical-integration-and-differential-equations.html",
          "name": "Numerical Integration and Differential Equations"
}

          }
        ,
        {
          "@type": "ListItem",
          "position": 4,

          "item": {
          "@id": "../ordinary-differential-equations.html",
          "name": "Ordinary Differential Equations"
}

          }]
      }</script><script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "ItemList",
          "name": "VisibleBreadcrumbs",

        "itemListElement":
        [
        "ordinary-differential-equations"
        ],
        "itemListOrder": "http://schema.org/ItemListOrderAscending"
        }
        </script><script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "DigitalDocument",
          "headline": "Solve Equations of Motion for Baton Thrown into Air",
          "description": "Solves a system of ordinary differential equations that model the dynamics of a baton thrown into the air [1]. The baton is modeled as two particles with masses m1 and m2 connected by a rod of length L. The baton is thrown into the air and subsequently moves in the vertical xy-plane subject to the force due to gravity. The rod forms an angle θ with the horizontal and the coordinates of the first mass are (x,y). With this formulation, the coordinates of the second mass are (x+L cos θ,y+L sin θ).",
          "thumbnailURL": "../../examples/matlab/win64/BatonODEExample_02.png",
          "genre": "Live Script",
          "isBasedOn": {
          "@type": "Product",
          "name": "MATLAB"

        },
          "identifier": "matlab.BatonODEExample",
          "name": "BatonODEExample",
          "url": "solve-equations-of-motion-for-baton.html"

        }</script><script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "PropertyValue",
          "name": "open_command",
          "value": "matlab:openExample('matlab/BatonODEExample')"

        }</script><script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "ItemList",
          "name": "ExampleSourceFiles",

        "itemListElement":
        [
        "BatonODEExample.mlx",
        "baton-01-01-01.png"
        ],
        "itemListOrder": "http://schema.org/ItemListOrderAscending"
        }
        </script><link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/bootstrap.min.css" rel="stylesheet" type="text/css">


  <meta xmlns="http://www.w3.org/1999/xhtml" http-equiv="Content-Script-Type" content="text/javascript">
<meta xmlns="http://www.w3.org/1999/xhtml" name="toctype" itemprop="pagetype" content="ug">
<meta xmlns="http://www.w3.org/1999/xhtml" name="infotype" itemprop="infotype" content="other">

<meta xmlns="http://www.w3.org/1999/xhtml" name="description" itemprop="description" content="This example solves a system of ordinary differential equations that model the dynamics of a baton thrown into the air [1]."><meta xmlns="http://www.w3.org/1999/xhtml" content="../../examples/matlab/win64/BatonODEExample_02.png" itemprop="thumbnailUrl">
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/jquery/jquery-3.6.0.min.js"></script><script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/jquery/jquery-migrate.min.js"></script>
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6.css" rel="stylesheet" type="text/css">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_lg.css" rel="stylesheet" media="screen and (min-width: 1200px)">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_md.css" rel="stylesheet" media="screen and (min-width: 992px) and (max-width: 1199px)">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_sm+xs.css" rel="stylesheet" media="screen and (max-width: 991px)">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_sm.css" rel="stylesheet" media="screen and (min-width: 768px) and (max-width: 991px)">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_xs.css" rel="stylesheet" media="screen and (max-width: 767px)">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_offcanvas_v2.css" rel="stylesheet" type="text/css">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/shared/highlight/styles/mwdochighlight.min.css" rel="stylesheet" type="text/css">

<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/l10n.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/docscripts.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/f1help.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/docscripts.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/mw.imageanimation.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/jquery.highlight.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/underscore-min.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/use_platform_screenshots.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/suggest.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/overload.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/helpservices.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/productfilter.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/matlab_dialog_shared.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/highlight/highlight.min.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/localstorage.js"></script><script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/product_group.js"></script><script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/saxonjs/SaxonJS2.rt.js"></script><script xmlns="http://www.w3.org/1999/xhtml">
            window.history.replaceState(window.location.href, null, ""); // Initialize
            window.onload = function() {    
            mystylesheetLocation = "../../includes/shared/scripts/product_group-sef.json";
            mysourceLocation = "../../docset/docset.xml";
            product_help_location = "matlab";
            pagetype = "section";
            doccentertype = "product";
            langcode = "";
            getProductFilteredList(mystylesheetLocation, mysourceLocation, product_help_location, pagetype, doccentertype, langcode);  
            }
          </script>




<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/jquery/jquery.mobile.custom.min.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/bootstrap.bundle.min.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/global.js"></script>
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/doc_center_base.css" rel="stylesheet" type="text/css">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/doc_center_installed.css" rel="stylesheet" type="text/css">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/doc_center_print.css" rel="stylesheet" type="text/css" media="print">
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/equationrenderer/release/MathRenderer.js"></script>
</head>
<body id="responsive_offcanvas">
<div xmlns="http://www.w3.org/1999/xhtml" id="doc_header_spacer" class="header"></div>
<div xmlns="http://www.w3.org/1999/xhtml" class="section_header level_3"><div class="container-fluid"><div class="row" id="mobile_search_row"><div class="col-sm-6 col-md-7 has_horizontal_local_nav" id="section_header_title"><div class="section_header_content"><div class="section_header_title"><h1><a href="../../documentation-center.html">Help Center</a></h1></div></div></div><div class="col-12 col-sm-6 col-md-5" id="mobile_search"><div class="search_nested_content_container"><form id="docsearch_form" name="docsearch_form" method="get" data-release="R2025b" data-language="en" action="../../templates/searchresults.html"><div class="input-group tokenized_search_field"><label class="visually-hidden form-label">Search Help</label><input type="text" class="form-control conjoined_search" autocomplete="off" name="qdoc" placeholder="Search Help" id="docsearch"> <div><button type="submit" name="submitsearch" id="submitsearch" class="btn icon-search btn_search_adjacent btn_search icon_16" tabindex="-1"></button></div></div></form></div><button class="btn icon-remove btn_search float-end icon_32 d-sm-none" data-bs-toggle="collapse" href="#mobile_search" aria-expanded="false" aria-controls="mobile_search"></button></div><div class="d-sm-none" id="search_actuator"><button class="btn icon-search btn_search float-end icon_16" data-bs-toggle="collapse" href="#mobile_search" aria-expanded="false" aria-controls="mobile_search"></button></div></div></div></div><div class="row-offcanvas row-offcanvas-left">
<div xmlns="http://www.w3.org/1999/xhtml" class="sidebar-offcanvas" id="sidebar">
<nav class="offcanvas_nav" role="navigation">
<div class="offcanvas_actuator" data-bs-toggle="offcanvas" data-bs-target="#sidebar" id="nav_toggle"><button type="button" class="btn"><span class="visually-hidden">Off-Canvas Navigation Menu Toggle
                  Off-Canvas Navigation Menu Toggle</span><span class="icon-menu"></span></button><span class="offcanvas_actuator_label" id="translation_icon-menu" tabindex="-1" aria-hidden="true"></span></div><div class="nav_list_wrapper" id="nav_list_wrapper"><nav class="offcanvas_nav" role="navigation"><ul class="nav_breadcrumb" id="ul_left_nav_ancestors"><li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../../documentation-center.html?s_tid=CRUX_lftnav" itemprop="url"><span itemprop="title">Documentation Home</span></a></li></ul>
<ul class="nav_disambiguation"><li><a href="../index.html?s_tid=CRUX_lftnav" id="index">MATLAB</a>
</li>
<li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../mathematics.html?s_tid=CRUX_lftnav" itemprop="url"><span itemprop="title">Mathematics</span></a></li><li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../numerical-integration-and-differential-equations.html?s_tid=CRUX_lftnav" itemprop="url"><span itemprop="title">Numerical Integration and Differential Equations</span></a></li><li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../ordinary-differential-equations.html?s_tid=CRUX_lftnav" itemprop="url" id="ordinary-differential-equations"><span itemprop="title">Ordinary Differential Equations</span></a></li></ul><div class="search_refine_v4"><div id="facets_area"><ul class="nav_scrollspy nav list-unstyled" id="pnav">
<li class="nav_scrollspy_function nav-item"><a href="#responsive_offcanvas">Solve Equations of Motion for Baton Thrown into Air</a></li>
<li class="nav_scrollspy_title nav-item" id="SSPY810-section">On this page</li>
<!--ADD_REFENTRY_TITLE_HERE 11--><li class="nav-item"><a href="#BatonODEExample-1" class="nav-link intrnllnk">Code Equations</a></li><li class="nav-item"><a href="#BatonODEExample-2" class="nav-link intrnllnk">Solve System of Equations</a></li><li class="nav-item"><a href="#BatonODEExample-3" class="nav-link intrnllnk">Plot Results</a></li><li class="nav-item"><a href="#BatonODEExample-4" class="nav-link intrnllnk">References</a></li><li class="nav-item"><a href="#d126e35166" class="nav-link intrnllnk">See Also</a></li></ul></div></div>
</nav></div></nav>
<script src="../../includes/product/scripts/offcanvas_v2.js"></script></div><!--END.CLASS sidebar-offcanvas-->
<div class="offcanvas_content_container">
<div xmlns="http://www.w3.org/1999/xhtml" class="sticky_header_container"><div class="horizontal_nav"><div class="horizontal_nav_container"><div class="offcanvas_horizontal_nav"><div class="container-fluid"><div class="row"><div class="col-sm-12 d-none d-sm-block"><nav class="navbar navbar-default" role="navigation" id="subnav"><div><ul class="nav navbar-nav crux_browse"><li id="crux_nav_documentation" class="crux_resource active">Documentation</li><li id="crux_nav_example" class="crux_resource"><a href="../examples.html?category=ordinary-differential-equations&amp;s_tid=CRUX_topnav">Examples</a></li><li id="crux_nav_function" class="crux_resource"><a href="../referencelist.html?type=function&amp;category=ordinary-differential-equations&amp;s_tid=CRUX_topnav">Functions</a></li><li id="crux_nav_app" class="crux_resource"><a href="../referencelist.html?type=app&amp;category=ordinary-differential-equations&amp;s_tid=CRUX_topnav">Apps</a></li></ul></div></nav></div><div class="d-sm-none"><div class="container-fluid"><div class="row"><div class="col-9"><div class="mobile_crux_nav_trigger"><div class="btn-group"><button type="button" class="btn btn-default dropdown-toggle" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Resources</button><ul class="dropdown-menu"><li id="crux_nav_mobile_documentation" class="crux_resource active">Documentation</li><li id="crux_nav_mobile_example" class="crux_resource"><a href="../examples.html?category=ordinary-differential-equations&amp;s_tid=CRUX_topnav">Examples</a></li><li id="crux_nav_mobile_function" class="crux_resource"><a href="../referencelist.html?type=function&amp;category=ordinary-differential-equations&amp;s_tid=CRUX_topnav">Functions</a></li><li id="crux_nav_mobile_app" class="crux_resource"><a href="../referencelist.html?type=app&amp;category=ordinary-differential-equations&amp;s_tid=CRUX_topnav">Apps</a></li></ul></div></div></div><div class="col-3"><div class="translate_placeholder"></div></div></div></div></div></div></div></div></div></div></div><div class="content_container" id="content_container" itemprop="content">
<div class="container-fluid">
<div class="row">
<div class="col-12">

<main id="skip_link_anchor" tabindex="-1">
<div xmlns="http://www.w3.org/1999/xhtml" id="product_info_alert"></div><section xmlns="http://www.w3.org/1999/xhtml" id="doc_center_content" lang="en" data-language="en"><div id="pgtype-topic">
<section><h1 class="r2025b" itemprop="title content" id="mw_170c807b-3483-4d00-ba27-31d077d19ace">Solve Equations of Motion for Baton Thrown into Air</h1><div class="examples_short_list hidden_ios_android" data-products="ML"><div data-pane="metadata" class="card metadata_container"><div class="card-body metadata_content"><div class="d-grid"><a class="btn btn_color_blue" href="matlab:openExample('matlab/BatonODEExample')" data-ex-genre="Live Script">Open Live Script</a></div></div></div></div><div itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage/Example" itemprop="example" class="em_example"><meta itemprop="exampleid" content="matlab-BatonODEExample"><meta itemprop="exampletitle" content="Solve Equations of Motion for Baton Thrown into Air"></div><span id="BatonODEExample" class="anchor_target"></span><p class="shortdesc">This example solves a system of ordinary differential equations that model the dynamics of a baton thrown into the air <a href="solve-equations-of-motion-for-baton.html#mw_rtc_BatonODEExample_M_96EC206B" class="intrnllnk">[1]</a>. The baton is modeled as two particles with masses <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><msub><mrow><mi mathvariant="italic">m</mi></mrow><mrow><mn>1</mn></mrow></msub></mrow></math></span> and <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><msub><mrow><mi mathvariant="italic">m</mi></mrow><mrow><mn>2</mn></mrow></msub></mrow></math></span> connected by a rod of length <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">L</mi></mrow></math></span>. The baton is thrown into the air and subsequently moves in the vertical <span class="emphasis"><em>xy</em></span>-plane subject to the force due to gravity. The rod forms an angle <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi>θ</mi></mrow></math></span> with the horizontal and the coordinates of the first mass are <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mrow><mo>(</mo><mrow><mi mathvariant="italic">x</mi><mo>,</mo><mi mathvariant="italic">y</mi></mrow><mo>)</mo></mrow></mrow></math></span>. With this formulation, the coordinates of the second mass are <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mrow><mo>(</mo><mrow><mi mathvariant="italic">x</mi><mo>+</mo><mi mathvariant="italic">L</mi><mtext> </mtext><mi mathvariant="normal">cos</mi><mtext> </mtext><mi>θ</mi><mo>,</mo><mi mathvariant="italic">y</mi><mo>+</mo><mi mathvariant="italic">L</mi><mtext> </mtext><mi mathvariant="normal">sin</mi><mtext> </mtext><mi>θ</mi></mrow><mo>)</mo></mrow></mrow></math></span>.</p><div class="informalfigure"><div id="d126e33700" class="mediaobject"><p><img src="../../examples/matlab/win64/BatonODEExample_01.png" height="258" width="380"></p></div></div><p>The equations of motion for the system are obtained by applying Lagrange's equations for each of the three coordinates, <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">x</mi></mrow></math></span>, <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">y</mi></mrow></math></span>, and <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi>θ</mi></mrow></math></span>:</p><p></p>
<div class="code_responsive"><p class="programlistingindent"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="block"><mrow><mtable columnalign="left"><mtr><mtd><mrow><mrow><mo>(</mo><mrow><msub><mrow><mi mathvariant="italic">m</mi></mrow><mrow><mn>1</mn></mrow></msub><mo>+</mo><msub><mrow><mi mathvariant="italic">m</mi></mrow><mrow><mn>2</mn></mrow></msub></mrow><mo>)</mo></mrow><mover accent="true"><mrow><mi mathvariant="italic">x</mi></mrow><mrow><mo>¨</mo></mrow></mover><mo>-</mo><msub><mrow><mi mathvariant="italic">m</mi></mrow><mrow><mn>2</mn></mrow></msub><mi mathvariant="italic">L</mi><mtext> </mtext><mover accent="true"><mrow><mi>θ</mi></mrow><mrow><mo>¨</mo></mrow></mover><mtext> </mtext><mi mathvariant="normal">sin</mi><mtext> </mtext><mi>θ</mi><mo>-</mo><msub><mrow><mi mathvariant="italic">m</mi></mrow><mrow><mn>2</mn></mrow></msub><mi mathvariant="italic">L</mi><mtext> </mtext><msup><mrow><mover accent="true"><mrow><mi>θ</mi></mrow><mrow><mo>˙</mo></mrow></mover></mrow><mrow><mn>2</mn></mrow></msup><mtext> </mtext><mi mathvariant="normal">cos</mi><mtext> </mtext><mi>θ</mi><mo>=</mo><mn>0</mn><mo>,</mo></mrow></mtd></mtr><mtr><mtd><mrow><mrow><mo>(</mo><mrow><msub><mrow><mi mathvariant="italic">m</mi></mrow><mrow><mn>1</mn></mrow></msub><mo>+</mo><msub><mrow><mi mathvariant="italic">m</mi></mrow><mrow><mn>2</mn></mrow></msub></mrow><mo>)</mo></mrow><mover accent="true"><mrow><mi mathvariant="italic">y</mi></mrow><mrow><mo>¨</mo></mrow></mover><mo>-</mo><msub><mrow><mi mathvariant="italic">m</mi></mrow><mrow><mn>2</mn></mrow></msub><mi mathvariant="italic">L</mi><mtext> </mtext><mover accent="true"><mrow><mi>θ</mi></mrow><mrow><mo>¨</mo></mrow></mover><mtext> </mtext><mi mathvariant="normal">cos</mi><mtext> </mtext><mi>θ</mi><mo>-</mo><msub><mrow><mi mathvariant="italic">m</mi></mrow><mrow><mn>2</mn></mrow></msub><mi mathvariant="italic">L</mi><mtext> </mtext><msup><mrow><mover accent="true"><mrow><mi>θ</mi></mrow><mrow><mo>˙</mo></mrow></mover></mrow><mrow><mn>2</mn></mrow></msup><mtext> </mtext><mi mathvariant="normal">sin</mi><mtext> </mtext><mi>θ</mi><mo>+</mo><mrow><mo>(</mo><mrow><msub><mrow><mi mathvariant="italic">m</mi></mrow><mrow><mn>1</mn></mrow></msub><mo>+</mo><msub><mrow><mi mathvariant="italic">m</mi></mrow><mrow><mn>2</mn></mrow></msub></mrow><mo>)</mo></mrow><mi mathvariant="italic">g</mi><mo>=</mo><mn>0</mn><mo>,</mo></mrow></mtd></mtr><mtr><mtd><mrow><msup><mrow><mi mathvariant="italic">L</mi></mrow><mrow><mn>2</mn></mrow></msup><mover accent="true"><mrow><mi>θ</mi></mrow><mrow><mo>¨</mo></mrow></mover><mo>-</mo><mi mathvariant="italic">L</mi><mtext> </mtext><mover accent="true"><mrow><mi mathvariant="italic">x</mi></mrow><mrow><mo>¨</mo></mrow></mover><mtext> </mtext><mi mathvariant="normal">sin</mi><mtext> </mtext><mi>θ</mi><mo>+</mo><mi mathvariant="italic">L</mi><mtext> </mtext><mover accent="true"><mrow><mi mathvariant="italic">y</mi></mrow><mrow><mo>¨</mo></mrow></mover><mtext> </mtext><mi mathvariant="normal">cos</mi><mtext> </mtext><mi>θ</mi><mo>+</mo><mi mathvariant="italic">g</mi><mtext> </mtext><mi mathvariant="italic">L</mi><mtext> </mtext><mi mathvariant="normal">cos</mi><mtext> </mtext><mi>θ</mi><mo>=</mo><mn>0</mn><mo>.</mo></mrow></mtd></mtr></mtable></mrow></math></p></div><p></p><div class="procedure"><h3 class="title" id="BatonODEExample-1">Code Equations</h3><p>MATLAB requires the equations to be written in the form <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mover accent="true"><mrow><mi mathvariant="italic">q</mi></mrow><mrow><mo>˙</mo></mrow></mover><mo>=</mo><mi mathvariant="italic">f</mi><mrow><mo>(</mo><mrow><mi mathvariant="italic">t</mi><mo>,</mo><mi mathvariant="italic">q</mi></mrow><mo>)</mo></mrow></mrow></math></span>, where <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mover accent="true"><mrow><mi mathvariant="italic">q</mi></mrow><mrow><mo>˙</mo></mrow></mover></mrow></math></span> is the first derivative of each coordinate. In this problem, the solution vector has six components: <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">x</mi></mrow></math></span>, <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">y</mi></mrow></math></span>, the angle <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi>θ</mi></mrow></math></span>, and their first derivatives: </p><p></p>
<div class="code_responsive"><p class="programlistingindent"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="block"><mrow><mi mathvariant="italic">q</mi><mo>=</mo><mrow><mo>[</mo><mtable columnalign="center"><mtr><mtd><mrow><msub><mrow><mi mathvariant="italic">q</mi></mrow><mrow><mn>1</mn></mrow></msub></mrow></mtd></mtr><mtr><mtd><mrow><msub><mrow><mi mathvariant="italic">q</mi></mrow><mrow><mn>2</mn></mrow></msub></mrow></mtd></mtr><mtr><mtd><mrow><msub><mrow><mi mathvariant="italic">q</mi></mrow><mrow><mn>3</mn></mrow></msub></mrow></mtd></mtr><mtr><mtd><mrow><msub><mrow><mi mathvariant="italic">q</mi></mrow><mrow><mn>4</mn></mrow></msub></mrow></mtd></mtr><mtr><mtd><mrow><msub><mrow><mi mathvariant="italic">q</mi></mrow><mrow><mn>5</mn></mrow></msub></mrow></mtd></mtr><mtr><mtd><mrow><msub><mrow><mi mathvariant="italic">q</mi></mrow><mrow><mn>6</mn></mrow></msub></mrow></mtd></mtr></mtable><mo>]</mo></mrow><mo>=</mo><mrow><mo>[</mo><mtable columnalign="center"><mtr><mtd><mrow><mi mathvariant="italic">x</mi></mrow></mtd></mtr><mtr><mtd><mrow><mover accent="true"><mrow><mi mathvariant="italic">x</mi></mrow><mrow><mo>˙</mo></mrow></mover></mrow></mtd></mtr><mtr><mtd><mrow><mi mathvariant="italic">y</mi></mrow></mtd></mtr><mtr><mtd><mrow><mover accent="true"><mrow><mi mathvariant="italic">y</mi></mrow><mrow><mo>˙</mo></mrow></mover></mrow></mtd></mtr><mtr><mtd><mrow><mi>θ</mi></mrow></mtd></mtr><mtr><mtd><mrow><mover accent="true"><mrow><mi>θ</mi></mrow><mrow><mo>˙</mo></mrow></mover></mrow></mtd></mtr></mtable><mo>]</mo></mrow><mo>.</mo></mrow></math></p></div><p></p><p>With this notation, you can rewrite the equations of motion entirely in terms of the elements of <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">q</mi></mrow></math></span>:</p><p></p>
<div class="code_responsive"><p class="programlistingindent"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="block"><mrow><mtable columnalign="left"><mtr><mtd><mrow><mrow><mo>(</mo><mrow><msub><mrow><mi mathvariant="italic">m</mi></mrow><mrow><mn>1</mn></mrow></msub><mo>+</mo><msub><mrow><mi mathvariant="italic">m</mi></mrow><mrow><mn>2</mn></mrow></msub></mrow><mo>)</mo></mrow><mover accent="true"><mrow><msub><mrow><mi mathvariant="italic">q</mi></mrow><mrow><mn>2</mn></mrow></msub></mrow><mrow><mo>˙</mo></mrow></mover><mo>-</mo><msub><mrow><mi mathvariant="italic">m</mi></mrow><mrow><mn>2</mn></mrow></msub><mi mathvariant="italic">L</mi><mtext> </mtext><mover accent="true"><mrow><msub><mrow><mi mathvariant="italic">q</mi></mrow><mrow><mn>6</mn></mrow></msub></mrow><mrow><mo>˙</mo></mrow></mover><mtext> </mtext><mi mathvariant="normal">sin</mi><mtext> </mtext><msub><mrow><mi mathvariant="italic">q</mi></mrow><mrow><mn>5</mn></mrow></msub><mo>=</mo><msub><mrow><mi mathvariant="italic">m</mi></mrow><mrow><mn>2</mn></mrow></msub><mi mathvariant="italic">L</mi><mtext> </mtext><msubsup><mrow><mi mathvariant="italic">q</mi></mrow><mrow><mn>6</mn></mrow><mrow><mn>2</mn></mrow></msubsup><mi mathvariant="normal">cos</mi><mtext> </mtext><msub><mrow><mi mathvariant="italic">q</mi></mrow><mrow><mn>5</mn></mrow></msub><mo>,</mo></mrow></mtd></mtr><mtr><mtd><mrow><mrow><mo>(</mo><mrow><msub><mrow><mi mathvariant="italic">m</mi></mrow><mrow><mn>1</mn></mrow></msub><mo>+</mo><msub><mrow><mi mathvariant="italic">m</mi></mrow><mrow><mn>2</mn></mrow></msub></mrow><mo>)</mo></mrow><mover accent="true"><mrow><msub><mrow><mi mathvariant="italic">q</mi></mrow><mrow><mn>4</mn></mrow></msub></mrow><mrow><mo>˙</mo></mrow></mover><mo>-</mo><msub><mrow><mi mathvariant="italic">m</mi></mrow><mrow><mn>2</mn></mrow></msub><mi mathvariant="italic">L</mi><mtext> </mtext><mover accent="true"><mrow><msub><mrow><mi mathvariant="italic">q</mi></mrow><mrow><mn>6</mn></mrow></msub></mrow><mrow><mo>˙</mo></mrow></mover><mtext> </mtext><mi mathvariant="normal">cos</mi><mtext> </mtext><msub><mrow><mi mathvariant="italic">q</mi></mrow><mrow><mn>5</mn></mrow></msub><mo>=</mo><msub><mrow><mi mathvariant="italic">m</mi></mrow><mrow><mn>2</mn></mrow></msub><mi mathvariant="italic">L</mi><mtext> </mtext><msubsup><mrow><mi mathvariant="italic">q</mi></mrow><mrow><mn>6</mn></mrow><mrow><mn>2</mn></mrow></msubsup><mtext> </mtext><mi mathvariant="normal">sin</mi><mtext> </mtext><msub><mrow><mi mathvariant="italic">q</mi></mrow><mrow><mn>5</mn></mrow></msub><mo>-</mo><mrow><mo>(</mo><mrow><msub><mrow><mi mathvariant="italic">m</mi></mrow><mrow><mn>1</mn></mrow></msub><mo>+</mo><msub><mrow><mi mathvariant="italic">m</mi></mrow><mrow><mn>2</mn></mrow></msub></mrow><mo>)</mo></mrow><mi mathvariant="italic">g</mi><mo>,</mo></mrow></mtd></mtr><mtr><mtd><mrow><msup><mrow><mi mathvariant="italic">L</mi></mrow><mrow><mn>2</mn></mrow></msup><mover accent="true"><mrow><msub><mrow><mi mathvariant="italic">q</mi></mrow><mrow><mn>6</mn></mrow></msub></mrow><mrow><mo>˙</mo></mrow></mover><mo>-</mo><mi mathvariant="italic">L</mi><mtext> </mtext><mover accent="true"><mrow><msub><mrow><mi mathvariant="italic">q</mi></mrow><mrow><mn>2</mn></mrow></msub></mrow><mrow><mo>˙</mo></mrow></mover><mtext> </mtext><mi mathvariant="normal">sin</mi><mtext> </mtext><msub><mrow><mi mathvariant="italic">q</mi></mrow><mrow><mn>5</mn></mrow></msub><mo>+</mo><mi mathvariant="italic">L</mi><mtext> </mtext><mover accent="true"><mrow><msub><mrow><mi mathvariant="italic">q</mi></mrow><mrow><mn>4</mn></mrow></msub></mrow><mrow><mo>˙</mo></mrow></mover><mtext> </mtext><mi mathvariant="normal">cos</mi><mtext> </mtext><msub><mrow><mi mathvariant="italic">q</mi></mrow><mrow><mn>5</mn></mrow></msub><mo>=</mo><mo>-</mo><mi mathvariant="italic">g</mi><mtext> </mtext><mi mathvariant="italic">L</mi><mtext> </mtext><mi mathvariant="normal">cos</mi><mtext> </mtext><msub><mrow><mi mathvariant="italic">q</mi></mrow><mrow><mn>5</mn></mrow></msub><mo>.</mo></mrow></mtd></mtr></mtable></mrow></math></p></div><p></p><p>Unfortunately, the equations of motion do not fit into the form <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mover accent="true"><mrow><mi mathvariant="italic">q</mi></mrow><mrow><mo>˙</mo></mrow></mover><mo>=</mo><mi mathvariant="italic">f</mi><mrow><mo>(</mo><mrow><mi mathvariant="italic">t</mi><mo>,</mo><mi mathvariant="italic">q</mi></mrow><mo>)</mo></mrow></mrow></math></span> required by the solver, since there are several terms on the left with first derivatives. When this occurs, you must use a mass matrix to represent the left side of the equation. </p><p>With matrix notation, you can rewrite the equations of motion as a system of six equations using a mass matrix in the form <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">M</mi><mrow><mo>(</mo><mrow><mi mathvariant="italic">t</mi><mo>,</mo><mi mathvariant="italic">q</mi></mrow><mo>)</mo></mrow><mtext> </mtext><mover accent="true" accentunder="false"><mrow><mi mathvariant="italic">q</mi></mrow><mrow><mo>˙</mo></mrow></mover><mo>=</mo><mi mathvariant="italic">f</mi><mrow><mo>(</mo><mrow><mi mathvariant="italic">t</mi><mo>,</mo><mi mathvariant="italic">q</mi></mrow><mo>)</mo></mrow></mrow></math></span>. The mass matrix expresses the linear combinations of first derivatives on the left side of the equation with a matrix-vector product. In this form, the system of equations becomes:</p><p></p>
<div class="code_responsive"><p class="programlistingindent"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="block"><mrow><mrow><mo>[</mo><mtable columnalign="center"><mtr><mtd><mrow><mn>1</mn></mrow></mtd><mtd><mrow><mn>0</mn></mrow></mtd><mtd><mrow><mn>0</mn></mrow></mtd><mtd><mrow><mn>0</mn></mrow></mtd><mtd><mrow><mn>0</mn></mrow></mtd><mtd><mrow><mn>0</mn></mrow></mtd></mtr><mtr><mtd><mrow><mn>0</mn></mrow></mtd><mtd><mrow><msub><mrow><mi mathvariant="italic">m</mi></mrow><mrow><mn>1</mn></mrow></msub><mo>+</mo><msub><mrow><mi mathvariant="italic">m</mi></mrow><mrow><mn>2</mn></mrow></msub></mrow></mtd><mtd><mrow><mn>0</mn></mrow></mtd><mtd><mrow><mn>0</mn></mrow></mtd><mtd><mrow><mn>0</mn></mrow></mtd><mtd><mrow><mo>-</mo><msub><mrow><mi mathvariant="italic">m</mi></mrow><mrow><mn>2</mn></mrow></msub><mi mathvariant="italic">L</mi><mtext> </mtext><mi mathvariant="normal">sin</mi><mtext> </mtext><msub><mrow><mi mathvariant="italic">q</mi></mrow><mrow><mn>5</mn></mrow></msub></mrow></mtd></mtr><mtr><mtd><mrow><mn>0</mn></mrow></mtd><mtd><mrow><mn>0</mn></mrow></mtd><mtd><mrow><mn>1</mn></mrow></mtd><mtd><mrow><mn>0</mn></mrow></mtd><mtd><mrow><mn>0</mn></mrow></mtd><mtd><mrow><mn>0</mn></mrow></mtd></mtr><mtr><mtd><mrow><mn>0</mn></mrow></mtd><mtd><mrow><mn>0</mn></mrow></mtd><mtd><mrow><mn>0</mn></mrow></mtd><mtd><mrow><msub><mrow><mi mathvariant="italic">m</mi></mrow><mrow><mn>1</mn></mrow></msub><mo>+</mo><msub><mrow><mi mathvariant="italic">m</mi></mrow><mrow><mn>2</mn></mrow></msub></mrow></mtd><mtd><mrow><mn>0</mn></mrow></mtd><mtd><mrow><msub><mrow><mi mathvariant="italic">m</mi></mrow><mrow><mn>2</mn></mrow></msub><mi mathvariant="italic">L</mi><mtext> </mtext><mi mathvariant="normal">cos</mi><mtext> </mtext><msub><mrow><mi mathvariant="italic">q</mi></mrow><mrow><mn>5</mn></mrow></msub></mrow></mtd></mtr><mtr><mtd><mrow><mn>0</mn></mrow></mtd><mtd><mrow><mn>0</mn></mrow></mtd><mtd><mrow><mn>0</mn></mrow></mtd><mtd><mrow><mn>0</mn></mrow></mtd><mtd><mrow><mn>1</mn></mrow></mtd><mtd><mrow><mn>0</mn></mrow></mtd></mtr><mtr><mtd><mrow><mn>0</mn></mrow></mtd><mtd><mrow><mo>-</mo><mi mathvariant="italic">L</mi><mtext> </mtext><mi mathvariant="normal">sin</mi><mtext> </mtext><msub><mrow><mi mathvariant="italic">q</mi></mrow><mrow><mn>5</mn></mrow></msub></mrow></mtd><mtd><mrow><mn>0</mn></mrow></mtd><mtd><mrow><mi mathvariant="italic">L</mi><mtext> </mtext><mi mathvariant="normal">cos</mi><mtext> </mtext><msub><mrow><mi mathvariant="italic">q</mi></mrow><mrow><mn>5</mn></mrow></msub></mrow></mtd><mtd><mrow><mn>0</mn></mrow></mtd><mtd><mrow><msup><mrow><mi mathvariant="italic">L</mi></mrow><mrow><mn>2</mn></mrow></msup></mrow></mtd></mtr></mtable><mo>]</mo></mrow><mrow><mo>[</mo><mtable columnalign="center"><mtr><mtd><mrow><mover accent="true"><mrow><msub><mrow><mi mathvariant="italic">q</mi></mrow><mrow><mn>1</mn></mrow></msub></mrow><mrow><mo>˙</mo></mrow></mover></mrow></mtd></mtr><mtr><mtd><mrow><mover accent="true"><mrow><msub><mrow><mi mathvariant="italic">q</mi></mrow><mrow><mn>2</mn></mrow></msub></mrow><mrow><mo>˙</mo></mrow></mover></mrow></mtd></mtr><mtr><mtd><mrow><mover accent="true"><mrow><msub><mrow><mi mathvariant="italic">q</mi></mrow><mrow><mn>3</mn></mrow></msub></mrow><mrow><mo>˙</mo></mrow></mover></mrow></mtd></mtr><mtr><mtd><mrow><mover accent="true"><mrow><msub><mrow><mi mathvariant="italic">q</mi></mrow><mrow><mn>4</mn></mrow></msub></mrow><mrow><mo>˙</mo></mrow></mover></mrow></mtd></mtr><mtr><mtd><mrow><mover accent="true"><mrow><msub><mrow><mi mathvariant="italic">q</mi></mrow><mrow><mn>5</mn></mrow></msub></mrow><mrow><mo>˙</mo></mrow></mover></mrow></mtd></mtr><mtr><mtd><mrow><mover accent="true"><mrow><msub><mrow><mi mathvariant="italic">q</mi></mrow><mrow><mn>6</mn></mrow></msub></mrow><mrow><mo>˙</mo></mrow></mover></mrow></mtd></mtr></mtable><mo>]</mo></mrow><mo>=</mo><mrow><mo>[</mo><mtable columnalign="center"><mtr><mtd><mrow><msub><mrow><mi mathvariant="italic">q</mi></mrow><mrow><mn>2</mn></mrow></msub></mrow></mtd></mtr><mtr><mtd><mrow><msub><mrow><mi mathvariant="italic">m</mi></mrow><mrow><mn>2</mn></mrow></msub><mi mathvariant="italic">L</mi><mtext> </mtext><msubsup><mrow><mi mathvariant="italic">q</mi></mrow><mrow><mn>6</mn></mrow><mrow><mn>2</mn></mrow></msubsup><mi mathvariant="normal">cos</mi><mtext> </mtext><msub><mrow><mi mathvariant="italic">q</mi></mrow><mrow><mn>5</mn></mrow></msub></mrow></mtd></mtr><mtr><mtd><mrow><msub><mrow><mi mathvariant="italic">q</mi></mrow><mrow><mn>4</mn></mrow></msub></mrow></mtd></mtr><mtr><mtd><mrow><msub><mrow><mi mathvariant="italic">m</mi></mrow><mrow><mn>2</mn></mrow></msub><mi mathvariant="italic">L</mi><mtext> </mtext><msubsup><mrow><mi mathvariant="italic">q</mi></mrow><mrow><mn>6</mn></mrow><mrow><mn>2</mn></mrow></msubsup><mtext> </mtext><mi mathvariant="normal">sin</mi><mtext> </mtext><msub><mrow><mi mathvariant="italic">q</mi></mrow><mrow><mn>5</mn></mrow></msub><mo>-</mo><mrow><mo>(</mo><mrow><msub><mrow><mi mathvariant="italic">m</mi></mrow><mrow><mn>1</mn></mrow></msub><mo>+</mo><msub><mrow><mi mathvariant="italic">m</mi></mrow><mrow><mn>2</mn></mrow></msub></mrow><mo>)</mo></mrow><mi mathvariant="italic">g</mi></mrow></mtd></mtr><mtr><mtd><mrow><msub><mrow><mi mathvariant="italic">q</mi></mrow><mrow><mn>6</mn></mrow></msub></mrow></mtd></mtr><mtr><mtd><mrow><mo>-</mo><mi mathvariant="italic">g</mi><mtext> </mtext><mi mathvariant="italic">L</mi><mtext> </mtext><mi mathvariant="normal">cos</mi><mtext> </mtext><msub><mrow><mi mathvariant="italic">q</mi></mrow><mrow><mn>5</mn></mrow></msub></mrow></mtd></mtr></mtable><mo>]</mo></mrow></mrow></math></p></div><p></p><p>From this expression, you can write a function that calculates the nonzero elements of the mass matrix. The function takes three inputs: <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">t</mi></mrow></math></span> and the solution vector <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">q</mi></mrow></math></span> are required (you must specify these inputs even if they are not used in the body of the function), and <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">P</mi></mrow></math></span> is an optional extra input used to pass in parameter values.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre><span style="color:#0000FF">function</span> M = mass(t,q,P)
<span style="color:#228B22">% Extract parameters</span>
m1 = P(1);
m2 = P(2);
L = P(3);
g = P(4);

<span style="color:#228B22">% Mass matrix elements</span>
M = zeros(6,6);
M(1,1) = 1;
M(2,2) = m1 + m2;
M(2,6) = -m2*L*sin(q(5));
M(3,3) = 1;
M(4,4) = m1 + m2;
M(4,6) = m2*L*cos(q(5));
M(5,5) = 1;
M(6,2) = -L*sin(q(5));
M(6,4) = L*cos(q(5));
M(6,6) = L^2;
<span style="color:#0000FF">end</span></pre></div></div></div><p>Next, you can write a function for the right side of each of the equations in the system <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true"><mi mathvariant="italic">M</mi><mrow><mo>(</mo><mrow><mi mathvariant="italic">t</mi><mo>,</mo><mi mathvariant="italic">q</mi></mrow><mo>)</mo></mrow><mtext> </mtext><mover accent="true" accentunder="false"><mrow><mi mathvariant="italic">q</mi></mrow><mrow><mo>˙</mo></mrow></mover><mo>=</mo><mi mathvariant="italic">f</mi><mrow><mo>(</mo><mrow><mi mathvariant="italic">t</mi><mo>,</mo><mi mathvariant="italic">q</mi></mrow><mo>)</mo></mrow></math></span>. Like the mass matrix function, this function takes two required inputs for <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">t</mi></mrow></math></span> and <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">q</mi></mrow></math></span>, and one optional input for parameter values <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">P</mi></mrow></math></span>.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre><span style="color:#0000FF">function</span> dydt = f(t,q,P)
<span style="color:#228B22">% Extract parameters</span>
m1 = P(1);
m2 = P(2);
L = P(3);
g = P(4);

<span style="color:#228B22">% Equations to solve</span>
dydt = [q(2)
        m2*L*q(6)^2*cos(q(5))
        q(4)
        m2*L*q(6)^2*sin(q(5))-(m1+m2)*g
        q(6)
        -g*L*cos(q(5))];
<span style="color:#0000FF">end</span></pre></div></div></div><h3 class="title" id="BatonODEExample-2">Solve System of Equations</h3><p>First, create a vector <code class="literal">P</code> of parameter values for <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><msub><mrow><mi mathvariant="italic">m</mi></mrow><mrow><mn>1</mn></mrow></msub></mrow></math></span>, <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><msub><mrow><mi mathvariant="italic">m</mi></mrow><mrow><mn>2</mn></mrow></msub></mrow></math></span>, <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">L</mi></mrow></math></span>, and <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">g</mi></mrow></math></span>. The solver passes the vector <code class="literal">P</code> to the mass matrix and ODE functions as an extra input.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>P = [0.1 0.1 1 9.81];</pre></div></div></div><p>Create a vector of initial conditions for the problem. Since the baton is thrown upward at an angle, use nonzero values for the initial velocities,  <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mover accent="true"><mrow><msub><mrow><mi mathvariant="italic">x</mi></mrow><mrow><mn>0</mn></mrow></msub></mrow><mrow><mo>˙</mo></mrow></mover><mo>=</mo><mn>4</mn></mrow></math></span>, <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mover accent="true"><mrow><msub><mrow><mi mathvariant="italic">y</mi></mrow><mrow><mn>0</mn></mrow></msub></mrow><mrow><mo>˙</mo></mrow></mover><mo>=</mo><mn>20</mn></mrow></math></span>, and <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mover accent="true"><mrow><msub><mrow><mi>θ</mi></mrow><mrow><mn>0</mn></mrow></msub></mrow><mrow><mo>˙</mo></mrow></mover><mo>=</mo><mn>2</mn></mrow></math></span>. For the initial positions, the baton begins in an upright position, so <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><msub><mrow><mi>θ</mi></mrow><mrow><mn>0</mn></mrow></msub><mo>=</mo><mo>-</mo><mi>π</mi><mo>/</mo><mn>2</mn></mrow></math></span>, <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><msub><mrow><mi mathvariant="italic">x</mi></mrow><mrow><mn>0</mn></mrow></msub><mo>=</mo><mn>0</mn></mrow></math></span>, and <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><msub><mrow><mi mathvariant="italic">y</mi></mrow><mrow><mn>0</mn></mrow></msub><mo>=</mo><mi mathvariant="italic">L</mi></mrow></math></span>.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>y0 = [0; 4; P(3); 20; -pi/2; 2];</pre></div></div></div><p>Now, create an <code class="literal">ode</code> object to represent the problem, specifying values for <code class="literal">ODEFcn</code>, <code class="literal">MassMatrix</code>, <code class="literal">InitialValue</code>, and <code class="literal">Parameters</code>. The object display indicates that the <code class="literal">ode15s</code> solver is chosen for the problem since a mass matrix is present.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>F = ode(ODEFcn=@f,<span style="color:#0000FF">...</span>
        MassMatrix=@mass,<span style="color:#0000FF">...</span>
        InitialValue=y0,<span style="color:#0000FF">...</span>
        Parameters=P)</pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>F = 
  ode with properties:

   Problem definition
               ODEFcn: @f
           Parameters: [0.1000 0.1000 1 9.8100]
          InitialTime: 0
         InitialValue: [6×1 double]
             Jacobian: []
           MassMatrix: [1×1 odeMassMatrix]
         EquationType: standard

   Solver properties
    AbsoluteTolerance: 1.0000e-06
    RelativeTolerance: 1.0000e-03
               Solver: auto
       SelectedSolver: ode15s

  Show all properties


</pre></div></div></div><p>Create a vector with 25 points between 0 and 4 for the time span of the integration, and simulate the system of equations using <code class="literal">solve</code>. When you specify a vector of times, the solver takes its own internal steps but interpolates the solution at the points you specify.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>tspan = linspace(0,4,25);
sol = solve(F,tspan)</pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>sol = 
  ODEResults with properties:

        Time: [0 0.1667 0.3333 0.5000 0.6667 0.8333 1 1.1667 1.3333 1.5000 1.6667 1.8333 2 2.1667 2.3333 2.5000 2.6667 2.8333 3 3.1667 3.3333 3.5000 3.6667 3.8333 4]
    Solution: [6×25 double]

</pre></div></div></div><h3 class="title" id="BatonODEExample-3">Plot Results</h3><p>The output from <code class="literal">solve</code> contains the solutions of the equations of motion at each requested time step. To examine the results, plot the motion of the baton over time.</p><p>Loop through each column of the solution, and at each time step, plot the position of the baton. Color each end of the baton differently so that you can see its rotation over time.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>figure
title(<span style="color:#A020F0">"Motion of Thrown Baton"</span>);
axis([0 22 0 25])
hold <span style="color:#A020F0">on</span>
<span style="color:#0000FF">for</span> j = 1:length(sol.Time)
   theta = sol.Solution(5,j);
   X = sol.Solution(1,j);
   Y = sol.Solution(3,j);
   xvals = [X X+P(3)*cos(theta)];
   yvals = [Y Y+P(3)*sin(theta)];
   plot(xvals,yvals,xvals(1),yvals(1),<span style="color:#A020F0">"ro"</span>,xvals(2),yvals(2),<span style="color:#A020F0">"go"</span>)
<span style="color:#0000FF">end</span>
hold <span style="color:#A020F0">off</span></pre></div></div></div><div class="informalfigure"><div id="d126e35152" class="mediaobject"><p><img src="../../examples/matlab/win64/BatonODEExample_02.png" alt="Figure contains an axes object. The axes object with title Motion of Thrown Baton contains 75 objects of type line. One or more of the lines displays its values using only markers" width="560"></p></div></div><h3 class="title" id="BatonODEExample-4">References</h3><span id="mw_rtc_BatonODEExample_M_96EC206B" class="anchor_target"></span><p>[1] Wells, Dare A. <span class="emphasis"><em>Schaum’s Outline of Theory and Problems of Lagrangian Dynamics: With a Treatment of Euler’s Equations of Motion, Hamilton’s Equations and Hamilton’s Principle</em></span>. Schaum's Outline Series. New York: Schaum Pub. Co, 1967.</p></div>
            <h2 id="d126e35166">See Also</h2><p><span itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage/SeeAlso" itemprop="seealso"><a itemprop="url" href="../ref/ode45.html"><span itemprop="name"><code class="function">ode45</code></span></a></span></p>
            <h3 id="d126e35172">Topics</h3><ul class="list-unstyled"><li><a href="choose-an-ode-solver.html" class="a">Choose an ODE Solver</a></li><li><a href="solve-nonstiff-odes.html" class="a">Solve Nonstiff ODEs</a></li></ul>
            
        </section>
    </div></section><div xmlns="http://www.w3.org/1999/xhtml" class="clearfix"></div>
<div xmlns="http://www.w3.org/1999/xhtml" align="center" class="feedbackblock" id="mw_docsurvey"><script src="https://www.mathworks.com/help/docsurvey/docfeedback.js"></script>
<script>loadSurveyHidden();</script>
<link rel="stylesheet" href="https://www.mathworks.com/help/docsurvey/release/index-css.css" type="text/css">
<script src="https://www.mathworks.com/help/docsurvey/release/bundle.index.js"></script>

<script>initDocSurvey();</script></div></main>


</div>
</div>
</div>
</div><!--close_0960-->
<footer xmlns="http://www.w3.org/1999/xhtml" id="footer" class="bs-footer">
<div class="container-fluid">
<div class="footer">
<div class="row">
<div class="col-12">
<p class="copyright">© 1994-2025 The MathWorks, Inc.</p>
<ul class="footernav"><li class="footernav_help"><a href="matlab:web(matlab.internal.licenseAgreement)">Terms of Use</a></li><li class="footernav_patents"><a href="matlab:web([matlabroot '/patents.txt'])">Patents</a></li><li class="footernav_trademarks"><a href="matlab:web([matlabroot '/trademarks.txt'])">Trademarks</a></li><li class="footernav_piracy"><a href="matlab:web([docroot '/acknowledgments.html'])">Acknowledgments</a></li></ul></div>
</div>
</div>
</div>
</footer>
</div><!--close row-offcanvas-->
</div><!--close_0970-->
</body>
</html>
