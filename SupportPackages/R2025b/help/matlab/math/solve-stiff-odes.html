<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage">
<head>
<meta xmlns="http://www.w3.org/1999/xhtml" charset="utf-8">
<meta xmlns="http://www.w3.org/1999/xhtml" name="viewport" content="width=device-width, initial-scale=1.0">
<meta xmlns="http://www.w3.org/1999/xhtml" http-equiv="X-UA-Compatible" content="IE=edge">
<title>Solve Stiff ODEs</title>
<script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
      {
      "@context": "http://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement":
      [{
          "@type": "ListItem",
          "position": 1,

          "item": {
          "@id": "../index.html",
          "name": "MATLAB"
}

          } 
        ,
        {
          "@type": "ListItem",
          "position": 2,

          "item": {
          "@id": "../mathematics.html",
          "name": "Mathematics"
}

          }
        ,
        {
          "@type": "ListItem",
          "position": 3,

          "item": {
          "@id": "../numerical-integration-and-differential-equations.html",
          "name": "Numerical Integration and Differential Equations"
}

          }
        ,
        {
          "@type": "ListItem",
          "position": 4,

          "item": {
          "@id": "../ordinary-differential-equations.html",
          "name": "Ordinary Differential Equations"
}

          }]
      }</script><script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "ItemList",
          "name": "VisibleBreadcrumbs",

        "itemListElement":
        [
        "ordinary-differential-equations"
        ],
        "itemListOrder": "http://schema.org/ItemListOrderAscending"
        }
        </script><script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "DigitalDocument",
          "headline": "Solve Stiff ODEs",
          "description": "This page contains two examples of solving stiff ordinary differential equations using ode15s. MATLAB&#174; has four solvers designed for stiff ODEs.",
          "thumbnailURL": "../../examples/matlab/win64/SolveStiffODEsExample_01.png",
          "genre": "Script",
          "isBasedOn": {
          "@type": "Product",
          "name": "MATLAB"

        },
          "identifier": "matlab.SolveStiffODEsExample",
          "name": "SolveStiffODEsExample",
          "url": "solve-stiff-odes.html"

        }</script><script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "PropertyValue",
          "name": "open_command",
          "value": "matlab:openExample('matlab/SolveStiffODEsExample')"

        }</script><script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "ItemList",
          "name": "ExampleSourceFiles",

        "itemListElement":
        [
        "SolveStiffODEsExample.m"
        ],
        "itemListOrder": "http://schema.org/ItemListOrderAscending"
        }
        </script><link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/bootstrap.min.css" rel="stylesheet" type="text/css">


  <meta xmlns="http://www.w3.org/1999/xhtml" http-equiv="Content-Script-Type" content="text/javascript">
<meta xmlns="http://www.w3.org/1999/xhtml" name="toctype" itemprop="pagetype" content="ug">
<meta xmlns="http://www.w3.org/1999/xhtml" name="infotype" itemprop="infotype" content="ex">

<meta xmlns="http://www.w3.org/1999/xhtml" name="description" itemprop="description" content="This page contains two examples of solving stiff ordinary differential equations using ode15s."><meta xmlns="http://www.w3.org/1999/xhtml" content="../../examples/matlab/win64/SolveStiffODEsExample_01.png" itemprop="thumbnailUrl">
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/jquery/jquery-3.6.0.min.js"></script><script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/jquery/jquery-migrate.min.js"></script>
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6.css" rel="stylesheet" type="text/css">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_lg.css" rel="stylesheet" media="screen and (min-width: 1200px)">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_md.css" rel="stylesheet" media="screen and (min-width: 992px) and (max-width: 1199px)">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_sm+xs.css" rel="stylesheet" media="screen and (max-width: 991px)">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_sm.css" rel="stylesheet" media="screen and (min-width: 768px) and (max-width: 991px)">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_xs.css" rel="stylesheet" media="screen and (max-width: 767px)">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_offcanvas_v2.css" rel="stylesheet" type="text/css">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/shared/highlight/styles/mwdochighlight.min.css" rel="stylesheet" type="text/css">

<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/l10n.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/docscripts.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/f1help.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/docscripts.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/mw.imageanimation.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/jquery.highlight.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/underscore-min.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/use_platform_screenshots.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/suggest.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/overload.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/helpservices.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/productfilter.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/matlab_dialog_shared.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/highlight/highlight.min.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/localstorage.js"></script><script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/product_group.js"></script><script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/saxonjs/SaxonJS2.rt.js"></script><script xmlns="http://www.w3.org/1999/xhtml">
            window.history.replaceState(window.location.href, null, ""); // Initialize
            window.onload = function() {    
            mystylesheetLocation = "../../includes/shared/scripts/product_group-sef.json";
            mysourceLocation = "../../docset/docset.xml";
            product_help_location = "matlab";
            pagetype = "section";
            doccentertype = "product";
            langcode = "";
            getProductFilteredList(mystylesheetLocation, mysourceLocation, product_help_location, pagetype, doccentertype, langcode);  
            }
          </script>




<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/jquery/jquery.mobile.custom.min.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/bootstrap.bundle.min.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/global.js"></script>
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/doc_center_base.css" rel="stylesheet" type="text/css">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/doc_center_installed.css" rel="stylesheet" type="text/css">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/doc_center_print.css" rel="stylesheet" type="text/css" media="print">
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/equationrenderer/release/MathRenderer.js"></script>
</head>
<body id="responsive_offcanvas">
<div xmlns="http://www.w3.org/1999/xhtml" id="doc_header_spacer" class="header"></div>
<div xmlns="http://www.w3.org/1999/xhtml" class="section_header level_3"><div class="container-fluid"><div class="row" id="mobile_search_row"><div class="col-sm-6 col-md-7 has_horizontal_local_nav" id="section_header_title"><div class="section_header_content"><div class="section_header_title"><h1><a href="../../documentation-center.html">Help Center</a></h1></div></div></div><div class="col-12 col-sm-6 col-md-5" id="mobile_search"><div class="search_nested_content_container"><form id="docsearch_form" name="docsearch_form" method="get" data-release="R2025b" data-language="en" action="../../templates/searchresults.html"><div class="input-group tokenized_search_field"><label class="visually-hidden form-label">Search Help</label><input type="text" class="form-control conjoined_search" autocomplete="off" name="qdoc" placeholder="Search Help" id="docsearch"> <div><button type="submit" name="submitsearch" id="submitsearch" class="btn icon-search btn_search_adjacent btn_search icon_16" tabindex="-1"></button></div></div></form></div><button class="btn icon-remove btn_search float-end icon_32 d-sm-none" data-bs-toggle="collapse" href="#mobile_search" aria-expanded="false" aria-controls="mobile_search"></button></div><div class="d-sm-none" id="search_actuator"><button class="btn icon-search btn_search float-end icon_16" data-bs-toggle="collapse" href="#mobile_search" aria-expanded="false" aria-controls="mobile_search"></button></div></div></div></div><div class="row-offcanvas row-offcanvas-left">
<div xmlns="http://www.w3.org/1999/xhtml" class="sidebar-offcanvas" id="sidebar">
<nav class="offcanvas_nav" role="navigation">
<div class="offcanvas_actuator" data-bs-toggle="offcanvas" data-bs-target="#sidebar" id="nav_toggle"><button type="button" class="btn"><span class="visually-hidden">Off-Canvas Navigation Menu Toggle
                  Off-Canvas Navigation Menu Toggle</span><span class="icon-menu"></span></button><span class="offcanvas_actuator_label" id="translation_icon-menu" tabindex="-1" aria-hidden="true"></span></div><div class="nav_list_wrapper" id="nav_list_wrapper"><nav class="offcanvas_nav" role="navigation"><ul class="nav_breadcrumb" id="ul_left_nav_ancestors"><li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../../documentation-center.html?s_tid=CRUX_lftnav" itemprop="url"><span itemprop="title">Documentation Home</span></a></li></ul>
<ul class="nav_disambiguation"><li><a href="../index.html?s_tid=CRUX_lftnav" id="index">MATLAB</a>
</li>
<li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../mathematics.html?s_tid=CRUX_lftnav" itemprop="url"><span itemprop="title">Mathematics</span></a></li><li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../numerical-integration-and-differential-equations.html?s_tid=CRUX_lftnav" itemprop="url"><span itemprop="title">Numerical Integration and Differential Equations</span></a></li><li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../ordinary-differential-equations.html?s_tid=CRUX_lftnav" itemprop="url" id="ordinary-differential-equations"><span itemprop="title">Ordinary Differential Equations</span></a></li></ul><div class="search_refine_v4"><div id="facets_area"><ul class="nav_scrollspy nav list-unstyled" id="pnav">
<li class="nav_scrollspy_function nav-item"><a href="#responsive_offcanvas">Solve Stiff ODEs</a></li>
<li class="nav_scrollspy_title nav-item" id="SSPY810-section">On this page</li>
<!--ADD_REFENTRY_TITLE_HERE 11--><li class="nav-item"><a href="#d126e30994" class="nav-link intrnllnk">What is a Stiff ODE?</a></li><li class="nav-item"><a href="#d126e31022" class="nav-link intrnllnk">Solver Options</a></li><li class="nav-item"><a href="#d126e31050" class="nav-link intrnllnk">Example: Stiff van der Pol Equation</a></li><li class="nav-item"><a href="#d126e31156" class="nav-link intrnllnk">Example: Sparse Brusselator System</a></li><li class="nav-item"><a href="#d126e31343" class="nav-link intrnllnk">See Also</a></li></ul></div></div>
</nav></div></nav>
<script src="../../includes/product/scripts/offcanvas_v2.js"></script></div><!--END.CLASS sidebar-offcanvas-->
<div class="offcanvas_content_container">
<div xmlns="http://www.w3.org/1999/xhtml" class="sticky_header_container"><div class="horizontal_nav"><div class="horizontal_nav_container"><div class="offcanvas_horizontal_nav"><div class="container-fluid"><div class="row"><div class="col-sm-12 d-none d-sm-block"><nav class="navbar navbar-default" role="navigation" id="subnav"><div><ul class="nav navbar-nav crux_browse"><li id="crux_nav_documentation" class="crux_resource active">Documentation</li><li id="crux_nav_example" class="crux_resource"><a href="../examples.html?category=ordinary-differential-equations&amp;s_tid=CRUX_topnav">Examples</a></li><li id="crux_nav_function" class="crux_resource"><a href="../referencelist.html?type=function&amp;category=ordinary-differential-equations&amp;s_tid=CRUX_topnav">Functions</a></li><li id="crux_nav_app" class="crux_resource"><a href="../referencelist.html?type=app&amp;category=ordinary-differential-equations&amp;s_tid=CRUX_topnav">Apps</a></li></ul></div></nav></div><div class="d-sm-none"><div class="container-fluid"><div class="row"><div class="col-9"><div class="mobile_crux_nav_trigger"><div class="btn-group"><button type="button" class="btn btn-default dropdown-toggle" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Resources</button><ul class="dropdown-menu"><li id="crux_nav_mobile_documentation" class="crux_resource active">Documentation</li><li id="crux_nav_mobile_example" class="crux_resource"><a href="../examples.html?category=ordinary-differential-equations&amp;s_tid=CRUX_topnav">Examples</a></li><li id="crux_nav_mobile_function" class="crux_resource"><a href="../referencelist.html?type=function&amp;category=ordinary-differential-equations&amp;s_tid=CRUX_topnav">Functions</a></li><li id="crux_nav_mobile_app" class="crux_resource"><a href="../referencelist.html?type=app&amp;category=ordinary-differential-equations&amp;s_tid=CRUX_topnav">Apps</a></li></ul></div></div></div><div class="col-3"><div class="translate_placeholder"></div></div></div></div></div></div></div></div></div></div></div><div class="content_container" id="content_container" itemprop="content">
<div class="container-fluid">
<div class="row">
<div class="col-12">

<main id="skip_link_anchor" tabindex="-1">
<div xmlns="http://www.w3.org/1999/xhtml" id="product_info_alert"></div><section xmlns="http://www.w3.org/1999/xhtml" id="doc_center_content" lang="en" data-language="en"><div id="pgtype-topic">
<section><h1 class="r2025b" itemprop="title content" id="bu22m86">Solve Stiff ODEs</h1><div class="examples_short_list hidden_ios_android" data-products="ML"><div data-pane="metadata" class="card metadata_container"><div class="card-body metadata_content"><div class="d-grid"><a class="btn btn_color_blue" href="matlab:openExample('matlab/SolveStiffODEsExample')" data-ex-genre="Script">Open Script</a></div></div></div></div><div itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage/Example" itemprop="example" class="em_example"><meta itemprop="exampleid" content="matlab-SolveStiffODEsExample"><meta itemprop="exampletitle" content="Solve Stiff ODEs"></div><span id="SolveStiffODEsExample" class="anchor_target"></span>



<p class="shortdesc">This page contains two examples of solving stiff ordinary differential equations using <code class="literal">ode15s</code>. MATLAB&#174; has four solvers designed for stiff ODEs.</p>



<p></p>
<div class="itemizedlist"><ul><li><p>
<code class="literal">ode15s</code>
</p></li><li><p>
<code class="literal">ode23s</code>
</p></li><li><p>
<code class="literal">ode23t</code>
</p></li><li><p>
<code class="literal">ode23tb</code>
</p></li></ul></div><p>
</p>



<p>For most stiff problems, <code class="literal">ode15s</code> performs best. However, <code class="literal">ode23s</code>, <code class="literal">ode23t</code>, and <code class="literal">ode23tb</code> can be more efficient if the problem permits a crude error tolerance.</p>




<div class="procedure"><h3 class="title" id="d126e30994">What is a Stiff ODE?<span id="SolveStiffODEsExample-1" class="anchor_target"></span></h3><p>For some ODE problems, the step size taken by the solver is forced down to an unreasonably small level in comparison to the interval of integration, even in a region where the solution curve is smooth. These step sizes can be so small that traversing a short time interval might require millions of evaluations. This can lead to the solver failing the integration, but even if it succeeds it will take a very long time to do so.</p><p>Equations that cause this behavior in ODE solvers are said to be <span class="emphasis"><em>stiff</em></span>. The problem that stiff ODEs pose is that explicit solvers (such as <code class="literal">ode45</code>) are untenably slow in achieving a solution. This is why <code class="literal">ode45</code> is classified as a <span class="emphasis"><em>nonstiff solver</em></span> along with <code class="literal">ode23</code>, <code class="literal">ode78</code>, <code class="literal">ode89</code>, and <code class="literal">ode113</code>.</p><p>Solvers that are designed for stiff ODEs, known as <span class="emphasis"><em>stiff solvers</em></span>, typically do more work per step. The pay-off is that they are able to take much larger steps, and have improved numerical stability compared to the nonstiff solvers.</p><h3 class="title" id="d126e31022">Solver Options<span id="SolveStiffODEsExample-2" class="anchor_target"></span></h3><p>For stiff problems, specifying the Jacobian matrix using <code class="literal">odeset</code> is particularly important. Stiff solvers use the Jacobian matrix <span class="inlineequation"><span class="inlinemediaobject"><img src="../../examples/matlab/win64/SolveStiffODEsExample_eq14404652053725306218.png" alt="$\partial f_i / \partial y_j$"></span></span> to estimate the local behavior of the ODE as the integration proceeds, so supplying the Jacobian matrix (or, for large sparse systems, its sparsity pattern) is critical for efficiency and reliability. Use the <code class="literal">Jacobian</code>, <code class="literal">JPattern</code>, or <code class="literal">Vectorized</code> options of <code class="literal">odeset</code> to specify information about the Jacobian. If you do not supply the Jacobian then the solver estimates it numerically using finite differences.</p><p>See <a href="../ref/odeset.html" data-docid="matlab_ref#bu2m9z6" class="a"><code class="olink">odeset</code></a> for a complete listing of other solver options.</p><h3 class="title" id="d126e31050">Example: Stiff van der Pol Equation<span id="SolveStiffODEsExample-3" class="anchor_target"></span></h3><p>The van der Pol equation is a second order ODE</p><p>
<span class="inlineequation"><span class="inlinemediaobject"><img src="../../examples/matlab/win64/SolveStiffODEsExample_eq01374970303349710905.png" alt="$$y''_1 - \mu \left( 1 - y_1^2\right) y'_1+y_1=0,$$"></span></span></p><p>where <span class="inlineequation"><span class="inlinemediaobject"><img src="../../examples/matlab/win64/SolveStiffODEsExample_eq14190153932616602239.png" alt="$\mu &gt; 0$"></span></span> is a scalar parameter. When <span class="inlineequation"><span class="inlinemediaobject"><img src="../../examples/matlab/win64/SolveStiffODEsExample_eq14804036874424343214.png" alt="$\mu = 1$"></span></span>, the resulting system of ODEs is nonstiff and easily solved using <code class="literal">ode45</code>. However, if you increase <span class="inlineequation"><span class="inlinemediaobject"><img src="../../examples/matlab/win64/SolveStiffODEsExample_eq06904339251718989188.png" alt="$\mu$"></span></span> to 1000, then the solution changes dramatically and exhibits oscillation on a much longer time scale. Approximating the solution of the initial value problem becomes more difficult. Because this particular problem is stiff, a solver intended for nonstiff problems, such as <code class="literal">ode45</code>, is too inefficient to be practical. Use a stiff solver such as <code class="literal">ode15s</code> for this problem instead.</p><p>Rewrite the van der Pol equation as a system of first-order ODEs by making the substitution <span class="inlineequation"><span class="inlinemediaobject"><img src="../../examples/matlab/win64/SolveStiffODEsExample_eq16746764652019956660.png" alt="$y'_1 = y_2$"></span></span>. The resulting system of first-order ODEs is</p><p>
<span class="inlineequation"><span class="inlinemediaobject"><img src="../../examples/matlab/win64/SolveStiffODEsExample_eq17232093241429161234.png" alt="$$&amp;#10;\begin{array}{cl}&amp;#10;y'_1 &amp;#38;= y_2\\&amp;#10;y'_2 &amp;#38;= \mu (1-y_1^2) y_2 - y_1 .\end{array}&amp;#10;$$"></span></span></p><p>The <code class="literal">vdp1000</code> function evaluates the van der Pol equation using <span class="inlineequation"><span class="inlinemediaobject"><img src="../../examples/matlab/win64/SolveStiffODEsExample_eq04323837961458891014.png" alt="$\mu = 1000$"></span></span>.</p><div class="code_responsive"><pre id="d126e31121" class="programlisting">
<span style="color:#0000FF">function</span> dydt = vdp1000(t,y)
<span style="color:#228B22">%VDP1000  Evaluate the van der Pol ODEs for mu = 1000.</span>
<span style="color:#228B22">%</span>
<span style="color:#228B22">%   See also ODE15S, ODE23S, ODE23T, ODE23TB.</span>

<span style="color:#228B22">%   Jacek Kierzenka and Lawrence F. Shampine</span>
<span style="color:#228B22">%   Copyright 1984-2014 The MathWorks, Inc.</span>

dydt = [y(2); 1000*(1-y(1)^2)*y(2)-y(1)];

</pre></div><p>Use the <code class="literal">ode15s</code> function to solve the problem with an initial conditions vector of <code class="literal">[2; 0]</code>, over a time interval of <code class="literal">[0 3000]</code>. For scaling reasons, plot only the first component of the solution.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>[t,y] = ode15s(@vdp1000,[0 3000],[2; 0]);
plot(t,y(:,1),<span style="color:#A020F0">'-o'</span>);
title(<span style="color:#A020F0">'Solution of van der Pol Equation, \mu = 1000'</span>);
xlabel(<span style="color:#A020F0">'Time t'</span>);
ylabel(<span style="color:#A020F0">'Solution y_1'</span>);
</pre></div></div></div><div class="informalfigure"><div id="d126e31134" class="mediaobject"><p><img src="../../examples/matlab/win64/SolveStiffODEsExample_01.png"></p></div></div><p>The <code class="literal">vdpode</code> function also solves the same problem, but it accepts a user-specified value for <span class="inlineequation"><span class="inlinemediaobject"><img src="../../examples/matlab/win64/SolveStiffODEsExample_eq06904339251718989188.png" alt="$\mu$"></span></span>. The equations become increasingly stiff as <span class="inlineequation"><span class="inlinemediaobject"><img src="../../examples/matlab/win64/SolveStiffODEsExample_eq06904339251718989188.png" alt="$\mu$"></span></span> increases.</p><h3 class="title" id="d126e31156">Example: Sparse Brusselator System<span id="SolveStiffODEsExample-8" class="anchor_target"></span></h3><p>The classic Brusselator system of equations is potentially large, stiff, and sparse. The Brusselator system models diffusion in a chemical reaction, and is represented by a system of equations involving <span class="inlineequation"><span class="inlinemediaobject"><img src="../../examples/matlab/win64/SolveStiffODEsExample_eq15012583454694319273.png" alt="$u$"></span></span>, <span class="inlineequation"><span class="inlinemediaobject"><img src="../../examples/matlab/win64/SolveStiffODEsExample_eq10084146807967347884.png" alt="$v$"></span></span>, <span class="inlineequation"><span class="inlinemediaobject"><img src="../../examples/matlab/win64/SolveStiffODEsExample_eq08789379686457383329.png" alt="$u'$"></span></span>, and <span class="inlineequation"><span class="inlinemediaobject"><img src="../../examples/matlab/win64/SolveStiffODEsExample_eq14032119228290301699.png" alt="$v'$"></span></span>.</p><p>
<span class="inlineequation"><span class="inlinemediaobject"><img src="../../examples/matlab/win64/SolveStiffODEsExample_eq03222753475747217707.png" alt="$$ \begin{array}{cl} u'_i &amp;#38;= 1+u_i^2v_i-4u_i+ \alpha \left( N + 1 \right)&amp;#10;^2 \left( u_{i-1}-2_i+u_{i+1} \right)\\ v'_i &amp;#38;= 3u_i-u_i^2v_i + \alpha&amp;#10;\left( N+1 \right) ^2 \left( v_{i-1} - 2v_i+v_{i+1} \right) \end{array}$$"></span></span></p><p>The function file <code class="literal">brussode</code> solves this set of equations on the time interval <code class="literal">[0,10]</code> with <span class="inlineequation"><span class="inlinemediaobject"><img src="../../examples/matlab/win64/SolveStiffODEsExample_eq06022388929367564458.png" alt="$\alpha = 1/50$"></span></span>. The initial conditions are</p><p>
<span class="inlineequation"><span class="inlinemediaobject"><img src="../../examples/matlab/win64/SolveStiffODEsExample_eq01551345748354489979.png" alt="$$\begin{array}{cl} u_j(0) &amp;#38;= 1+\sin(2 \pi x_j)\\ v_j(0) &amp;#38;=&amp;#10;3,\end{array}$$"></span></span></p><p>where <span class="inlineequation"><span class="inlinemediaobject"><img src="../../examples/matlab/win64/SolveStiffODEsExample_eq11333336644902288051.png" alt="$x_j = i/N+1$"></span></span> for <span class="inlineequation"><span class="inlinemediaobject"><img src="../../examples/matlab/win64/SolveStiffODEsExample_eq03872621305724922844.png" alt="$i=1,...,N$"></span></span>. Therefore, there are <span class="inlineequation"><span class="inlinemediaobject"><img src="../../examples/matlab/win64/SolveStiffODEsExample_eq07498836001828572361.png" alt="$2N$"></span></span> equations in the system, but the Jacobian <span class="inlineequation"><span class="inlinemediaobject"><img src="../../examples/matlab/win64/SolveStiffODEsExample_eq03016153628059986538.png" alt="$\partial f / \partial y$"></span></span> is a banded matrix with a constant width of 5 if the equations are ordered as <span class="inlineequation"><span class="inlinemediaobject"><img src="../../examples/matlab/win64/SolveStiffODEsExample_eq14309497067264596797.png" alt="$u_1,v_1,u_2,v_2,...$"></span></span>. As <span class="inlineequation"><span class="inlinemediaobject"><img src="../../examples/matlab/win64/SolveStiffODEsExample_eq05705075896852816573.png" alt="$N$"></span></span> increases, the problem becomes increasingly stiff, and the Jacobian becomes increasingly sparse.</p><p>The function call <code class="literal">brussode(N)</code>, for <span class="inlineequation"><span class="inlinemediaobject"><img src="../../examples/matlab/win64/SolveStiffODEsExample_eq13366284049272132126.png" alt="$N \ge 2$"></span></span>, specifies a value for <code class="literal">N</code> in the system of equations, corresponding to the number of grid points. By default, <code class="literal">brussode</code> uses <span class="inlineequation"><span class="inlinemediaobject"><img src="../../examples/matlab/win64/SolveStiffODEsExample_eq01908310036329232103.png" alt="$N = 20$"></span></span>.</p><p>
<code class="literal">brussode</code> contains a few subfunctions:</p><div class="itemizedlist"><ul><li><p>The nested function <code class="literal">f(t,y)</code> encodes the system of equations for the Brusselator problem, returning a vector.</p></li><li><p>The local function <code class="literal">jpattern(N)</code> returns a sparse matrix of 1s and 0s showing the locations of nonzeros in the Jacobian. This matrix is assigned to the <code class="literal">JPattern</code> field of the options structure. The ODE solver uses this sparsity pattern to generate the Jacobian numerically as a sparse matrix. Supplying this sparsity pattern in the problem significantly reduces the number of function evaluations required to generate the 2N-by-2N Jacobian, from 2N evaluations to just 4.</p></li></ul></div><div class="code_responsive"><pre id="d126e31303" class="programlisting">
<span style="color:#0000FF">function</span> brussode(N)
<span style="color:#228B22">%BRUSSODE  Stiff problem modelling a chemical reaction (the Brusselator).</span>
<span style="color:#228B22">%   The parameter N &gt;= 2 is used to specify the number of grid points; the</span>
<span style="color:#228B22">%   resulting system consists of 2N equations. By default, N is 20.  The</span>
<span style="color:#228B22">%   problem becomes increasingly stiff and increasingly sparse as N is</span>
<span style="color:#228B22">%   increased.  The Jacobian for this problem is a sparse constant matrix</span>
<span style="color:#228B22">%   (banded with bandwidth 5).</span>
<span style="color:#228B22">%</span>
<span style="color:#228B22">%   The property 'JPattern' is used to provide the solver with a sparse</span>
<span style="color:#228B22">%   matrix of 1's and 0's showing the locations of nonzeros in the Jacobian</span>
<span style="color:#228B22">%   df/dy.  By default, the stiff solvers of the ODE Suite generate Jacobians</span>
<span style="color:#228B22">%   numerically as full matrices.  However, when a sparsity pattern is</span>
<span style="color:#228B22">%   provided, the solver uses it to generate the Jacobian numerically as a</span>
<span style="color:#228B22">%   sparse matrix.  Providing a sparsity pattern can significantly reduce the</span>
<span style="color:#228B22">%   number of function evaluations required to generate the Jacobian and can</span>
<span style="color:#228B22">%   accelerate integration.  For the BRUSSODE problem, only 4 evaluations of</span>
<span style="color:#228B22">%   the function are needed to compute the 2N x 2N Jacobian matrix.</span>
<span style="color:#228B22">%</span>
<span style="color:#228B22">%   Setting the 'Vectorized' property indicates the function f is</span>
<span style="color:#228B22">%   vectorized.</span>
<span style="color:#228B22">%</span>
<span style="color:#228B22">%   E. Hairer and G. Wanner, Solving Ordinary Differential Equations II,</span>
<span style="color:#228B22">%   Stiff and Differential-Algebraic Problems, Springer-Verlag, Berlin,</span>
<span style="color:#228B22">%   1991, pp. 5-8.</span>
<span style="color:#228B22">%</span>
<span style="color:#228B22">%   See also ODE15S, ODE23S, ODE23T, ODE23TB, ODESET, FUNCTION_HANDLE.</span>

<span style="color:#228B22">%   Mark W. Reichelt and Lawrence F. Shampine, 8-30-94</span>
<span style="color:#228B22">%   Copyright 1984-2014 The MathWorks, Inc.</span>

<span style="color:#228B22">% Problem parameter, shared with the nested function.</span>
<span style="color:#0000FF">if</span> nargin&lt;1
   N = 20;
<span style="color:#0000FF">end</span>

tspan = [0; 10];
y0 = [1+sin((2*pi/(N+1))*(1:N)); repmat(3,1,N)];

options = odeset(<span style="color:#A020F0">'Vectorized'</span>,<span style="color:#A020F0">'on'</span>,<span style="color:#A020F0">'JPattern'</span>,jpattern(N));

[t,y] = ode15s(@f,tspan,y0,options);

u = y(:,1:2:end);
x = (1:N)/(N+1);
figure;
surf(x,t,u);
view(-40,30);
xlabel(<span style="color:#A020F0">'space'</span>);
ylabel(<span style="color:#A020F0">'time'</span>);
zlabel(<span style="color:#A020F0">'solution u'</span>);
title([<span style="color:#A020F0">'The Brusselator for N = '</span> num2str(N)]);

<span style="color:#228B22">% -------------------------------------------------------------------------</span>
<span style="color:#228B22">% Nested function -- N is provided by the outer function.</span>
<span style="color:#228B22">%</span>

   <span style="color:#0000FF">function</span> dydt = f(t,y)
      <span style="color:#228B22">% Derivative function</span>
      c = 0.02 * (N+1)^2;
      dydt = zeros(2*N,size(y,2));      <span style="color:#228B22">% preallocate dy/dt</span>
      
      <span style="color:#228B22">% Evaluate the 2 components of the function at one edge of the grid</span>
      <span style="color:#228B22">% (with edge conditions).</span>
      i = 1;
      dydt(i,:) = 1 + y(i+1,:).*y(i,:).^2 - 4*y(i,:) + c*(1-2*y(i,:)+y(i+2,:));
      dydt(i+1,:) = 3*y(i,:) - y(i+1,:).*y(i,:).^2 + c*(3-2*y(i+1,:)+y(i+3,:));
      
      <span style="color:#228B22">% Evaluate the 2 components of the function at all interior grid points.</span>
      i = 3:2:2*N-3;
      dydt(i,:) = 1 + y(i+1,:).*y(i,:).^2 - 4*y(i,:) + <span style="color:#0000FF">...</span>
         c*(y(i-2,:)-2*y(i,:)+y(i+2,:));
      dydt(i+1,:) = 3*y(i,:) - y(i+1,:).*y(i,:).^2 + <span style="color:#0000FF">...</span>
         c*(y(i-1,:)-2*y(i+1,:)+y(i+3,:));
      
      <span style="color:#228B22">% Evaluate the 2 components of the function at the other edge of the grid</span>
      <span style="color:#228B22">% (with edge conditions).</span>
      i = 2*N-1;
      dydt(i,:) = 1 + y(i+1,:).*y(i,:).^2 - 4*y(i,:) + c*(y(i-2,:)-2*y(i,:)+1);
      dydt(i+1,:) = 3*y(i,:) - y(i+1,:).*y(i,:).^2 + c*(y(i-1,:)-2*y(i+1,:)+3);
   <span style="color:#0000FF">end</span>
<span style="color:#228B22">% -------------------------------------------------------------------------</span>

<span style="color:#0000FF">end</span>  <span style="color:#228B22">% brussode</span>

<span style="color:#228B22">% ---------------------------------------------------------------------------</span>
<span style="color:#228B22">% Subfunction -- the sparsity pattern</span>
<span style="color:#228B22">%</span>

<span style="color:#0000FF">function</span> S = jpattern(N)
<span style="color:#228B22">% Jacobian sparsity pattern</span>
B = ones(2*N,5);
B(2:2:2*N,2) = zeros(N,1);
B(1:2:2*N-1,4) = zeros(N,1);
S = spdiags(B,-2:2,2*N,2*N);
<span style="color:#0000FF">end</span>
<span style="color:#228B22">% ---------------------------------------------------------------------------</span>

</pre></div><p>Solve the Brusselator system for <span class="inlineequation"><span class="inlinemediaobject"><img src="../../examples/matlab/win64/SolveStiffODEsExample_eq17303703421216465470.png" alt="$N=20$"></span></span> by running the function <code class="literal">brussode</code>.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>brussode
</pre></div></div></div><div class="informalfigure"><div id="d126e31320" class="mediaobject"><p><img src="../../examples/matlab/win64/SolveStiffODEsExample_02.png"></p></div></div><p>Solve the system for <span class="inlineequation"><span class="inlinemediaobject"><img src="../../examples/matlab/win64/SolveStiffODEsExample_eq18286486512009396200.png" alt="$N=50$"></span></span> by specifying an input to <code class="literal">brussode</code>.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>brussode(50)
</pre></div></div></div><div class="informalfigure"><div id="d126e31337" class="mediaobject"><p><img src="../../examples/matlab/win64/SolveStiffODEsExample_03.png"></p></div></div></div>
<h2 id="d126e31343">See Also</h2><p><span itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage/SeeAlso" itemprop="seealso"><a itemprop="url" href="../ref/ode15s.html"><span itemprop="name"><code class="function">ode15s</code></span></a></span> | <span itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage/SeeAlso" itemprop="seealso"><a itemprop="url" href="../ref/ode23s.html"><span itemprop="name"><code class="function">ode23s</code></span></a></span> | <span itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage/SeeAlso" itemprop="seealso"><a itemprop="url" href="../ref/ode23t.html"><span itemprop="name"><code class="function">ode23t</code></span></a></span> | <span itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage/SeeAlso" itemprop="seealso"><a itemprop="url" href="../ref/ode23tb.html"><span itemprop="name"><code class="function">ode23tb</code></span></a></span></p>

<h3 id="d126e31356">Topics</h3><ul class="list-unstyled"><li><a href="choose-an-ode-solver.html" class="a">Choose an ODE Solver</a></li><li><a href="summary-of-ode-options.html" class="a">Summary of ODE Options</a></li><li><a href="parameterizing-functions.html" class="a">Parameterizing Functions</a></li></ul>

</section>
    </div></section><div xmlns="http://www.w3.org/1999/xhtml" class="clearfix"></div>
<div xmlns="http://www.w3.org/1999/xhtml" align="center" class="feedbackblock" id="mw_docsurvey"><script src="https://www.mathworks.com/help/docsurvey/docfeedback.js"></script>
<script>loadSurveyHidden();</script>
<link rel="stylesheet" href="https://www.mathworks.com/help/docsurvey/release/index-css.css" type="text/css">
<script src="https://www.mathworks.com/help/docsurvey/release/bundle.index.js"></script>

<script>initDocSurvey();</script></div></main>


</div>
</div>
</div>
</div><!--close_0960-->
<footer xmlns="http://www.w3.org/1999/xhtml" id="footer" class="bs-footer">
<div class="container-fluid">
<div class="footer">
<div class="row">
<div class="col-12">
<p class="copyright">Â© 1994-2025 The MathWorks, Inc.</p>
<ul class="footernav"><li class="footernav_help"><a href="matlab:web(matlab.internal.licenseAgreement)">Terms of Use</a></li><li class="footernav_patents"><a href="matlab:web([matlabroot '/patents.txt'])">Patents</a></li><li class="footernav_trademarks"><a href="matlab:web([matlabroot '/trademarks.txt'])">Trademarks</a></li><li class="footernav_piracy"><a href="matlab:web([docroot '/acknowledgments.html'])">Acknowledgments</a></li></ul></div>
</div>
</div>
</div>
</footer>
</div><!--close row-offcanvas-->
</div><!--close_0970-->
</body>
</html>
