<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage">
<head>
<meta xmlns="http://www.w3.org/1999/xhtml" charset="utf-8">
<meta xmlns="http://www.w3.org/1999/xhtml" name="viewport" content="width=device-width, initial-scale=1.0">
<meta xmlns="http://www.w3.org/1999/xhtml" http-equiv="X-UA-Compatible" content="IE=edge">
<title>Find Prime Factors Using Shor's Algorithm</title>
<script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
      {
      "@context": "http://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement":
      [{
          "@type": "ListItem",
          "position": 1,

          "item": {
          "@id": "../index.html",
          "name": "MATLAB"
}

          } 
        ,
        {
          "@type": "ListItem",
          "position": 2,

          "item": {
          "@id": "../mathematics.html",
          "name": "Mathematics"
}

          }
        ,
        {
          "@type": "ListItem",
          "position": 3,

          "item": {
          "@id": "../quantum-computing.html",
          "name": "Quantum Computing"
}

          }
        ,
        {
          "@type": "ListItem",
          "position": 4,

          "item": {
          "@id": "../gate-based-quantum-computing.html",
          "name": "Gate-Based Quantum Computing"
}

          }]
      }</script><script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "ItemList",
          "name": "VisibleBreadcrumbs",

        "itemListElement":
        [
        "gate-based-quantum-computing"
        ],
        "itemListOrder": "http://schema.org/ItemListOrderAscending"
        }
        </script><script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "DigitalDocument",
          "headline": "Find Prime Factors Using Shor's Algorithm",
          "description": "Apply Shor's algorithm to find the prime factors of a composite number N .",
          "thumbnailURL": "../../examples/quantum/win64/ShorsAlgorithmForPrimeFactorizationExample_01.png",
          "genre": "Live Script",
          "isBasedOn": {
          "@type": "Product",
          "name": "MATLAB"

        },
          "identifier": "quantum.ShorsAlgorithmForPrimeFactorizationExample",
          "name": "ShorsAlgorithmForPrimeFactorizationExample",
          "url": "shors-algorithm-for-prime-factorization.html"

        }</script><script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "PropertyValue",
          "name": "open_command",
          "value": "matlab:openExample('quantum/ShorsAlgorithmForPrimeFactorizationExample')"

        }</script><script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "ItemList",
          "name": "ExampleSourceFiles",

        "itemListElement":
        [
        "ShorsAlgorithmForPrimeFactorizationExample.mlx"
        ],
        "itemListOrder": "http://schema.org/ItemListOrderAscending"
        }
        </script><link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/bootstrap.min.css" rel="stylesheet" type="text/css">


  <meta xmlns="http://www.w3.org/1999/xhtml" http-equiv="Content-Script-Type" content="text/javascript">
<meta xmlns="http://www.w3.org/1999/xhtml" name="toctype" itemprop="pagetype" content="con">
<meta xmlns="http://www.w3.org/1999/xhtml" name="infotype" itemprop="infotype" content="con">

<meta xmlns="http://www.w3.org/1999/xhtml" name="description" itemprop="description" content="This example shows how to apply Shor's algorithm to find the prime factors of a composite number N ."><meta xmlns="http://www.w3.org/1999/xhtml" content="../../examples/quantum/win64/ShorsAlgorithmForPrimeFactorizationExample_01.png" itemprop="thumbnailUrl">
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/jquery/jquery-3.6.0.min.js"></script><script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/jquery/jquery-migrate.min.js"></script>
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6.css" rel="stylesheet" type="text/css">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_lg.css" rel="stylesheet" media="screen and (min-width: 1200px)">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_md.css" rel="stylesheet" media="screen and (min-width: 992px) and (max-width: 1199px)">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_sm+xs.css" rel="stylesheet" media="screen and (max-width: 991px)">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_sm.css" rel="stylesheet" media="screen and (min-width: 768px) and (max-width: 991px)">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_xs.css" rel="stylesheet" media="screen and (max-width: 767px)">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_offcanvas_v2.css" rel="stylesheet" type="text/css">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/shared/highlight/styles/mwdochighlight.min.css" rel="stylesheet" type="text/css">

<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/l10n.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/docscripts.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/f1help.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/docscripts.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/mw.imageanimation.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/jquery.highlight.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/underscore-min.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/use_platform_screenshots.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/suggest.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/overload.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/helpservices.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/productfilter.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/matlab_dialog_shared.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/highlight/highlight.min.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/localstorage.js"></script><script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/product_group.js"></script><script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/saxonjs/SaxonJS2.rt.js"></script><script xmlns="http://www.w3.org/1999/xhtml">
            window.history.replaceState(window.location.href, null, ""); // Initialize
            window.onload = function() {    
            mystylesheetLocation = "../../includes/shared/scripts/product_group-sef.json";
            mysourceLocation = "../../docset/docset.xml";
            product_help_location = "matlab";
            pagetype = "section";
            doccentertype = "product";
            langcode = "";
            getProductFilteredList(mystylesheetLocation, mysourceLocation, product_help_location, pagetype, doccentertype, langcode);  
            }
          </script>




<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/jquery/jquery.mobile.custom.min.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/bootstrap.bundle.min.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/global.js"></script>
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/doc_center_base.css" rel="stylesheet" type="text/css">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/doc_center_installed.css" rel="stylesheet" type="text/css">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/doc_center_print.css" rel="stylesheet" type="text/css" media="print">
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/equationrenderer/release/MathRenderer.js"></script>
</head>
<body id="responsive_offcanvas">
<div xmlns="http://www.w3.org/1999/xhtml" id="doc_header_spacer" class="header"></div>
<div xmlns="http://www.w3.org/1999/xhtml" class="section_header level_3"><div class="container-fluid"><div class="row" id="mobile_search_row"><div class="col-sm-6 col-md-7 has_horizontal_local_nav" id="section_header_title"><div class="section_header_content"><div class="section_header_title"><h1><a href="../../documentation-center.html">Help Center</a></h1></div></div></div><div class="col-12 col-sm-6 col-md-5" id="mobile_search"><div class="search_nested_content_container"><form id="docsearch_form" name="docsearch_form" method="get" data-release="R2025b" data-language="en" action="../../templates/searchresults.html"><div class="input-group tokenized_search_field"><label class="visually-hidden form-label">Search Help</label><input type="text" class="form-control conjoined_search" autocomplete="off" name="qdoc" placeholder="Search Help" id="docsearch"> <div><button type="submit" name="submitsearch" id="submitsearch" class="btn icon-search btn_search_adjacent btn_search icon_16" tabindex="-1"></button></div></div></form></div><button class="btn icon-remove btn_search float-end icon_32 d-sm-none" data-bs-toggle="collapse" href="#mobile_search" aria-expanded="false" aria-controls="mobile_search"></button></div><div class="d-sm-none" id="search_actuator"><button class="btn icon-search btn_search float-end icon_16" data-bs-toggle="collapse" href="#mobile_search" aria-expanded="false" aria-controls="mobile_search"></button></div></div></div></div><div class="row-offcanvas row-offcanvas-left">
<div xmlns="http://www.w3.org/1999/xhtml" class="sidebar-offcanvas" id="sidebar">
<nav class="offcanvas_nav" role="navigation">
<div class="offcanvas_actuator" data-bs-toggle="offcanvas" data-bs-target="#sidebar" id="nav_toggle"><button type="button" class="btn"><span class="visually-hidden">Off-Canvas Navigation Menu Toggle
                  Off-Canvas Navigation Menu Toggle</span><span class="icon-menu"></span></button><span class="offcanvas_actuator_label" id="translation_icon-menu" tabindex="-1" aria-hidden="true"></span></div><div class="nav_list_wrapper" id="nav_list_wrapper"><nav class="offcanvas_nav" role="navigation"><ul class="nav_breadcrumb" id="ul_left_nav_ancestors"><li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../../documentation-center.html?s_tid=CRUX_lftnav" itemprop="url"><span itemprop="title">Documentation Home</span></a></li></ul>
<ul class="nav_disambiguation"><li><a href="../index.html?s_tid=CRUX_lftnav" id="index">MATLAB</a>
</li>
<li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../mathematics.html?s_tid=CRUX_lftnav" itemprop="url"><span itemprop="title">Mathematics</span></a></li><li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../quantum-computing.html?s_tid=CRUX_lftnav" itemprop="url"><span itemprop="title">Quantum Computing</span></a></li><li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../gate-based-quantum-computing.html?s_tid=CRUX_lftnav" itemprop="url" id="mw_89c73565-106a-4694-9620-a4310ac5bfc3"><span itemprop="title">Gate-Based Quantum Computing</span></a></li></ul><div class="search_refine_v4"><div id="facets_area"><ul class="nav_scrollspy nav list-unstyled" id="pnav">
<li class="nav_scrollspy_function nav-item"><a href="#responsive_offcanvas">Find Prime Factors Using Shor's Algorithm</a></li>
<li class="nav_scrollspy_title nav-item" id="SSPY810-section">On this page</li>
<!--ADD_REFENTRY_TITLE_HERE 11--><li class="nav-item"><a href="#ShorsAlgorithmForPrimeFactorizationExample-1" class="nav-link intrnllnk">Create Circuit for Modular Exponentiation</a></li><li class="nav-item"><a href="#ShorsAlgorithmForPrimeFactorizationExample-2" class="nav-link intrnllnk">Find Prime Factors of 15</a></li><li class="nav-item"><a href="#ShorsAlgorithmForPrimeFactorizationExample-3" class="nav-link intrnllnk">Find Prime Factors of 143 and 247</a></li><li class="nav-item"><a href="#ShorsAlgorithmForPrimeFactorizationExample-4" class="nav-link intrnllnk">References</a></li><li class="nav-item"><a href="#d126e66567" class="nav-link intrnllnk">See Also</a></li></ul></div></div>
</nav></div></nav>
<script src="../../includes/product/scripts/offcanvas_v2.js"></script></div><!--END.CLASS sidebar-offcanvas-->
<div class="offcanvas_content_container">
<div xmlns="http://www.w3.org/1999/xhtml" class="sticky_header_container"><div class="horizontal_nav"><div class="horizontal_nav_container"><div class="offcanvas_horizontal_nav"><div class="container-fluid"><div class="row"><div class="col-sm-12 d-none d-sm-block"><nav class="navbar navbar-default" role="navigation" id="subnav"><div><ul class="nav navbar-nav crux_browse"><li id="crux_nav_documentation" class="crux_resource active">Documentation</li><li id="crux_nav_example" class="crux_resource"><a href="../examples.html?category=gate-based-quantum-computing&amp;s_tid=CRUX_topnav">Examples</a></li><li id="crux_nav_function" class="crux_resource"><a href="../referencelist.html?type=function&amp;category=gate-based-quantum-computing&amp;s_tid=CRUX_topnav">Functions</a></li><li id="crux_nav_app" class="crux_resource"><a href="../referencelist.html?type=app&amp;category=gate-based-quantum-computing&amp;s_tid=CRUX_topnav">Apps</a></li></ul></div></nav></div><div class="d-sm-none"><div class="container-fluid"><div class="row"><div class="col-9"><div class="mobile_crux_nav_trigger"><div class="btn-group"><button type="button" class="btn btn-default dropdown-toggle" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Resources</button><ul class="dropdown-menu"><li id="crux_nav_mobile_documentation" class="crux_resource active">Documentation</li><li id="crux_nav_mobile_example" class="crux_resource"><a href="../examples.html?category=gate-based-quantum-computing&amp;s_tid=CRUX_topnav">Examples</a></li><li id="crux_nav_mobile_function" class="crux_resource"><a href="../referencelist.html?type=function&amp;category=gate-based-quantum-computing&amp;s_tid=CRUX_topnav">Functions</a></li><li id="crux_nav_mobile_app" class="crux_resource"><a href="../referencelist.html?type=app&amp;category=gate-based-quantum-computing&amp;s_tid=CRUX_topnav">Apps</a></li></ul></div></div></div><div class="col-3"><div class="translate_placeholder"></div></div></div></div></div></div></div></div></div></div></div><div class="content_container" id="content_container" itemprop="content">
<div class="container-fluid">
<div class="row">
<div class="col-12">

<main id="skip_link_anchor" tabindex="-1">
<div xmlns="http://www.w3.org/1999/xhtml" id="product_info_alert"></div><section xmlns="http://www.w3.org/1999/xhtml" id="doc_center_content" lang="en" data-language="en"><div id="pgtype-topic">
<section><h1 class="r2025b" itemprop="title content" id="mw_5282e1cf-7c06-4222-b07b-02c4ae901fcc">Find Prime Factors Using Shor's Algorithm</h1><div class="examples_short_list hidden_ios_android" data-products="ML QUANTUM"><div data-pane="metadata" class="card metadata_container"><div class="card-body metadata_content"><p class="add_margin_5">This example uses:</p><ul class="list-unstyled add_border_bottom example_product_list" itemprop="requiredprods"><li><a href="matlab:matlab.internal.addons.showAddon('QUANTUM')">MATLAB Support Package for Quantum Computing</a></li></ul><div class="d-grid"><a class="btn btn_color_blue" href="matlab:openExample('quantum/ShorsAlgorithmForPrimeFactorizationExample')" data-ex-genre="Live Script">Open Live Script</a></div></div></div></div><div itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage/Example" itemprop="example" class="em_example"><meta itemprop="exampleid" content="quantum-ShorsAlgorithmForPrimeFactorizationExample"><meta itemprop="exampletitle" content="Find Prime Factors Using Shor's Algorithm"></div><span id="ShorsAlgorithmForPrimeFactorizationExample" class="anchor_target"></span><p class="shortdesc">This example shows how to apply Shor's algorithm to find the prime factors of a composite number <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">N</mi></mrow></math></span>. This algorithm was developed in 1994 by Peter Shor <a href="shors-algorithm-for-prime-factorization.html#mw_rtc_ShorsAlgorithmForPrimeFactorizationExample_M_51ba" class="intrnllnk">[1]</a>, who demonstrated how quantum computers can solve specific problems in polynomial time that would otherwise require more than polynomial time on classical computers.</p><p>To find the prime factors <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">p</mi></mrow></math></span> and <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">q</mi></mrow></math></span> of <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true"><mi mathvariant="italic">N</mi></math></span> using Shor's algorithm:</p><div class="orderedlist"><ol style="list-style: decimal;"><li><p>Choose an integer <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">a</mi></mrow></math></span> in the interval <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mn>1</mn><mo>&lt;</mo><mi>a</mi><mo>&lt;</mo><mi>N</mi></mrow></math></span> that is coprime to <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true"><mi mathvariant="italic">N</mi></math></span>.</p></li><li><p>Find the period <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">r</mi></mrow></math></span> of the modular exponentiation function <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi>f</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>=</mo><msup><mrow><mi mathvariant="italic">a</mi></mrow><mrow><mi mathvariant="italic">x</mi></mrow></msup><mtext> </mtext><mi mathvariant="normal">mod</mi><mtext> </mtext><mi mathvariant="italic">N</mi></mrow></math></span>, where <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true"><mi mathvariant="italic">r</mi></math></span> is the smallest positive integer that satisfies the congruence <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><msup><mrow><mi mathvariant="italic">a</mi></mrow><mrow><mi mathvariant="italic">r</mi></mrow></msup><mo>≡</mo><mn>1</mn><mtext> </mtext><mrow><mo>(</mo><mrow><mi mathvariant="normal">mod</mi><mtext> </mtext><mi mathvariant="italic">N</mi></mrow><mo>)</mo></mrow></mrow></math></span>.</p></li><li><p>Check if <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true"><mi mathvariant="italic">r</mi></math></span> is even and if it satisfies the relation <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><msup><mrow><mi mathvariant="italic">a</mi></mrow><mrow><mrow><mrow><mi mathvariant="italic">r</mi></mrow><mo>/</mo><mrow><mn>2</mn></mrow></mrow></mrow></msup><mo>≢</mo><mo>-</mo><mn>1</mn><mtext> </mtext><mrow><mo>(</mo><mrow><mi mathvariant="normal">mod</mi><mtext> </mtext><mi mathvariant="italic">N</mi></mrow><mo>)</mo></mrow></mrow></math></span>. If both conditions are true, compute the factors of <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true"><mi mathvariant="italic">N</mi></math></span> as <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">p</mi><mo>=</mo><mi mathvariant="normal">gcd</mi><mrow><mo>(</mo><mrow><msup><mrow><mi mathvariant="italic">a</mi></mrow><mrow><mrow><mrow><mi mathvariant="italic">r</mi></mrow><mo>/</mo><mrow><mn>2</mn></mrow></mrow></mrow></msup><mo>-</mo><mn>1</mn><mo>,</mo><mi mathvariant="italic">N</mi></mrow><mo>)</mo></mrow></mrow></math></span> and <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">q</mi><mo>=</mo><mi mathvariant="normal">gcd</mi><mrow><mo>(</mo><mrow><msup><mrow><mi mathvariant="italic">a</mi></mrow><mrow><mrow><mrow><mi mathvariant="italic">r</mi></mrow><mo>/</mo><mrow><mn>2</mn></mrow></mrow></mrow></msup><mo>+</mo><mn>1</mn><mo>,</mo><mi mathvariant="italic">N</mi></mrow><mo>)</mo></mrow></mrow></math></span>. If either condition is not true, return to step 1 to choose a different value of <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true"><mi mathvariant="italic">a</mi></math></span> until both conditions are satisfied.</p></li></ol></div><p>The key step in Shor's algorithm is step 2, where quantum computers can find the period of the modular exponentiation function more efficiently than classical computers. On a quantum computer, this step can run in polynomial time with respect to the input size, which is <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="normal">log</mi><mtext> </mtext><mi mathvariant="italic">N</mi></mrow></math></span> bits, while the other steps to find greatest common divisors require only logarithmic time. In contrast, the best-known classical factoring algorithm operates in sub-exponential time.</p><p>You can implement step 2 in Shor's algorithm by using a quantum phase estimation circuit with <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">n</mi></mrow></math></span> upper qubits and <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">m</mi></mrow></math></span> lower qubits. The circuit consists of the oracle <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><msub><mrow><mi mathvariant="italic">U</mi></mrow><mrow><mi mathvariant="italic">f</mi></mrow></msub></mrow></math></span> to handle the modular exponentiation <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true"><mi>f</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>=</mo><msup><mrow><mi mathvariant="italic">a</mi></mrow><mrow><mi mathvariant="italic">x</mi></mrow></msup><mtext> </mtext><mi mathvariant="normal">mod</mi><mtext> </mtext><mi mathvariant="italic">N</mi></math></span> and the inverse quantum Fourier transform to find the period <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true"><mi mathvariant="italic">r</mi></math></span> from phase estimation, as illustrated in this figure.</p><div class="informalfigure"><div id="d126e65084" class="mediaobject"><p><img src="../../examples/quantum/win64/ShorsAlgorithmForPrimeFactorizationExample_01.png" alt="Quantum circuit implementation for step 2 of Shor's algorithm" height="292" width="439"></p></div></div><p>The quantum circuit implementation of the modular exponentiation function is a bottleneck in Shor's algorithm. Often, such circuits require a large number of gates, circuit depth, and qubits, which can lead to significant noise and decoherence in the measurement results. However, there are several approaches for constructing the modular exponentiation function (see <a href="shors-algorithm-for-prime-factorization.html#mw_rtc_ShorsAlgorithmForPrimeFactorizationExample_M_9061" class="intrnllnk">[2]</a> and <a href="shors-algorithm-for-prime-factorization.html#mw_rtc_ShorsAlgorithmForPrimeFactorizationExample_M_599a" class="intrnllnk">[3]</a>). One approach is to use a specially designed circuit for the modular exponentiation function with specific values of <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">a</mi></mrow></math></span> and <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true"><mi mathvariant="italic">N</mi></math></span>, as discussed in [3]. This example shows how to implement these specially designed circuits to find the prime factors of 15, 143, and 247 using local simulation.</p><div class="procedure"><h3 class="title" id="ShorsAlgorithmForPrimeFactorizationExample-1">Create Circuit for Modular Exponentiation</h3><p>You can decompose the modular exponentiation function <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true"><mi>f</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>=</mo><msup><mrow><mi mathvariant="italic">a</mi></mrow><mrow><mi mathvariant="italic">x</mi></mrow></msup><mtext> </mtext><mi mathvariant="normal">mod</mi><mtext> </mtext><mi mathvariant="italic">N</mi></math></span> into a product</p><p class="displayequation"><span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><msup><mrow><mi mathvariant="italic">a</mi></mrow><mrow><mi mathvariant="italic">x</mi></mrow></msup><mtext> </mtext><mi mathvariant="normal">mod</mi><mtext> </mtext><mi mathvariant="italic">N</mi><mo>=</mo><mrow><mo>(</mo><mrow><mo>…</mo><mrow><mo>(</mo><mrow><mrow><mo>(</mo><mrow><msup><mrow><mi mathvariant="italic">a</mi></mrow><mrow><msub><mrow><mi mathvariant="italic">x</mi></mrow><mrow><mi mathvariant="italic">n</mi></mrow></msub><mo>⋅</mo><msup><mrow><mn>2</mn></mrow><mrow><mn>0</mn></mrow></msup></mrow></msup><mi mathvariant="normal">mod</mi><mtext> </mtext><mi mathvariant="italic">N</mi></mrow><mo>)</mo></mrow><mo>×</mo><msup><mrow><mi mathvariant="italic">a</mi></mrow><mrow><msub><mrow><mi mathvariant="italic">x</mi></mrow><mrow><mi mathvariant="italic">n</mi><mo>-</mo><mn>1</mn></mrow></msub><mo>⋅</mo><msup><mrow><mn>2</mn></mrow><mrow><mn>1</mn></mrow></msup></mrow></msup><mi mathvariant="normal">mod</mi><mtext> </mtext><mi mathvariant="italic">N</mi></mrow><mo>)</mo></mrow><mo>×</mo><mo>…</mo></mrow><mo>)</mo></mrow><mo>×</mo><msup><mrow><mi mathvariant="italic">a</mi></mrow><mrow><msub><mrow><mi mathvariant="italic">x</mi></mrow><mrow><mn>1</mn></mrow></msub><mo>⋅</mo><msup><mrow><mn>2</mn></mrow><mrow><mi mathvariant="italic">n</mi><mo>-</mo><mn>1</mn></mrow></msup></mrow></msup><mi mathvariant="normal">mod</mi><mtext> </mtext><mi mathvariant="italic">N</mi></mrow></math></span>,</p><p>where </p><p></p>
<div class="code_responsive"><p class="programlistingindent"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="block"><mrow><mi mathvariant="italic">x</mi><mo>=</mo><msub><mrow><mi mathvariant="italic">x</mi></mrow><mrow><mn>1</mn></mrow></msub><mo>⋅</mo><msup><mrow><mn>2</mn></mrow><mrow><mi mathvariant="italic">n</mi><mo>-</mo><mn>1</mn></mrow></msup><mo>+</mo><msub><mrow><mi mathvariant="italic">x</mi></mrow><mrow><mn>2</mn></mrow></msub><mo>⋅</mo><msup><mrow><mn>2</mn></mrow><mrow><mi mathvariant="italic">n</mi><mo>-</mo><mn>2</mn></mrow></msup><mo>+</mo><mo>…</mo><mo>+</mo><msub><mrow><mi mathvariant="italic">x</mi></mrow><mrow><mi mathvariant="italic">n</mi><mo>-</mo><mn>1</mn></mrow></msub><mo>⋅</mo><msup><mrow><mn>2</mn></mrow><mrow><mn>1</mn></mrow></msup><mo>+</mo><msub><mrow><mi mathvariant="italic">x</mi></mrow><mrow><mi mathvariant="italic">n</mi></mrow></msub><mo>⋅</mo><msup><mrow><mn>2</mn></mrow><mrow><mn>0</mn></mrow></msup></mrow></math></p></div><p></p><p>and <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mfenced open="|" close="anglebracketright"><mrow><mi mathvariant="italic">x</mi></mrow></mfenced><mo>=</mo><mfenced open="|" close="anglebracketright"><mrow><msub><mrow><mi mathvariant="italic">x</mi></mrow><mrow><mn>1</mn></mrow></msub><msub><mrow><mi mathvariant="italic">x</mi></mrow><mrow><mn>2</mn></mrow></msub><mo>…</mo><msub><mrow><mi mathvariant="italic">x</mi></mrow><mrow><mi mathvariant="italic">n</mi></mrow></msub></mrow></mfenced></mrow></math></span> is the binary representation of the variable <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">x</mi></mrow></math></span>.</p><p>Using this decomposition, the oracle <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><msub><mrow><mi mathvariant="italic">U</mi></mrow><mrow><mi mathvariant="italic">f</mi></mrow></msub></mrow></math></span> can be broken down into smaller circuits that perform the controlled operations <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><msup><mrow><mi mathvariant="italic">a</mi></mrow><mrow><msub><mrow><mi mathvariant="italic">x</mi></mrow><mrow><mi mathvariant="italic">i</mi></mrow></msub><mtext> </mtext><mo>⋅</mo><msup><mrow><mn>2</mn></mrow><mrow><mi mathvariant="italic">n</mi><mo>-</mo><mi mathvariant="italic">i</mi></mrow></msup></mrow></msup><mtext> </mtext><mi mathvariant="normal">mod</mi><mtext> </mtext><mi mathvariant="italic">N</mi></mrow></math></span> recursively, where <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><msub><mrow><mi mathvariant="italic">x</mi></mrow><mrow><mi mathvariant="italic">i</mi></mrow></msub><mtext> </mtext></mrow></math></span> is the state of the <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">i</mi></mrow></math></span>th control qubit in the upper register. To decompose the oracle into smaller circuits, apply the modular exponentiation operator <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><msub><mrow><mi mathvariant="italic">U</mi></mrow><mrow><mi mathvariant="italic">a</mi></mrow></msub><mfenced open="|" close="anglebracketright"><mrow><mi mathvariant="italic">w</mi></mrow></mfenced><mo>=</mo><mfenced open="|" close="anglebracketright"><mrow><mi mathvariant="italic">w</mi><mo>⋅</mo><mi mathvariant="italic">a</mi><mtext> </mtext><mrow><mo>(</mo><mrow><mi mathvariant="normal">mod</mi><mtext> </mtext><mi mathvariant="italic">N</mi></mrow><mo>)</mo></mrow></mrow></mfenced></mrow></math></span> for <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><msup><mrow><mn>2</mn></mrow><mrow><mi mathvariant="italic">n</mi><mo>-</mo><mi mathvariant="italic">i</mi></mrow></msup></mrow></math></span> times on the state <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mfenced open="|" close="anglebracketright"><mrow><mi mathvariant="italic">w</mi></mrow></mfenced></mrow></math></span> in the lower register, whose initial state is <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mfenced open="|" close="anglebracketright"><mrow><mn>0</mn><mo>…</mo><mn>1</mn></mrow></mfenced></mrow></math></span>, conditioned on the binary value of <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><msub><mrow><mi mathvariant="italic">x</mi></mrow><mrow><mi mathvariant="italic">i</mi></mrow></msub></mrow></math></span>.</p><p>This figure illustrates the oracle <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true"><msub><mrow><mi mathvariant="italic">U</mi></mrow><mrow><mi mathvariant="italic">f</mi></mrow></msub></math></span> for the modular exponentiation <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">f</mi><mrow><mo>(</mo><mrow><mi mathvariant="italic">x</mi></mrow><mo>)</mo></mrow><mo>=</mo><msup><mrow><mn>7</mn></mrow><mrow><mi mathvariant="italic">x</mi></mrow></msup><mtext> </mtext><mi mathvariant="normal">mod</mi><mtext> </mtext><mn>15</mn></mrow></math></span>, where <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true"><mi mathvariant="italic">n</mi></math></span> upper qubits represent <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mfenced open="|" close="anglebracketright"><mrow><mi mathvariant="italic">x</mi></mrow></mfenced></mrow></math></span> and <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">m</mi></mrow></math></span> lower qubits represent <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mfenced open="|" close="anglebracketright"><mrow><msup><mrow><mn>7</mn></mrow><mrow><mi mathvariant="italic">x</mi></mrow></msup><mtext> </mtext><mi mathvariant="normal">mod</mi><mtext> </mtext><mn>15</mn></mrow></mfenced></mrow></math></span>.</p><div class="informalfigure"><div id="d126e65567" class="mediaobject"><p><img src="../../examples/quantum/win64/ShorsAlgorithmForPrimeFactorizationExample_02.png" alt="Quantum circuit implementation for the modular exponentiation f(x) = 7^x mod 15" height="265" width="414"></p></div></div><p>MATLAB&#174; Support Package for Quantum Computing uses a qubit convention that follows most textbooks (see <a href="shors-algorithm-for-prime-factorization.html#mw_rtc_ShorsAlgorithmForPrimeFactorizationExample_M_52ef" class="intrnllnk">[4]</a>), which is different from the qubit convention in [3]. For a quantum circuit with <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">n</mi></mrow></math></span> qubits, the overall <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><msup><mrow><mn>2</mn></mrow><mrow><mi mathvariant="italic">n</mi></mrow></msup></mrow></math></span> basis states are constructed from the Kronecker product of the <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true"><mi mathvariant="italic">n</mi></math></span> qubit bases, ordered from left to right starting with the lowest-index qubit (topmost in the circuit diagram) to the highest-index qubit (bottommost in the circuit diagram). In other words, if the basis of a single qubit with index <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">k</mi></mrow></math></span> is labeled as <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mfenced open="|" close="anglebracketright"><mrow><msub><mrow><mi mathvariant="italic">q</mi></mrow><mrow><mi mathvariant="italic">k</mi></mrow></msub></mrow></mfenced></mrow></math></span>, which can be <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mfenced open="|" close="anglebracketright"><mrow><mn>0</mn></mrow></mfenced></mrow></math></span> or <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mfenced open="|" close="anglebracketright"><mrow><mn>1</mn></mrow></mfenced></mrow></math></span>, then the basis states of the circuit with <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true"><mi mathvariant="italic">n</mi></math></span> qubits are represented by <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mfenced open="|" close="anglebracketright"><mrow><msub><mrow><mi mathvariant="italic">q</mi></mrow><mrow><mn>1</mn></mrow></msub></mrow></mfenced><mo>⊗</mo><mo>…</mo><mfenced open="|" close="anglebracketright"><mrow><msub><mrow><mi mathvariant="italic">q</mi></mrow><mrow><mi mathvariant="italic">k</mi></mrow></msub></mrow></mfenced><mo>⊗</mo><mo>…</mo><mfenced open="|" close="anglebracketright"><mrow><msub><mrow><mi mathvariant="italic">q</mi></mrow><mrow><mi mathvariant="italic">n</mi></mrow></msub></mrow></mfenced></mrow></math></span>. For example, for a circuit with two qubits, all possible basis states expressed as a column vector are <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mfenced open="|" close="anglebracketright"><mrow><msub><mrow><mi mathvariant="italic">q</mi></mrow><mrow><mn>1</mn></mrow></msub><msub><mrow><mi mathvariant="italic">q</mi></mrow><mrow><mn>2</mn></mrow></msub></mrow></mfenced><mo>=</mo><msup><mrow><mrow><mo>[</mo><mrow><mfenced open="|" close="anglebracketright"><mrow><mn>00</mn></mrow></mfenced><mo>,</mo><mfenced open="|" close="anglebracketright"><mrow><mn>01</mn></mrow></mfenced><mo>,</mo><mfenced open="|" close="anglebracketright"><mrow><mn>10</mn></mrow></mfenced><mo>,</mo><mfenced open="|" close="anglebracketright"><mrow><mn>11</mn></mrow></mfenced></mrow><mo>]</mo></mrow></mrow><mrow><mi mathvariant="italic">T</mi></mrow></msup></mrow></math></span>. In contrast, the qubit convention in [3] orders the qubit bases from right to left starting with lowest-index qubit to the highest-index qubit.</p><p>Before constructing the oracle <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true"><msub><mrow><mi mathvariant="italic">U</mi></mrow><mrow><mi mathvariant="italic">f</mi></mrow></msub></math></span>, first define a function that creates the controlled-swap gate (CSWAP gate or Fredkin gate). Use the <code class="literal">compositeGate</code> function to construct a composite gate from an inner quantum circuit that performs the controlled-swap operation on an outer circuit. Here, qubit 1 is the control qubit, while qubits 2 and 3 are the target qubits to swap in the inner quantum circuit <code class="literal">gates</code>. The second input of <code class="literal">compositeGate</code> defines the mapping of the qubits of the inner circuit to the qubits of the outer circuit. </p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre><span style="color:#0000FF">function</span> cg = cswapGate(control,target1,target2)
  gates = [cxGate(3,2); ccxGate(1,2,3); cxGate(3,2)];
  cg = compositeGate(gates,[control target1 target2]);
<span style="color:#0000FF">end</span></pre></div></div></div><p>Next, define a function that constructs the circuit for the controlled-modular operation <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">a</mi><mtext> </mtext><mi mathvariant="normal">mod</mi><mtext> </mtext><mi mathvariant="italic">N</mi></mrow></math></span> based on [2] and[3]. In this example, all possible values of <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">a</mi></mrow></math></span> are considered for <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">N</mi><mo>=</mo><mn>15</mn></mrow></math></span>. However, only <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">a</mi><mo>=</mo><mn>21</mn></mrow></math></span> is considered for <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">N</mi><mo>=</mo><mn>143</mn></mrow></math></span> and <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">a</mi><mo>=</mo><mn>8</mn></mrow></math></span> is considered for <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">N</mi><mo>=</mo><mn>247</mn></mrow></math></span>. The first qubit in the inner circuit is set as the control qubit, which is mapped to the <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">i</mi></mrow></math></span>th control qubit in the outer circuit that represents the state <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true"><msub><mrow><mi mathvariant="italic">x</mi></mrow><mrow><mi mathvariant="italic">i</mi></mrow></msub></math></span>.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre><span style="color:#0000FF">function</span> Ua = modexpUnitary(a,N)
<span style="color:#228B22">% Construct a mod N based on these references:</span>
<span style="color:#228B22">% [1] Shor, P. https://doi.org/10.48550/arXiv.quant-ph/9508027.</span>
<span style="color:#228B22">% [2] Markov, I. L., and M. Saeedi. https://doi.org/10.48550/arXiv.1202.6614.</span>
<span style="color:#228B22">% [3] Tomčala, J. https://doi.org/10.1007/s10773-023-05532-4.</span>
<span style="color:#228B22">% For N = 15, the values for a are 2, 4, 7, 8, 11, 13.</span>
<span style="color:#228B22">% For N = 143, only a = 21 is considered.</span>
<span style="color:#228B22">% For N = 147, only a = 8 is considered.</span>
<span style="color:#228B22">% Qubit 1 is set as a control qubit, followed by m qubits as targets.</span>

  <span style="color:#228B22">% For N = 15, see figure 3 of [2]</span>
  <span style="color:#0000FF">if</span> N == 15
    <span style="color:#0000FF">switch</span> a
      <span style="color:#0000FF">case</span> 2
        Ua = [cswapGate(1,2,5); cswapGate(1,2,3); cswapGate(1,3,4)];
      <span style="color:#0000FF">case</span> 4
        Ua = [cswapGate(1,2,4); cswapGate(1,3,5)];
      <span style="color:#0000FF">case</span> 7
        Ua = [cxGate(1,2:5); cswapGate(1,3,4); cswapGate(1,2,3); cswapGate(1,2,5)];
      <span style="color:#0000FF">case</span> 8
        Ua = [cswapGate(1,2,3); cswapGate(1,2,4); cswapGate(1,2,5)];
      <span style="color:#0000FF">case</span> 11
        Ua = [cxGate(1,2:5); cswapGate(1,2,4); cswapGate(1,3,5)];
      <span style="color:#0000FF">case</span> 13
        Ua = [cxGate(1,2:5); cswapGate(1,2,5); cswapGate(1,2,3); cswapGate(1,3,4)];
    <span style="color:#0000FF">end</span>
  <span style="color:#0000FF">end</span>

  <span style="color:#228B22">% For N = 143, see figure 8 of [3]</span>
  <span style="color:#0000FF">if</span> N == 143
    <span style="color:#0000FF">switch</span> a
      <span style="color:#0000FF">case</span> 21
        Ua = [mcxGate([1 9],5,[]); mcxGate([1 9],7,[]); cxGate(1,5); <span style="color:#0000FF">...</span>
              mcxGate([1 5],6,[]); mcxGate([1 5],7,[]); mcxGate([1 5],9,[]); <span style="color:#0000FF">...</span>
              mcxGate([1 5 9],3,[]); mcxGate([1 5 9],4,[]); mcxGate([1 5 9],6,[]); <span style="color:#0000FF">...</span>
              mcxGate([1 5 9],7,[]); cxGate(1,[5 7]); mcxGate([1 5 6],3,[]); <span style="color:#0000FF">...</span>
              mcxGate([1 5 6],4,[]); mcxGate([1 7 9],5,[]); mcxGate([1 7 9],6,[]); <span style="color:#0000FF">...</span>
              cxGate(1,7)];
    <span style="color:#0000FF">end</span>
  <span style="color:#0000FF">end</span>

  <span style="color:#228B22">% For N = 247, see figure 6 of [3]</span>
  <span style="color:#0000FF">if</span> N == 247
    <span style="color:#0000FF">switch</span> a
      <span style="color:#0000FF">case</span> 8
        Ua = [cswapGate(1,3,6); cswapGate(1,6,9); cswapGate(1,8,9); ccxGate(1,8,5); <span style="color:#0000FF">...</span>
              cswapGate(1,2,9); mcxGate([1 5 9],2,[]); mcxGate([1 5 9],4,[]); <span style="color:#0000FF">...</span>
              cswapGate(1,7,9); mcxGate([1 2 4],5,[]); mcxGate([1 7 9],6,[]); <span style="color:#0000FF">...</span>
              mcxGate([1 6 7],3,[]); mcxGate([1 6 7],4,[]); mcxGate([1 6 8],9,[]); <span style="color:#0000FF">...</span>
              mcxGate([1 3 5],4,[]); mcxGate([1 2 3],4,[]); mcxGate([1 2 3],5,[]); <span style="color:#0000FF">...</span>
              mcxGate([1 2 3],6,[]); mcxGate([1 2 3],9,[]); mcxGate([1 7 8],2,[]); <span style="color:#0000FF">...</span>
              mcxGate([1 7 8],4,[]); mcxGate([1 7 8],6,[]); cxGate(1,8); <span style="color:#0000FF">...</span>
              mcxGate([1 5 7 8],2,[]); mcxGate([1 5 7 8],3,[]); <span style="color:#0000FF">...</span>
              mcxGate([1 5 7 8],4,[]); mcxGate([1 5 7 8],6,[]); <span style="color:#0000FF">...</span>
              mcxGate([1 5 7 8],9,[]); cxGate(1,8:9); mcxGate([1 7 8 9],2,[]); <span style="color:#0000FF">...</span>
              mcxGate([1 7 8 9],5,[]); mcxGate([1 7 8 9],6,[]); cxGate(1,9); <span style="color:#0000FF">...</span>
              mcxGate([1 6 7 8],9,[]); cxGate(1,5:6); mcxGate([1 2 3 6],9,[]); <span style="color:#0000FF">...</span>
              mcxGate([1 5 6 9],2,[]); mcxGate([1 5 6 9],3,[]); cxGate(1,5:6)];
    <span style="color:#0000FF">end</span>
  <span style="color:#0000FF">end</span>
<span style="color:#0000FF">end</span></pre></div></div></div><p>To check the modular exponentiation circuit, you can simulate the circuit and confirm that it satisfies the truth tables for specific input states. For example, the truth table for the operation <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mn>7</mn><mtext> </mtext><mi mathvariant="normal">mod</mi><mtext> </mtext><mn>15</mn></mrow></math></span> applied repeatedly to an initial input of <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mn>0001</mn></mrow></math></span> is shown in this table.</p><div class="table-responsive"><table class="table table-condensed"><colgroup><col class="tcol1" width="318"><col class="tcol2" width="329"></colgroup><thead><tr><th><p><span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><msub><mrow><mi mathvariant="italic">U</mi></mrow><mrow><mi mathvariant="italic">a</mi></mrow></msub><mfenced open="|" close="anglebracketright"><mrow><mi mathvariant="italic">w</mi></mrow></mfenced><mo>=</mo><mfenced open="|" close="anglebracketright"><mrow><mi mathvariant="italic">w</mi><mo>⋅</mo><mn mathvariant="normal">7</mn><mtext> </mtext><mrow><mo>(</mo><mrow><mi mathvariant="normal">mod</mi><mtext> </mtext><mn>15</mn></mrow><mo>)</mo></mrow></mrow></mfenced></mrow></math></span>in Binary Representation</p></th><th><p><span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><msub><mrow><mi mathvariant="italic">U</mi></mrow><mrow><mi mathvariant="italic">a</mi></mrow></msub><mfenced open="|" close="anglebracketright"><mrow><mi mathvariant="italic">w</mi></mrow></mfenced><mo>=</mo><mfenced open="|" close="anglebracketright"><mrow><mi mathvariant="italic">w</mi><mo>⋅</mo><mn mathvariant="normal">7</mn><mtext> </mtext><mrow><mo>(</mo><mrow><mi mathvariant="normal">mod</mi><mtext> </mtext><mn>15</mn></mrow><mo>)</mo></mrow></mrow></mfenced></mrow></math></span>in Decimal Representation</p></th></tr></thead><tbody><tr><td><p><span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="block"><mrow><msub><mrow><mi mathvariant="italic">U</mi></mrow><mrow><mi mathvariant="italic">a</mi></mrow></msub><mfenced open="|" close="anglebracketright"><mrow><mn>0001</mn></mrow></mfenced><mo>=</mo><mfenced open="|" close="anglebracketright"><mrow><mn>0111</mn></mrow></mfenced></mrow></math></span></p></td><td><p><span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="block"><mrow><msub><mrow><mi mathvariant="italic">U</mi></mrow><mrow><mi mathvariant="italic">a</mi></mrow></msub><mfenced open="|" close="anglebracketright"><mrow><mn>1</mn></mrow></mfenced><mo stretchy="false">→</mo><mfenced open="|" close="anglebracketright"><mrow><mn>7</mn></mrow></mfenced></mrow></math></span></p></td></tr><tr><td><p><span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="block"><mrow><msub><mrow><mi mathvariant="italic">U</mi></mrow><mrow><mi mathvariant="italic">a</mi></mrow></msub><mfenced open="|" close="anglebracketright"><mrow><mn>0111</mn></mrow></mfenced><mo>=</mo><mfenced open="|" close="anglebracketright"><mrow><mn>0100</mn></mrow></mfenced></mrow></math></span></p></td><td><p><span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="block"><mrow><msub><mrow><mi mathvariant="italic">U</mi></mrow><mrow><mi mathvariant="italic">a</mi></mrow></msub><mfenced open="|" close="anglebracketright"><mrow><mn>7</mn></mrow></mfenced><mo stretchy="false">→</mo><mfenced open="|" close="anglebracketright"><mrow><mn>4</mn></mrow></mfenced></mrow></math></span></p></td></tr><tr><td><p><span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="block"><mrow><msub><mrow><mi mathvariant="italic">U</mi></mrow><mrow><mi mathvariant="italic">a</mi></mrow></msub><mfenced open="|" close="anglebracketright"><mrow><mn>0100</mn></mrow></mfenced><mo>=</mo><mfenced open="|" close="anglebracketright"><mrow><mn>1101</mn></mrow></mfenced></mrow></math></span></p></td><td><p><span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="block"><mrow><msub><mrow><mi mathvariant="italic">U</mi></mrow><mrow><mi mathvariant="italic">a</mi></mrow></msub><mfenced open="|" close="anglebracketright"><mrow><mn>4</mn></mrow></mfenced><mo stretchy="false">→</mo><mfenced open="|" close="anglebracketright"><mrow><mn>13</mn></mrow></mfenced></mrow></math></span></p></td></tr><tr><td><p><span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="block"><mrow><msub><mrow><mi mathvariant="italic">U</mi></mrow><mrow><mi mathvariant="italic">a</mi></mrow></msub><mfenced open="|" close="anglebracketright"><mrow><mn>1101</mn></mrow></mfenced><mo>=</mo><mfenced open="|" close="anglebracketright"><mrow><mn>0001</mn></mrow></mfenced></mrow></math></span></p></td><td><p><span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="block"><mrow><msub><mrow><mi mathvariant="italic">U</mi></mrow><mrow><mi mathvariant="italic">a</mi></mrow></msub><mfenced open="|" close="anglebracketright"><mrow><mn>13</mn></mrow></mfenced><mo stretchy="false">→</mo><mfenced open="|" close="anglebracketright"><mrow><mn>1</mn></mrow></mfenced></mrow></math></span></p></td></tr><tr><td><p><span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="block"><mrow><msub><mrow><mi mathvariant="italic">U</mi></mrow><mrow><mi mathvariant="italic">a</mi></mrow></msub><mfenced open="|" close="anglebracketright"><mrow><mn>0001</mn></mrow></mfenced><mo>=</mo><mfenced open="|" close="anglebracketright"><mrow><mn>0111</mn></mrow></mfenced></mrow></math></span></p></td><td><p><span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true"><msub><mrow><mi mathvariant="italic">U</mi></mrow><mrow><mi mathvariant="italic">a</mi></mrow></msub><mfenced open="|" close="anglebracketright"><mrow><mn>1</mn></mrow></mfenced><mo stretchy="false">→</mo><mfenced open="|" close="anglebracketright"><mrow><mn>7</mn></mrow></mfenced></math></span></p></td></tr></tbody></table></div><p>Use the <code class="literal">modexpUnitary</code> function to construct the circuit for the controlled-modular operation <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mn>7</mn><mtext> </mtext><mi mathvariant="normal">mod</mi><mtext> </mtext><mn>15</mn></mrow></math></span>. Specify an initial state of <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mn>1</mn></mrow></math></span> for the control qubit, such that the condition to apply <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true"><msub><mrow><mi mathvariant="italic">U</mi></mrow><mrow><mi mathvariant="italic">a</mi></mrow></msub></math></span> is always true, and initialize the state of the lower <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">m</mi></mrow></math></span> qubits as <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true"><mn>0001</mn></math></span>. Here, because the <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><msub><mrow><mi mathvariant="italic">U</mi></mrow><mrow><mi mathvariant="italic">a</mi></mrow></msub></mrow></math></span> operation result can never exceed <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">N</mi><mo>-</mo><mn>1</mn></mrow></math></span>, using <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">m</mi><mo>=</mo><mn>4</mn></mrow></math></span> qubits is adequate for <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">N</mi><mo>=</mo><mn>15</mn></mrow></math></span>.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>N = 15;
a = 7;
m = 4;
Ua = modexpUnitary(a,N);
initState = <span style="color:#A020F0">"1"</span> + string(dec2bin(1,m))</pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>initState = 
"10001"
</pre></div></div></div><p>Construct the modular exponentiation circuit to check against the truth table by using <code class="literal">compositeGate</code> to apply the operation <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true"><mn>7</mn><mtext> </mtext><mi mathvariant="normal">mod</mi><mtext> </mtext><mn>15</mn></math></span> recursively. Simulate the output state of this circuit and show the result in binary and decimal representations. The circuit simulation results match the truth tables.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>gates = compositeGate(Ua,[1 2:(m+1)]);
c = quantumCircuit(gates);
state = initState;
<span style="color:#0000FF">for</span> k = 1:5
  state = simulate(c,state);
  bitStr = char(formula(state))
  dec = bin2dec(bitStr(end-m:end-1))
<span style="color:#0000FF">end</span></pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>bitStr = 
'1 * |10111&gt;'
</pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>dec = 
7
</pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>bitStr = 
'1 * |10100&gt;'
</pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>dec = 
4
</pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>bitStr = 
'1 * |11101&gt;'
</pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>dec = 
13
</pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>bitStr = 
'1 * |10001&gt;'
</pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>dec = 
1
</pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>bitStr = 
'1 * |10111&gt;'
</pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>dec = 
7
</pre></div></div></div><h3 class="title" id="ShorsAlgorithmForPrimeFactorizationExample-2">Find Prime Factors of 15</h3><p>Define the composite number <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true"><mi mathvariant="italic">N</mi></math></span> to factor.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>N = 15</pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>N = 
15
</pre></div></div></div><p>Define a function that finds the integers <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mn>1</mn><mo>&lt;</mo><mi>a</mi><mo>&lt;</mo><mi>N</mi></mrow></math></span> that are coprime to <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true"><mi mathvariant="italic">N</mi></math></span>.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre><span style="color:#0000FF">function</span> aList = findCoprime(n)
  aList = [];
  <span style="color:#0000FF">for</span> x = 2:(n-1)
    <span style="color:#0000FF">if</span> gcd(x,n) == 1
      aList(end+1) = x;
    <span style="color:#0000FF">end</span>
  <span style="color:#0000FF">end</span>
<span style="color:#0000FF">end</span></pre></div></div></div><p>Choose an integer <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true"><mi mathvariant="italic">a</mi></math></span> from the list of integers that the <code class="literal">findCoprime</code> function returns. For this example, choose the third integer in the list.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>aList = findCoprime(N);
a = aList(3)</pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>a = 
7
</pre></div></div></div><p>Next, define the number of qubits. The first register of the upper qubits <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">n</mi></mrow></math></span> determines the accuracy of the phase estimation. A higher number of these qubits results in a more accurate detection of the period searched, but it also increases the depth of the whole circuit. For this example, choosing <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">n</mi><mo>=</mo><mn>4</mn></mrow></math></span> is adequate to find the prime factors of 15. The second register of the lower qubits <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">m</mi></mrow></math></span> determines the binary representation of the modular exponentiation <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true"><msup><mrow><mi mathvariant="italic">a</mi></mrow><mrow><mi mathvariant="italic">x</mi></mrow></msup><mtext> </mtext><mi mathvariant="normal">mod</mi><mtext> </mtext><mi mathvariant="italic">N</mi></math></span>, which can be selected using <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">m</mi><mo>=</mo><mrow><mo>⌈</mo><mrow><msub><mrow><mi mathvariant="normal">log</mi></mrow><mrow><mn>2</mn></mrow></msub><mrow><mo>(</mo><mrow><mi mathvariant="italic">N</mi><mo>-</mo><mn>1</mn></mrow><mo>)</mo></mrow></mrow><mo>⌉</mo></mrow></mrow></math></span>.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>n = 4;
m = ceil(log2(N-1));</pre></div></div></div><p>Construct the oracle <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><msub><mrow><mi mathvariant="italic">U</mi></mrow><mrow><mi mathvariant="italic">f</mi></mrow></msub></mrow></math></span> that finds the modular exponentiation <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true"><mi>f</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>=</mo><msup><mrow><mi mathvariant="italic">a</mi></mrow><mrow><mi mathvariant="italic">x</mi></mrow></msup><mtext> </mtext><mi mathvariant="normal">mod</mi><mtext> </mtext><mi mathvariant="italic">N</mi></math></span>. Create the modular exponentiation gates for the oracle in a loop, and map their qubits to the qubits of the outer circuit.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>UfQPE = [];
<span style="color:#0000FF">for</span> k = 0:n-1
  Ua_2tok = compositeGate(repmat(modexpUnitary(a,N),2^k,1), <span style="color:#0000FF">...</span>
                          [n-k (n+1):(n+m)]);
  UfQPE = [UfQPE; Ua_2tok];
<span style="color:#0000FF">end</span></pre></div></div></div><p>Construct the whole quantum phase estimation circuit. Then plot the circuit.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>gates = [hGate(1:n); xGate(n+m)];
gates = [gates; UfQPE; inv(qftGate(1:n))];
c = quantumCircuit(gates);
figure
plot(c)</pre></div></div></div><div class="informalfigure"><div id="d126e66369" class="mediaobject"><p><img src="../../examples/quantum/win64/ShorsAlgorithmForPrimeFactorizationExample_03.png" alt="Figure contains an object of type quantum.gate.quantumcircuitchart." width="560"></p></div></div><p>Simulate the circuit. Show the histogram of the possible states of the upper register with a probability threshold of 0.02.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>s = simulate(c);
histogram(s,1:n,Threshold=0.02)</pre></div></div></div><div class="informalfigure"><div id="d126e66377" class="mediaobject"><p><img src="../../examples/quantum/win64/ShorsAlgorithmForPrimeFactorizationExample_04.png" alt="Figure contains an axes object. The axes object with ylabel Probability contains an object of type categoricalhistogram." width="560"></p></div></div><p>To return these possible states and the probability of measuring each state, use <code class="literal">querystates</code>. Specify the probability threshold as 0.02. The possible states are returned as binary representations.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>[states,probabilities] = querystates(s,1:n,Threshold=0.02);</pre></div></div></div><p>Convert these binary states into decimal form, which represents the phase estimation.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>phase = bin2dec(states)/2^n</pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>phase = <span class="emphasis"><em>4×1</em></span>

         0
    0.2500
    0.5000
    0.7500

</pre></div></div></div><p>Determine the period of the phase using continued fraction or rational fraction approximation. Use the <code class="literal">rat</code> function and specify the tolerance as 1/2 of the smallest interval spacing between the converted phases, which is <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mrow><mrow><mn>1</mn></mrow><mo>/</mo><mrow><msup><mrow><mn>2</mn></mrow><mrow><mi mathvariant="italic">n</mi><mo>+</mo><mn>1</mn></mrow></msup></mrow></mrow></mrow></math></span>. The returned values in <code class="literal">den</code> represent possible values of the period <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">r</mi></mrow></math></span>.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>[num,den] = rat(phase,1/2^(n+1))</pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>num = <span class="emphasis"><em>4×1</em></span>

     0
     1
     1
     3

</pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>den = <span class="emphasis"><em>4×1</em></span>

     1
     4
     2
     4

</pre></div></div></div><p>Next, from the denominators of the continued fractions, check if the period <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">r</mi></mrow></math></span> is even and if it satisfies the relation <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><msup><mrow><mi mathvariant="italic">a</mi></mrow><mrow><mrow><mrow><mi mathvariant="italic">r</mi></mrow><mo>/</mo><mrow><mn>2</mn></mrow></mrow></mrow></msup><mo>≢</mo><mo>-</mo><mn>1</mn><mtext> </mtext><mrow><mo>(</mo><mrow><mi mathvariant="normal">mod</mi><mtext> </mtext><mi mathvariant="italic">N</mi></mrow><mo>)</mo></mrow></mrow></math></span>. If both conditions are true, then compute the prime factors of <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">N</mi></mrow></math></span>.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>found = false;
attempt = 1;
<span style="color:#0000FF">while</span> ~found &amp;&amp; attempt &lt;= numel(den)
  r = den(attempt);
  <span style="color:#0000FF">if</span> mod(r,2) == 0 &amp;&amp; phase(attempt) ~= 0
      p = gcd(a^(floor(r/2))-1,N);
      q = gcd(a^(floor(r/2))+1,N);
      found = true;
  <span style="color:#0000FF">else</span>
    attempt = attempt + 1;
  <span style="color:#0000FF">end</span>
<span style="color:#0000FF">end</span>
<span style="color:#0000FF">if</span> found == true
  fprintf(<span style="color:#A020F0">"Prime factors found: %d and %d \n"</span>, p, q);
<span style="color:#0000FF">else</span>
  fprintf(<span style="color:#A020F0">"No factors found. Choose different a."</span>)
<span style="color:#0000FF">end</span></pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>Prime factors found: 3 and 5 
</pre></div></div></div><h3 class="title" id="ShorsAlgorithmForPrimeFactorizationExample-3">Find Prime Factors of 143 and 247</h3><p>Find the prime factors of 143 and 247. Here, the initial guess for <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">a</mi></mrow></math></span> is predetermined based on the specially designed circuit for the modular exponentiation operation, as discussed in [3]. Define a function <code class="literal">findPrimeFactors</code> that reuses the code in the previous section. Here, choosing <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">n</mi><mo>=</mo><mn>7</mn></mrow></math></span> is adequate to find the prime factors of 143 and 247.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre><span style="color:#0000FF">function</span> [p,q] = findPrimeFactors(N,a)
  n = 7;
  m = ceil(log2(N-1));
  UfQPE = [];
  <span style="color:#0000FF">for</span> k = 0:n-1
    Ua_2tok = compositeGate(repmat(modexpUnitary(a,N),2^k,1), <span style="color:#0000FF">...</span>
                            [n-k (n+1):(n+m)]);
    UfQPE = [UfQPE; Ua_2tok];
  <span style="color:#0000FF">end</span>
  gates = [hGate(1:n); xGate(n+m)];
  gates = [gates; UfQPE; inv(qftGate(1:n))];
  c = quantumCircuit(gates);
  s = simulate(c);
  [states,probabilities] = querystates(s,1:n,Threshold=0.02);
  phase = bin2dec(states)/2^n;
  [num,den] = rat(phase,1/2^(n+1));
  found = false;
  attempt = 1;
  <span style="color:#0000FF">while</span> ~found &amp;&amp; attempt &lt;= numel(den)
    r = den(attempt);
    <span style="color:#0000FF">if</span> mod(r,2) == 0 &amp;&amp; phase(attempt) ~= 0
      p = gcd(a^(floor(r/2))-1,N);
      q = gcd(a^(floor(r/2))+1,N);
      found = true;
    <span style="color:#0000FF">else</span>
      attempt = attempt + 1;
    <span style="color:#0000FF">end</span>
  <span style="color:#0000FF">end</span>
  <span style="color:#0000FF">if</span> found == true
    fprintf(<span style="color:#A020F0">"Prime factors found: %d and %d \n"</span>, p, q);
  <span style="color:#0000FF">else</span>
    p = 1;
    q = N;
    fprintf(<span style="color:#A020F0">"No factors found. Choose different a."</span>)
  <span style="color:#0000FF">end</span>
<span style="color:#0000FF">end</span></pre></div></div></div><p>Find the prime factors of 143 by choosing <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">a</mi></mrow></math></span> as 21.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>[p,q] = findPrimeFactors(143,21)</pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>Prime factors found: 11 and 13 
</pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>p = 
11
</pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>q = 
13
</pre></div></div></div><p>Find the prime factors of 247 by choosing <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">a</mi></mrow></math></span> as 8.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>[p,q] = findPrimeFactors(247,8)</pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>Prime factors found: 19 and 13 
</pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>p = 
19
</pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>q = 
13
</pre></div></div></div><h3 class="title" id="ShorsAlgorithmForPrimeFactorizationExample-4">References</h3><span id="mw_rtc_ShorsAlgorithmForPrimeFactorizationExample_M_51ba" class="anchor_target"></span><p>[1] Shor, Peter W. "Polynomial-Time Algorithms for Prime Factorization and Discrete Logarithms on a Quantum Computer." arXiv, January 25, 1996. <a href="https://doi.org/10.48550/arXiv.quant-ph/9508027" target="_blank">https://doi.org/10.48550/arXiv.quant-ph/9508027</a>.</p><span id="mw_rtc_ShorsAlgorithmForPrimeFactorizationExample_M_9061" class="anchor_target"></span><p>[2] Markov, Igor L., and Mehdi Saeedi. "Constant-Optimized Quantum Circuits for Modular Multiplication and Exponentiation." arXiv, April 2, 2015. <a href="https://doi.org/10.48550/arXiv.1202.6614" target="_blank">https://doi.org/10.48550/arXiv.1202.6614</a>.</p><span id="mw_rtc_ShorsAlgorithmForPrimeFactorizationExample_M_599a" class="anchor_target"></span><p>[3] Tomčala, J. "On the Various Ways of Quantum Implementation of the Modular Exponentiation Function for Shor's Factorization." International Journal of Theoretical Physics 63, no. 1 (January 10,2024): 14. <a href="https://doi.org/10.1007/s10773-023-05532-4" target="_blank">https://doi.org/10.1007/s10773-023-05532-4</a>.</p><span id="mw_rtc_ShorsAlgorithmForPrimeFactorizationExample_M_52ef" class="anchor_target"></span><p>[4] Singleton Jr, Robert L. "Shor's Factoring Algorithm and Modular Exponentiation Operators." <span class="emphasis"><em>Quanta</em></span> 12, no. 1 (September 15, 2023): 41&#8211;130. <a href="https://doi.org/10.12743/quanta.v12i1.235" target="_blank">https://doi.org/10.12743/quanta.v12i1.235</a>.</p></div>
      <h2 id="d126e66567">See Also</h2><p><span itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage/SeeAlso" itemprop="seealso"><a itemprop="url" href="../ref/quantumcircuit.html"><span itemprop="name"><code class="function">quantumCircuit</code></span></a></span> | <span itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage/SeeAlso" itemprop="seealso"><a itemprop="url" href="../ref/compositegate.html"><span itemprop="name"><code class="function">compositeGate</code></span></a></span> | <span itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage/SeeAlso" itemprop="seealso"><a itemprop="url" href="../ref/cxgate.html"><span itemprop="name"><code class="function">cxGate</code></span></a></span> | <span itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage/SeeAlso" itemprop="seealso"><a itemprop="url" href="../ref/ccxgate.html"><span itemprop="name"><code class="function">ccxGate</code></span></a></span> | <span itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage/SeeAlso" itemprop="seealso"><a itemprop="url" href="../ref/mcxgate.html"><span itemprop="name"><code class="function">mcxGate</code></span></a></span></p>
      <h3 id="d126e66585">Topics</h3><ul class="list-unstyled"><li><a href="graph-coloring-with-grovers-algorithm.html" class="a">Graph Coloring with Grover's Algorithm</a></li><li><a href="ground-state-protein-folding-using-variational-quantum-eigensolver-vqe.html" class="a">Ground-State Protein Folding Using Variational Quantum Eigensolver (VQE)</a></li><li><a href="solve-xor-problem-using-quantum-neural-network.html" class="a">Solve XOR Problem Using Quantum Neural Network (QNN)</a></li><li><a href="quantum-monte-carlo-simulation.html" class="a">Quantum Monte Carlo (QMC) Simulation</a></li></ul>
    </section>
    </div></section><div xmlns="http://www.w3.org/1999/xhtml" class="clearfix"></div>
<div xmlns="http://www.w3.org/1999/xhtml" align="center" class="feedbackblock" id="mw_docsurvey"><script src="https://www.mathworks.com/help/docsurvey/docfeedback.js"></script>
<script>loadSurveyHidden();</script>
<link rel="stylesheet" href="https://www.mathworks.com/help/docsurvey/release/index-css.css" type="text/css">
<script src="https://www.mathworks.com/help/docsurvey/release/bundle.index.js"></script>

<script>initDocSurvey();</script></div></main>


</div>
</div>
</div>
</div><!--close_0960-->
<footer xmlns="http://www.w3.org/1999/xhtml" id="footer" class="bs-footer">
<div class="container-fluid">
<div class="footer">
<div class="row">
<div class="col-12">
<p class="copyright">© 1994-2025 The MathWorks, Inc.</p>
<ul class="footernav"><li class="footernav_help"><a href="matlab:web(matlab.internal.licenseAgreement)">Terms of Use</a></li><li class="footernav_patents"><a href="matlab:web([matlabroot '/patents.txt'])">Patents</a></li><li class="footernav_trademarks"><a href="matlab:web([matlabroot '/trademarks.txt'])">Trademarks</a></li><li class="footernav_piracy"><a href="matlab:web([docroot '/acknowledgments.html'])">Acknowledgments</a></li></ul></div>
</div>
</div>
</div>
</footer>
</div><!--close row-offcanvas-->
</div><!--close_0970-->
</body>
</html>
