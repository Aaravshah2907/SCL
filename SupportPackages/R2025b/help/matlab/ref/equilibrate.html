<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage">
<head>
<meta xmlns="http://www.w3.org/1999/xhtml" charset="utf-8">
<meta xmlns="http://www.w3.org/1999/xhtml" name="viewport" content="width=device-width, initial-scale=1.0">
<meta xmlns="http://www.w3.org/1999/xhtml" http-equiv="X-UA-Compatible" content="IE=edge">
<title>equilibrate</title>
<script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
      {
      "@context": "http://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement":
      [{
          "@type": "ListItem",
          "position": 1,

          "item": {
          "@id": "../index.html",
          "name": "MATLAB"
}

          } 
        ,
        {
          "@type": "ListItem",
          "position": 2,

          "item": {
          "@id": "../mathematics.html",
          "name": "Mathematics"
}

          }
        ,
        {
          "@type": "ListItem",
          "position": 3,

          "item": {
          "@id": "../sparse-matrices.html",
          "name": "Sparse Matrices"
}

          }]
      }</script><script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "ItemList",
          "name": "VisibleBreadcrumbs",

        "itemListElement":
        [
        "sparse-matrices"
        ],
        "itemListOrder": "http://schema.org/ItemListOrderAscending"
        }
        </script><script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "ItemList",
          "name": "ExtendedCapabilities",

        "itemListElement":
        [
{
          "@type": "ListItem",
          "position": 1,
"item": 
        {
        "@context": "http://schema.org",
        "@type": "PropertyValue",
          "name": "threadsupport",
          "value": "full"

        }
          }
        ]
        }
        </script>
<meta xmlns="http://www.w3.org/1999/xhtml" name="chunktype" content="refpage"><meta xmlns="http://www.w3.org/1999/xhtml" name="refentity" itemprop="refentity" content="function:equilibrate"><link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/bootstrap.min.css" rel="stylesheet" type="text/css">


  <meta xmlns="http://www.w3.org/1999/xhtml" http-equiv="Content-Script-Type" content="text/javascript">
<meta xmlns="http://www.w3.org/1999/xhtml" name="toctype" itemprop="pagetype" content="fcn">
<meta xmlns="http://www.w3.org/1999/xhtml" name="infotype" itemprop="infotype" content="ref/function">

<meta xmlns="http://www.w3.org/1999/xhtml" name="description" itemprop="description" content="This MATLAB function permutes and rescales matrix A such that the new matrix B = R*P*A*C has a diagonal with entries of magnitude 1, and its off-diagonal entries are not greater than 1 in magnitude."><script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/jquery/jquery-3.6.0.min.js"></script><script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/jquery/jquery-migrate.min.js"></script>
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6.css" rel="stylesheet" type="text/css">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_lg.css" rel="stylesheet" media="screen and (min-width: 1200px)">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_md.css" rel="stylesheet" media="screen and (min-width: 992px) and (max-width: 1199px)">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_sm+xs.css" rel="stylesheet" media="screen and (max-width: 991px)">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_sm.css" rel="stylesheet" media="screen and (min-width: 768px) and (max-width: 991px)">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_xs.css" rel="stylesheet" media="screen and (max-width: 767px)">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_offcanvas_v2.css" rel="stylesheet" type="text/css">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/shared/highlight/styles/mwdochighlight.min.css" rel="stylesheet" type="text/css">

<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/l10n.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/docscripts.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/f1help.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/docscripts.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/mw.imageanimation.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/jquery.highlight.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/underscore-min.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/use_platform_screenshots.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/suggest.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/overload.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/helpservices.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/productfilter.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/matlab_dialog_shared.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/highlight/highlight.min.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/localstorage.js"></script><script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/product_group.js"></script><script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/saxonjs/SaxonJS2.rt.js"></script><script xmlns="http://www.w3.org/1999/xhtml">
            window.history.replaceState(window.location.href, null, ""); // Initialize
            window.onload = function() {    
            mystylesheetLocation = "../../includes/shared/scripts/product_group-sef.json";
            mysourceLocation = "../../docset/docset.xml";
            product_help_location = "matlab";
            pagetype = "refentry";
            doccentertype = "product";
            langcode = "";
            getProductFilteredList(mystylesheetLocation, mysourceLocation, product_help_location, pagetype, doccentertype, langcode);  
            }
          </script>




<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/jquery/jquery.mobile.custom.min.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/bootstrap.bundle.min.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/global.js"></script>
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/doc_center_base.css" rel="stylesheet" type="text/css">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/doc_center_installed.css" rel="stylesheet" type="text/css">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/doc_center_print.css" rel="stylesheet" type="text/css" media="print">
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/equationrenderer/release/MathRenderer.js"></script>
</head>
<body id="responsive_offcanvas">
<div xmlns="http://www.w3.org/1999/xhtml" id="doc_header_spacer" class="header"></div>
<div xmlns="http://www.w3.org/1999/xhtml" class="section_header level_3"><div class="container-fluid"><div class="row" id="mobile_search_row"><div class="col-sm-6 col-md-7 has_horizontal_local_nav" id="section_header_title"><div class="section_header_content"><div class="section_header_title"><h1><a href="../../documentation-center.html">Help Center</a></h1></div></div></div><div class="col-12 col-sm-6 col-md-5" id="mobile_search"><div class="search_nested_content_container"><form id="docsearch_form" name="docsearch_form" method="get" data-release="R2025b" data-language="en" action="../../templates/searchresults.html"><div class="input-group tokenized_search_field"><label class="visually-hidden form-label">Search Help</label><input type="text" class="form-control conjoined_search" autocomplete="off" name="qdoc" placeholder="Search Help" id="docsearch"> <div><button type="submit" name="submitsearch" id="submitsearch" class="btn icon-search btn_search_adjacent btn_search icon_16" tabindex="-1"></button></div></div></form></div><button class="btn icon-remove btn_search float-end icon_32 d-sm-none" data-bs-toggle="collapse" href="#mobile_search" aria-expanded="false" aria-controls="mobile_search"></button></div><div class="d-sm-none" id="search_actuator"><button class="btn icon-search btn_search float-end icon_16" data-bs-toggle="collapse" href="#mobile_search" aria-expanded="false" aria-controls="mobile_search"></button></div></div></div></div><div class="row-offcanvas row-offcanvas-left">
<div xmlns="http://www.w3.org/1999/xhtml" class="sidebar-offcanvas" id="sidebar">
<nav class="offcanvas_nav" role="navigation">
<div class="offcanvas_actuator" data-bs-toggle="offcanvas" data-bs-target="#sidebar" id="nav_toggle"><button type="button" class="btn"><span class="visually-hidden">Off-Canvas Navigation Menu Toggle
                  Off-Canvas Navigation Menu Toggle</span><span class="icon-menu"></span></button><span class="offcanvas_actuator_label" id="translation_icon-menu" tabindex="-1" aria-hidden="true"></span></div><div class="nav_list_wrapper" id="nav_list_wrapper"><nav class="offcanvas_nav" role="navigation"><ul class="nav_breadcrumb" id="ul_left_nav_ancestors"><li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../../documentation-center.html?s_tid=CRUX_lftnav" itemprop="url"><span itemprop="title">Documentation Home</span></a></li></ul>
<ul class="nav_disambiguation"><li><a href="../index.html?s_tid=CRUX_lftnav" id="index">MATLAB</a>
</li>
<li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../mathematics.html?s_tid=CRUX_lftnav" itemprop="url"><span itemprop="title">Mathematics</span></a></li><li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../sparse-matrices.html?s_tid=CRUX_lftnav" itemprop="url" id="sparse-matrices"><span itemprop="title">Sparse Matrices</span></a></li></ul><div class="search_refine_v4"><div id="facets_area"><ul class="nav_scrollspy nav list-unstyled" id="pnav">
<li class="nav_scrollspy_function nav-item notranslate"><a href="#responsive_offcanvas"><span class="refname">equilibrate</span></a></li>
<li class="nav_scrollspy_title nav-item" id="SSPY810-refentry">On this page</li>
<!--ADD_REFENTRY_TITLE_HERE 11--><li><a href="#mw_63748c3b-2f11-4093-88e7-1c617d40e61a" class="intrnllnk">Syntax</a></li><li class="nav-item"><a href="#description" class="nav-link intrnllnk">Description</a></li><li class="nav-item"><a href="#mw_fd1bc008-7db1-46c6-8bf3-142eb75f2765" class="nav-link intrnllnk">Examples</a><ul class="nav"><li class="nav-item"><a href="#mw_25d5c35b-38ac-4fcb-be04-1738112be9e5" class="nav-link intrnllnk">Equilibrate Matrix for Improved Conditioning</a></li></ul><ul class="nav"><li class="nav-item"><a href="#mw_e161f7b4-15a3-44db-be34-05a2ac55557c" class="nav-link intrnllnk">Specify Output Format</a></li></ul></li><li class="nav-item"><a href="#mw_0921cdb9-bc57-4e83-8873-fc84e55fab32" class="nav-link intrnllnk">Input Arguments</a><ul class="nav"><li class="nav-item"><a href="#mw_08af6237-4b36-4acf-aa52-2f6fd1838c1a" class="nav-link intrnllnk">A</a></li><li class="nav-item"><a href="#mw_4283378a-199c-4245-9168-0ef32cd1f591" class="nav-link intrnllnk">outputForm</a></li></ul></li><li class="nav-item"><a href="#mw_84831898-e54f-4de4-b4d1-dd91212cc023" class="nav-link intrnllnk">Output Arguments</a><ul class="nav"><li class="nav-item"><a href="#mw_deec5111-1d87-4af6-a55e-84b7f352363f" class="nav-link intrnllnk">P</a></li><li class="nav-item"><a href="#mw_ec0a0144-6fc6-46d6-9259-044dcd0974e9" class="nav-link intrnllnk">R</a></li><li class="nav-item"><a href="#mw_9643eb0f-e1f6-43bf-8849-fef0cf59a991" class="nav-link intrnllnk">C</a></li></ul></li><li class="nav-item"><a href="#mw_41bf507a-b3f2-4ee9-9880-4e587c9bd1fd" class="nav-link intrnllnk">More About</a><ul class="nav"><li class="nav-item"><a href="#mw_beaf3b94-7114-4652-b483-a36c2acf7b94" class="nav-link intrnllnk">Rescaling to Solve a Linear System</a></li></ul></li><li><a href="#References" class="intrnllnk">References</a></li><li class="nav-item"><a href="#refsect-extended-capabilities" class="nav-link intrnllnk">Extended Capabilities</a></li><li class="nav-item"><a href="#mw_d33b91eb-9494-4a70-ba4f-45579b670043" class="nav-link intrnllnk">Version History</a><ul class="nav"><li class="nav-item"><a href="#mw_1e1b33f3-9bdf-4cf5-a6aa-f864d676bd74" class="nav-link intrnllnk">Specify output format</a></li></ul></li><li class="nav-item"><a href="#mw_7cd12e99-4052-4006-aafc-81199d0ad057_seealso" class="nav-link intrnllnk">See Also</a></li></ul></div></div>
</nav></div></nav>
<script src="../../includes/product/scripts/offcanvas_v2.js"></script></div><!--END.CLASS sidebar-offcanvas-->
<div class="offcanvas_content_container">
<div xmlns="http://www.w3.org/1999/xhtml" class="sticky_header_container"><div class="horizontal_nav"><div class="horizontal_nav_container"><div class="offcanvas_horizontal_nav"><div class="container-fluid"><div class="row"><div class="col-sm-12 d-none d-sm-block"><nav class="navbar navbar-default" role="navigation" id="subnav"><div><ul class="nav navbar-nav crux_browse"><li id="crux_nav_documentation" class="crux_resource active">Documentation</li><li id="crux_nav_example" class="crux_resource"><a href="../examples.html?category=sparse-matrices&amp;s_tid=CRUX_topnav">Examples</a></li><li id="crux_nav_function" class="crux_resource"><a href="../referencelist.html?type=function&amp;category=sparse-matrices&amp;s_tid=CRUX_topnav">Functions</a></li><li id="crux_nav_app" class="crux_resource"><a href="../referencelist.html?type=app&amp;category=sparse-matrices&amp;s_tid=CRUX_topnav">Apps</a></li></ul></div></nav></div><div class="d-sm-none"><div class="container-fluid"><div class="row"><div class="col-9"><div class="mobile_crux_nav_trigger"><div class="btn-group"><button type="button" class="btn btn-default dropdown-toggle" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Resources</button><ul class="dropdown-menu"><li id="crux_nav_mobile_documentation" class="crux_resource active">Documentation</li><li id="crux_nav_mobile_example" class="crux_resource"><a href="../examples.html?category=sparse-matrices&amp;s_tid=CRUX_topnav">Examples</a></li><li id="crux_nav_mobile_function" class="crux_resource"><a href="../referencelist.html?type=function&amp;category=sparse-matrices&amp;s_tid=CRUX_topnav">Functions</a></li><li id="crux_nav_mobile_app" class="crux_resource"><a href="../referencelist.html?type=app&amp;category=sparse-matrices&amp;s_tid=CRUX_topnav">Apps</a></li></ul></div></div></div><div class="col-3"><div class="translate_placeholder"></div></div></div></div></div></div></div></div></div></div></div><div class="content_container" id="content_container" itemprop="content">
<div class="container-fluid">
<div class="row">
<div class="col-12">

<main id="skip_link_anchor" tabindex="-1">
<div xmlns="http://www.w3.org/1999/xhtml" id="product_info_alert"></div><section xmlns="http://www.w3.org/1999/xhtml" id="doc_center_content" lang="en" data-language="en"><div id="pgtype-ref-function"><div class="function_ref"><span id="mw_7cd12e99-4052-4006-aafc-81199d0ad057" class="anchor_target"></span><h1 class="r2025b notranslate" itemprop="title"><span class="refname">equilibrate</span></h1><div class="doc_topic_desc"><div class="purpose_container"><p itemprop="purpose">Matrix scaling for improved conditioning</p><div class="switch"><a href="javascript:void(0);" id="expandAllPage" data-allexpanded="true1">collapse all in page</a></div></div></div>
<span id="mw_63748c3b-2f11-4093-88e7-1c617d40e61a" class="anchor_target"></span><div class="ref_sect"><h2 id="mw_63748c3b-2f11-4093-88e7-1c617d40e61a">Syntax</h2><div class="syntax_signature"><div class="syntax_signature_module"><div class="code_responsive"><code class="synopsis"><a href="#d126e480671" class="intrnllnk">[P,R,C] = equilibrate(A)</a></code></div><div class="code_responsive"><code class="synopsis"><a href="#d126e480695" class="intrnllnk">[P,R,C] = equilibrate(A,outputForm)</a></code></div></div></div></div><div class="clear"></div><span id="mw_d632bdf0-a550-492f-8f79-ea92fcacbbe7" class="anchor_target"></span><h2 id="description">Description</h2><div class="descriptions"><div class="cshsummary" id="csh_mw_7cd12e99-4052-4006-aafc-81199d0ad057"><div class="description_module"><div class="description_element"><div class="code_responsive"><p><span id="d126e480671" itemprop="syntax"><code class="synopsis">[<a href="#mw_deec5111-1d87-4af6-a55e-84b7f352363f" class="intrnllnk"><code class="argument">P</code></a>,<a href="#mw_ec0a0144-6fc6-46d6-9259-044dcd0974e9" class="intrnllnk"><code class="argument">R</code></a>,<a href="#mw_9643eb0f-e1f6-43bf-8849-fef0cf59a991" class="intrnllnk"><code class="argument">C</code></a>] = equilibrate(<a href="#mw_08af6237-4b36-4acf-aa52-2f6fd1838c1a" class="intrnllnk"><code class="argument">A</code></a>)</code></span>
        permutes and rescales matrix <code class="literal">A</code> such that the new matrix <code class="literal">B =
          R*P*A*C</code> has a diagonal with entries of magnitude 1, and its off-diagonal entries
        are not greater than 1 in magnitude.</p></div><p class="syntax_example"><a href="equilibrate.html#mw_25d5c35b-38ac-4fcb-be04-1738112be9e5" class="intrnllnk">example</a></p></div><div class="description_element"><div class="code_responsive"><p><span id="d126e480695" itemprop="syntax"><code class="synopsis">[<a href="#mw_deec5111-1d87-4af6-a55e-84b7f352363f" class="intrnllnk"><code class="argument">P</code></a>,<a href="#mw_ec0a0144-6fc6-46d6-9259-044dcd0974e9" class="intrnllnk"><code class="argument">R</code></a>,<a href="#mw_9643eb0f-e1f6-43bf-8849-fef0cf59a991" class="intrnllnk"><code class="argument">C</code></a>] = equilibrate(<a href="#mw_08af6237-4b36-4acf-aa52-2f6fd1838c1a" class="intrnllnk"><code class="argument">A</code></a>,<a href="#mw_4283378a-199c-4245-9168-0ef32cd1f591" class="intrnllnk"><code class="argument">outputForm</code></a>)</code></span>
        returns the outputs <code class="literal">P</code>, <code class="literal">R</code>, and <code class="literal">C</code> in
        the form specified by <code class="argument">outputForm</code>. For example, you can specify
          <code class="argument">outputForm</code> as <code class="literal">"vector"</code> to return the outputs as
        column vectors.</p></div></div></div></div></div><div class="clear"></div><div class="examples"><h2 id="mw_fd1bc008-7db1-46c6-8bf3-142eb75f2765">Examples</h2><div class="expandableContent" id="expandableExamples"><p class="switch"><a href="javascript:void(0);" class="expandAllLink" data-allexpanded="true3">collapse all</a></p><div class="mw_ws_accordion_container"><div class="accordion" role="tablist" aria-multiselectable="true" id="expand_accordion_heading_mw_25d5c35b-38ac-4fcb-be04-1738112be9e5"><div class="accordion-item "><div class="accordion-header"><button role="tab" data-bs-toggle="collapse" id="expand_accordion_heading_mw_25d5c35b-38ac-4fcb-be04-1738112be9e5" data-bs-target="#expand_accordion_body_mw_25d5c35b-38ac-4fcb-be04-1738112be9e5" aria-controls="expand_accordion_body_mw_25d5c35b-38ac-4fcb-be04-1738112be9e5" class="accordion-button add_cursor_pointer" aria-expanded="true"><h3 id="mw_25d5c35b-38ac-4fcb-be04-1738112be9e5">Equilibrate Matrix for Improved Conditioning</h3></button></div><div role="tabpanel" id="expand_accordion_body_mw_25d5c35b-38ac-4fcb-be04-1738112be9e5" aria-labelledby="expand_accordion_heading_mw_25d5c35b-38ac-4fcb-be04-1738112be9e5" class="accordion-collapse collapse show"><div class="accordion-body"><div class="examples_short_list hidden_ios_android" data-products="ML"><div data-pane="metadata" class="card metadata_container"><div class="card-body metadata_content"><div class="d-grid"><a class="btn btn_color_blue" href="matlab:openExample('matlab/EquilibratedMatrixExample')" data-ex-genre="Live Script">Open Live Script</a></div></div></div></div><script type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "DigitalDocument",
          "headline": "Equilibrate Matrix for Improved Conditioning",
          "description": "Equilibrate a matrix with a large condition number to improve the efficiency and stability of a linear system solution with the iterative solver gmres.",
          "thumbnailURL": "../../examples/matlab/win64/EquilibratedMatrixExample_03.png",
          "genre": "Live Script",
          "isBasedOn": {
          "@type": "Product",
          "name": "MATLAB"

        },
          "isPartOf": {
          "@type": "CreativeWork",
          "url": "equilibrate.html"

        },
          "identifier": "matlab.EquilibratedMatrixExample",
          "name": "EquilibratedMatrixExample",
          "url": "equilibrate.html#mw_25d5c35b-38ac-4fcb-be04-1738112be9e5"

        }</script><script type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "PropertyValue",
          "name": "open_command",
          "value": "matlab:openExample('matlab/EquilibratedMatrixExample')"

        }</script><script type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "ItemList",
          "name": "ExampleSourceFiles",

        "itemListElement":
        [
        "EquilibratedMatrixExample.mlx"
        ],
        "itemListOrder": "http://schema.org/ItemListOrderAscending"
        }
        </script><p class="shortdesc">Equilibrate a matrix with a large condition number to improve the efficiency and stability of a linear system solution with the iterative solver <code class="literal">gmres</code>.</p><p>Load the <code class="literal">west0479</code> matrix, which is a real-valued 479-by-479 sparse matrix. Use <code class="literal">condest</code> to calculate the estimated condition number of the matrix.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>load <span style="color:#A020F0">west0479</span>
A = west0479;
c1 = condest(A)</pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>c1 = 
1.4244e+12
</pre></div></div></div><p>Try to solve the linear system <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="normal">Ax</mi><mo>=</mo><mi mathvariant="italic">b</mi></mrow></math></span> using <code class="literal">gmres</code> with 450 iterations and a tolerance of <code class="literal">1e-11</code>. Specify five outputs so that <code class="literal">gmres</code> returns the residual norms of the solution at each iteration (using <code class="literal">~</code> to suppress unneeded outputs). Plot the residual norms in a semilog plot. The plot shows that <code class="literal">gmres</code> is not able to achieve a reasonable residual norm, and so the calculated solution for <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">x</mi></mrow></math></span> is not reliable.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>b = ones(size(A,1),1);
tol = 1e-11;
maxit = 450;
[x,flx,~,~,rvx] = gmres(A,b,[],tol,maxit);
semilogy(rvx)
title(<span style="color:#A020F0">'Residual Norm at Each Iteration'</span>)</pre></div></div></div><div class="informalfigure"><div id="d126e480788" class="mediaobject"><p><img src="../../examples/matlab/win64/EquilibratedMatrixExample_01.png" alt="Figure contains an axes object. The axes object with title Residual Norm at Each Iteration contains an object of type line." width="560"></p></div></div><p>Use <code class="literal">equilibrate</code> to permute and rescale <code class="literal">A</code>. Create a new matrix <code class="literal">B = R*P*A*C</code>, which has a better condition number and diagonal entries of only 1 and -1.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>[P,R,C] = equilibrate(A);
B = R*P*A*C;
c2 = condest(B)</pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>c2 = 
5.1036e+04
</pre></div></div></div><p>Using the outputs returned by <code class="literal">equilibrate</code>, you can reformulate the problem <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="normal">Ax</mi><mo>=</mo><mi mathvariant="italic">b</mi></mrow></math></span> into <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="normal">By</mi><mo>=</mo><mi mathvariant="italic">d</mi></mrow></math></span>, where <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">B</mi><mo>=</mo><mi mathvariant="normal">RPAC</mi></mrow></math></span> and <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">d</mi><mo>=</mo><mi mathvariant="normal">RPb</mi></mrow></math></span>. In this form you can recover the solution to the original system with <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">x</mi><mo>=</mo><mi mathvariant="normal">Cy</mi></mrow></math></span>. The recovered solution, however, might not have the desired residual error for the original system. See <a href="equilibrate.html#mw_beaf3b94-7114-4652-b483-a36c2acf7b94" data-docid="#mw_beaf3b94-7114-4652-b483-a36c2acf7b94" class="intrnllnk">Rescaling to Solve a Linear System</a> for details.</p><p>Use <code class="literal">gmres</code> to solve <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="normal">By</mi><mo>=</mo><mi mathvariant="italic">d</mi></mrow></math></span> for <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="inline"><mrow><mi mathvariant="italic">y</mi></mrow></math></span>, and then replot the residual norms at each iteration. The plot shows that equilibrating the matrix improves the stability of the problem, with <code class="literal">gmres</code> converging to the desired tolerance of <code class="literal">1e-11</code> in fewer than 200 iterations.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>d = R*P*b;
[y,fly,~,~,rvy] = gmres(B,d,[],tol,maxit);
hold <span style="color:#A020F0">on</span>
semilogy(rvy)
legend(<span style="color:#A020F0">'Original'</span>, <span style="color:#A020F0">'Equilibrated'</span>, <span style="color:#A020F0">'Location'</span>, <span style="color:#A020F0">'southeast'</span>)
title(<span style="color:#A020F0">'Relative Residual Norms (No Preconditioner)'</span>)
hold <span style="color:#A020F0">off</span></pre></div></div></div><div class="informalfigure"><div id="d126e480883" class="mediaobject"><p><img src="../../examples/matlab/win64/EquilibratedMatrixExample_02.png" alt="Figure contains an axes object. The axes object with title Relative Residual Norms (No Preconditioner) contains 2 objects of type line. These objects represent Original, Equilibrated." width="560"></p></div></div><div class="procedure"><span id="EquilibratedMatrixExample-1" class="anchor_target"></span><p class="title" id="EquilibratedMatrixExample-1"><b>Improve Solution with Preconditioner</b></p><p>After you obtain the matrix <code class="literal">B</code>, you can improve the stability of the problem even further by calculating a preconditioner for use with <code class="literal">gmres</code>. The numerical properties of <code class="literal">B</code> are better than those of the original matrix <code class="literal">A</code>, so you should use the equilibrated matrix to calculate the preconditioner.</p><p>Calculate two different preconditioners with <code class="literal">ilu</code>, and use these as inputs to <code class="literal">gmres</code> to solve the problem again. Plot the residual norms at each iteration on the same plot as the equilibrated norms for comparison. The plot shows that calculating preconditioners with the equilibrated matrix greatly increases the stability of the problem, with <code class="literal">gmres</code> achieving the desired tolerance in fewer than 30 iterations.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>semilogy(rvy)
hold <span style="color:#A020F0">on</span>

[L1,U1] = ilu(B,struct(<span style="color:#A020F0">'type'</span>,<span style="color:#A020F0">'ilutp'</span>,<span style="color:#A020F0">'droptol'</span>,1e-1,<span style="color:#A020F0">'thresh'</span>,0));
[yp1,flyp1,~,~,rvyp1] = gmres(B,d,[],tol,maxit,L1,U1);
semilogy(rvyp1)

[L2,U2] = ilu(B,struct(<span style="color:#A020F0">'type'</span>,<span style="color:#A020F0">'ilutp'</span>,<span style="color:#A020F0">'droptol'</span>,1e-2,<span style="color:#A020F0">'thresh'</span>,0));
[yp2,flyp2,~,~,rvyp2] = gmres(B,d,[],tol,maxit,L2,U2);
semilogy(rvyp2)

legend(<span style="color:#A020F0">'No preconditioner'</span>, <span style="color:#A020F0">'ILUTP(1e-1)'</span>, <span style="color:#A020F0">'ILUTP(1e-2)'</span>)
title(<span style="color:#A020F0">'Relative Residual Norms with ILU Preconditioner (Equilibrated)'</span>)
hold <span style="color:#A020F0">off</span></pre></div></div></div><div class="informalfigure"><div id="d126e480911" class="mediaobject"><p><img src="../../examples/matlab/win64/EquilibratedMatrixExample_03.png" alt="Figure contains an axes object. The axes object with title Relative Residual Norms with ILU Preconditioner (Equilibrated) contains 3 objects of type line. These objects represent No preconditioner, ILUTP(1e-1), ILUTP(1e-2)." width="560"></p></div></div></div></div></div></div></div><div itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage/Example" itemprop="example" class="em_example"><meta itemprop="exampleid" content="matlab-EquilibratedMatrixExample"><meta itemprop="exampletitle" content="Equilibrate Matrix for Improved Conditioning"></div><div class="accordion" role="tablist" aria-multiselectable="true" id="expand_accordion_heading_mw_e161f7b4-15a3-44db-be34-05a2ac55557c"><div class="accordion-item "><div class="accordion-header"><button role="tab" data-bs-toggle="collapse" id="expand_accordion_heading_mw_e161f7b4-15a3-44db-be34-05a2ac55557c" data-bs-target="#expand_accordion_body_mw_e161f7b4-15a3-44db-be34-05a2ac55557c" aria-controls="expand_accordion_body_mw_e161f7b4-15a3-44db-be34-05a2ac55557c" class="accordion-button add_cursor_pointer" aria-expanded="true"><h3 id="mw_e161f7b4-15a3-44db-be34-05a2ac55557c">Specify Output Format</h3></button></div><div role="tabpanel" id="expand_accordion_body_mw_e161f7b4-15a3-44db-be34-05a2ac55557c" aria-labelledby="expand_accordion_heading_mw_e161f7b4-15a3-44db-be34-05a2ac55557c" class="accordion-collapse collapse show"><div class="accordion-body"><div class="examples_short_list hidden_ios_android" data-products="ML"><div data-pane="metadata" class="card metadata_container"><div class="card-body metadata_content"><div class="d-grid"><a class="btn btn_color_blue" href="matlab:openExample('matlab/EquilibrateOutputFormatExample')" data-ex-genre="Live Script">Open Live Script</a></div></div></div></div><script type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "DigitalDocument",
          "headline": "Specify Output Format",
          "description": "Create a 6-by-6 magic square matrix, and then use equilibrate to factor the matrix. By default, equilibrate returns the permutation and scaling factors as matrices.",
          "thumbnailURL": "../../includes/product/images/doc_center/DefaultImage.png",
          "genre": "Live Script",
          "isBasedOn": {
          "@type": "Product",
          "name": "MATLAB"

        },
          "isPartOf": {
          "@type": "CreativeWork",
          "url": "equilibrate.html"

        },
          "identifier": "matlab.EquilibrateOutputFormatExample",
          "name": "EquilibrateOutputFormatExample",
          "url": "equilibrate.html#mw_e161f7b4-15a3-44db-be34-05a2ac55557c"

        }</script><script type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "PropertyValue",
          "name": "open_command",
          "value": "matlab:openExample('matlab/EquilibrateOutputFormatExample')"

        }</script><script type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "ItemList",
          "name": "ExampleSourceFiles",

        "itemListElement":
        [
        "EquilibrateOutputFormatExample.mlx"
        ],
        "itemListOrder": "http://schema.org/ItemListOrderAscending"
        }
        </script><p class="shortdesc">Create a 6-by-6 magic square matrix, and then use <code class="literal">equilibrate</code> to factor the matrix. By default, <code class="literal">equilibrate</code> returns the permutation and scaling factors as matrices. </p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>A = magic(6)</pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>A = <span class="emphasis"><em>6×6</em></span>

    35     1     6    26    19    24
     3    32     7    21    23    25
    31     9     2    22    27    20
     8    28    33    17    10    15
    30     5    34    12    14    16
     4    36    29    13    18    11

</pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>[P,R,C] = equilibrate(A)</pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>P = <span class="emphasis"><em>6×6</em></span>

     0     0     0     0     1     0
     0     0     0     0     0     1
     0     0     0     1     0     0
     1     0     0     0     0     0
     0     0     1     0     0     0
     0     1     0     0     0     0

</pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>R = <span class="emphasis"><em>6×6</em></span>

    0.1852         0         0         0         0         0
         0    0.1749         0         0         0         0
         0         0    0.1909         0         0         0
         0         0         0    0.1588         0         0
         0         0         0         0    0.1793         0
         0         0         0         0         0    0.1966

</pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>C = <span class="emphasis"><em>6×6</em></span>

    0.1799         0         0         0         0         0
         0    0.1588         0         0         0         0
         0         0    0.1588         0         0         0
         0         0         0    0.2422         0         0
         0         0         0         0    0.2066         0
         0         0         0         0         0    0.2035

</pre></div></div></div><p>Construct the equilibrated matrix <code class="literal">Bmatrix</code> using the matrix factors <code class="literal">P</code>, <code class="literal">R</code>, and <code class="literal">C</code>.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>Bmatrix = R*P*A*C</pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>Bmatrix = <span class="emphasis"><em>6×6</em></span>

    1.0000    0.1471    1.0000    0.5385    0.5358    0.6031
    0.1259    1.0000    0.8056    0.5509    0.6506    0.3916
    0.2747    0.8485    1.0000    0.7859    0.3943    0.5825
    1.0000    0.0252    0.1513    1.0000    0.6233    0.7754
    1.0000    0.2562    0.0569    0.9553    1.0000    0.7295
    0.1061    0.9988    0.2185    1.0000    0.9341    1.0000

</pre></div></div></div><p>Now, specify the <code class="literal">"vector"</code> option to return the outputs as vectors. With large input matrices, returning the outputs as vectors can save memory and improve efficiency.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>[p,r,c] = equilibrate(A,<span style="color:#A020F0">"vector"</span>)</pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>p = <span class="emphasis"><em>6×1</em></span>

     5
     6
     4
     1
     3
     2

</pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>r = <span class="emphasis"><em>6×1</em></span>

    0.1852
    0.1749
    0.1909
    0.1588
    0.1793
    0.1966

</pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>c = <span class="emphasis"><em>6×1</em></span>

    0.1799
    0.1588
    0.1588
    0.2422
    0.2066
    0.2035

</pre></div></div></div><p>Construct the equilibrated matrix <code class="literal">Bvector</code> using the vector outputs <code class="literal">p</code>, <code class="literal">r</code>, and <code class="literal">c</code>.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>Bvector = r.*A(p,:).*c'</pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>Bvector = <span class="emphasis"><em>6×6</em></span>

    1.0000    0.1471    1.0000    0.5385    0.5358    0.6031
    0.1259    1.0000    0.8056    0.5509    0.6506    0.3916
    0.2747    0.8485    1.0000    0.7859    0.3943    0.5825
    1.0000    0.0252    0.1513    1.0000    0.6233    0.7754
    1.0000    0.2562    0.0569    0.9553    1.0000    0.7295
    0.1061    0.9988    0.2185    1.0000    0.9341    1.0000

</pre></div></div></div><p>Compare <code class="literal">Bvector</code> and <code class="literal">Bmatrix</code>. The result indicates they are equal.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>norm(Bmatrix - Bvector)</pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>ans = 
0
</pre></div></div></div><div class="procedure"></div></div></div></div></div><div itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage/Example" itemprop="example" class="em_example"><meta itemprop="exampleid" content="matlab-EquilibrateOutputFormatExample"><meta itemprop="exampletitle" content="Specify Output Format"></div></div></div></div><div class="ref_sect"><h2 id="mw_0921cdb9-bc57-4e83-8873-fc84e55fab32">Input Arguments</h2><div class="expandableContent"><p class="switch "><a href="javascript:void(0);" class="expandAllLink" data-allexpanded="true">collapse all</a></p><div class="mw_ws_accordion_container"><div class="accordion" id="mw_0921cdb9-bc57-4e83-8873-fc84e55fab32_accordion-group" role="tablist" aria-multiselectable="true"><div class="mw_ws_accordion_container"><div class="accordion" role="tablist" aria-multiselectable="true"><div class="accordion-item "><div itemscope="" itemprop="inputargument" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage/NamedInputArgument" itemid="mw_08af6237-4b36-4acf-aa52-2f6fd1838c1a"><div class="accordion-header"><button role="tab" data-bs-toggle="collapse" id="expand_accordion_heading_mw_08af6237-4b36-4acf-aa52-2f6fd1838c1a" data-bs-target="#expand_accordion_body_mw_08af6237-4b36-4acf-aa52-2f6fd1838c1a" aria-controls="expand_accordion_body_mw_08af6237-4b36-4acf-aa52-2f6fd1838c1a" class="accordion-button add_cursor_pointer" aria-expanded="true"><span id="inputarg_A" class="anchor_target"></span><h3 id="mw_08af6237-4b36-4acf-aa52-2f6fd1838c1a"><code itemprop="name">A</code> &#8212; <span itemprop="purpose">Input matrix</span><br/> <span class="add_font_color_general remove_bold"><span class="example_desc"><span itemprop="inputvalue">square matrix</span></span></span></h3></button></div><div role="tabpanel" id="expand_accordion_body_mw_08af6237-4b36-4acf-aa52-2f6fd1838c1a" aria-labelledby="expand_accordion_heading_mw_08af6237-4b36-4acf-aa52-2f6fd1838c1a" class="accordion-collapse collapse show"><div class="accordion-body"><div class="cshsummary" id="csh_mw_08af6237-4b36-4acf-aa52-2f6fd1838c1a"><p>Input matrix, specified as a square matrix. <code class="literal">A</code> can be dense or
            sparse, but must be structurally nonsingular, as determined by <a href="sprank.html"><code class="function">sprank</code></a>.</p><p>When <code class="literal">A</code> is sparse, the outputs <code class="literal">P</code>,
              <code class="literal">R</code>, and <code class="literal">C</code> are also sparse.</p></div><p class="datatypelist"><strong>Data Types: </strong><code itemprop="datatype">single</code> | <code itemprop="datatype">double</code><br/>
<strong>Complex Number Support: </strong>Yes</p></div></div></div></div></div></div><div class="mw_ws_accordion_container"><div class="accordion" role="tablist" aria-multiselectable="true"><div class="accordion-item "><div itemscope="" itemprop="inputargument" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage/NamedInputArgument" itemid="mw_4283378a-199c-4245-9168-0ef32cd1f591"><div class="accordion-header"><button role="tab" data-bs-toggle="collapse" id="expand_accordion_heading_mw_4283378a-199c-4245-9168-0ef32cd1f591" data-bs-target="#expand_accordion_body_mw_4283378a-199c-4245-9168-0ef32cd1f591" aria-controls="expand_accordion_body_mw_4283378a-199c-4245-9168-0ef32cd1f591" class="accordion-button add_cursor_pointer" aria-expanded="true"><span id="inputarg_outputForm" class="anchor_target"></span><h3 id="mw_4283378a-199c-4245-9168-0ef32cd1f591"><code itemprop="name">outputForm</code> &#8212; <span itemprop="purpose">Output format</span><br/> <span class="add_font_color_general remove_bold"><span class="example_desc"><span itemprop="inputvalue defaultvalue"><code class="literal">"matrix"</code></span> (default) | <span itemprop="inputvalue"><code class="literal">"vector"</code></span></span></span></h3></button></div><div role="tabpanel" id="expand_accordion_body_mw_4283378a-199c-4245-9168-0ef32cd1f591" aria-labelledby="expand_accordion_heading_mw_4283378a-199c-4245-9168-0ef32cd1f591" class="accordion-collapse collapse show"><div class="accordion-body"><div class="cshsummary" id="csh_mw_4283378a-199c-4245-9168-0ef32cd1f591"><p>Output format, specified as <code class="literal">"vector"</code> or
              <code class="literal">"matrix"</code>. This option allows you to specify whether the outputs
              <a href="#mw_deec5111-1d87-4af6-a55e-84b7f352363f" class="intrnllnk"><code class="argument">P</code></a>, <a href="#mw_ec0a0144-6fc6-46d6-9259-044dcd0974e9" class="intrnllnk"><code class="argument">R</code></a>, and <a href="#mw_9643eb0f-e1f6-43bf-8849-fef0cf59a991" class="intrnllnk"><code class="argument">C</code></a> are
            returned as column vectors or as matrices:</p><div class="itemizedlist"><ul><li><p><code class="literal">"matrix"</code> &#8212; <code class="argument">P</code>, <code class="argument">R</code>,
                and <code class="argument">C</code> are matrices such that <code class="literal">B =
                R*P*A*C</code>.</p></li><li><p><code class="literal">"vector"</code> &#8212; <code class="argument">P</code>, <code class="argument">R</code>,
                and <code class="argument">C</code> are column vectors such that <code class="literal">B =
                  R.*A(P,:).*C'</code>.</p></li></ul></div><p class="description_valueexample"><strong>Example: </strong><code class="literal">[P,R,C] = equilibrate(A,"vector")</code> returns
              <code class="literal">P</code>, <code class="literal">R</code>, and <code class="literal">C</code> as
            vectors.</p></div></div></div></div></div></div></div></div></div></div></div><div class="ref_sect"><h2 id="mw_84831898-e54f-4de4-b4d1-dd91212cc023">Output Arguments</h2><div class="expandableContent"><p class="switch "><a href="javascript:void(0);" class="expandAllLink" data-allexpanded="true">collapse all</a></p><div class="mw_ws_accordion_container"><div class="accordion" id="mw_84831898-e54f-4de4-b4d1-dd91212cc023_accordion-group" role="tablist" aria-multiselectable="true"><div class="mw_ws_accordion_container"><div class="accordion" role="tablist" aria-multiselectable="true"><div class="accordion-item "><div class="accordion-header"><button role="tab" data-bs-toggle="collapse" id="expand_accordion_heading_mw_deec5111-1d87-4af6-a55e-84b7f352363f" data-bs-target="#expand_accordion_body_mw_deec5111-1d87-4af6-a55e-84b7f352363f" aria-controls="expand_accordion_body_mw_deec5111-1d87-4af6-a55e-84b7f352363f" class="accordion-button add_cursor_pointer" aria-expanded="true"><span id="outputarg_P" class="anchor_target"></span><h3 id="mw_deec5111-1d87-4af6-a55e-84b7f352363f"><code class="name">P</code> &#8212; Permutation information<br/> <span class="add_font_color_general remove_bold"><span class="example_desc">matrix (default) | vector</span></span></h3></button></div><div role="tabpanel" id="expand_accordion_body_mw_deec5111-1d87-4af6-a55e-84b7f352363f" aria-labelledby="expand_accordion_heading_mw_deec5111-1d87-4af6-a55e-84b7f352363f" class="accordion-collapse collapse show"><div class="accordion-body"><div class="cshsummary" id="csh_mw_deec5111-1d87-4af6-a55e-84b7f352363f"><p>Permutation information, returned as a matrix or vector. <code class="literal">P*A</code> (or
              <code class="literal">A(P,:)</code> with the <code class="literal">"vector"</code> option) is the
            permutation of <code class="literal">A</code> that maximizes the absolute value of the product of
            its diagonal elements.</p></div></div></div></div></div></div><div class="mw_ws_accordion_container"><div class="accordion" role="tablist" aria-multiselectable="true"><div class="accordion-item "><div class="accordion-header"><button role="tab" data-bs-toggle="collapse" id="expand_accordion_heading_mw_ec0a0144-6fc6-46d6-9259-044dcd0974e9" data-bs-target="#expand_accordion_body_mw_ec0a0144-6fc6-46d6-9259-044dcd0974e9" aria-controls="expand_accordion_body_mw_ec0a0144-6fc6-46d6-9259-044dcd0974e9" class="accordion-button add_cursor_pointer" aria-expanded="true"><span id="outputarg_R" class="anchor_target"></span><h3 id="mw_ec0a0144-6fc6-46d6-9259-044dcd0974e9"><code class="name">R</code> &#8212; Row scaling<br/> <span class="add_font_color_general remove_bold"><span class="example_desc">diagonal matrix (default) | vector</span></span></h3></button></div><div role="tabpanel" id="expand_accordion_body_mw_ec0a0144-6fc6-46d6-9259-044dcd0974e9" aria-labelledby="expand_accordion_heading_mw_ec0a0144-6fc6-46d6-9259-044dcd0974e9" class="accordion-collapse collapse show"><div class="accordion-body"><div class="cshsummary" id="csh_mw_ec0a0144-6fc6-46d6-9259-044dcd0974e9"><p>Row scaling, returned as a diagonal matrix or vector. The nonzero entries in
              <code class="literal">R</code> and <code class="literal">C</code> are real and positive. </p></div></div></div></div></div></div><div class="mw_ws_accordion_container"><div class="accordion" role="tablist" aria-multiselectable="true"><div class="accordion-item "><div class="accordion-header"><button role="tab" data-bs-toggle="collapse" id="expand_accordion_heading_mw_9643eb0f-e1f6-43bf-8849-fef0cf59a991" data-bs-target="#expand_accordion_body_mw_9643eb0f-e1f6-43bf-8849-fef0cf59a991" aria-controls="expand_accordion_body_mw_9643eb0f-e1f6-43bf-8849-fef0cf59a991" class="accordion-button add_cursor_pointer" aria-expanded="true"><span id="outputarg_C" class="anchor_target"></span><h3 id="mw_9643eb0f-e1f6-43bf-8849-fef0cf59a991"><code class="name">C</code> &#8212; Column scaling<br/> <span class="add_font_color_general remove_bold"><span class="example_desc">diagonal matrix (default) | vector</span></span></h3></button></div><div role="tabpanel" id="expand_accordion_body_mw_9643eb0f-e1f6-43bf-8849-fef0cf59a991" aria-labelledby="expand_accordion_heading_mw_9643eb0f-e1f6-43bf-8849-fef0cf59a991" class="accordion-collapse collapse show"><div class="accordion-body"><div class="cshsummary" id="csh_mw_9643eb0f-e1f6-43bf-8849-fef0cf59a991"><p>Column scaling, returned as a diagonal matrix or vector. The nonzero entries in
              <code class="literal">R</code> and <code class="literal">C</code> are real and positive.</p></div></div></div></div></div></div></div></div></div></div><div class="moreabout ref_sect"><h2 id="mw_41bf507a-b3f2-4ee9-9880-4e587c9bd1fd">More About</h2><div class="expandableContent"><p class="switch"><a href="javascript:void(0);" class="expandAllLink" data-allexpanded="true2">collapse all</a></p><div class="mw_ws_accordion_container"><div class="accordion -presentation_expander -presentation_condensed"><div class="accordion-item"><div class="accordion-header"><button data-bs-toggle="collapse" data-bs-target="#expand_body_mw_beaf3b94-7114-4652-b483-a36c2acf7b94" aria-controls="expand_body_mw_beaf3b94-7114-4652-b483-a36c2acf7b94" class="accordion-button" aria-expanded="true"><h3 id="mw_beaf3b94-7114-4652-b483-a36c2acf7b94">Rescaling to Solve a Linear System</h3></button></div><div id="expand_body_mw_beaf3b94-7114-4652-b483-a36c2acf7b94" class="accordion-collapse collapsed collapse show"><div class="accordion-body"><p class="shortdesc">For linear system solutions <code class="literal">x = A\b</code>, the condition
        number of <code class="literal">A</code> is important for accuracy and efficiency of the calculation.
          <code class="function">equilibrate</code> can improve the condition number of <code class="literal">A</code>
        by rescaling the basis vectors. This effectively forms a new coordinate system that both
          <code class="literal">b</code> and <code class="literal">x</code> can be expressed in.</p><p><code class="function">equilibrate</code> is most useful when the scales of the
          <code class="literal">b</code> and <code class="literal">x</code> vectors in the original system <code class="literal">x =
          A\b</code> are irrelevant. However, if the scales of <code class="literal">b</code> and
          <code class="literal">x</code>
        <span class="emphasis"><em>are</em></span> relevant, then using <code class="function">equilibrate</code> to rescale
          <code class="literal">A</code> only for the linear system solve is not recommended. The obtained
        solution does not generally yield a small residual for the original system, even if
        expressed using the original basis vectors.</p></div></div></div></div></div></div></div><div class="bibliography"><h2 id="References">References</h2><div id="mw_474f3319-7748-49e5-8031-16792a9993ac" class="bibliomixed"><p>[1] Duff, I. S., and J. Koster. “On
      Algorithms For Permuting Large Entries to the Diagonal of a Sparse Matrix.” <span class="emphasis"><em>SIAM Journal on Matrix Analysis and Applications</em></span> 22, no. 4 (January
      2001): 973&#8211;96.</p></div></div><div class="ref_sect"><h2 id="refsect-extended-capabilities">Extended Capabilities</h2><div class="expandableContent"><p class="switch"><a href="javascript:void(0);" class="expandAllLink">expand all</a></p><div id="accordion_refsect-extended-capabilities" role="tablist" aria-multiselectable="true"><span id="mw_661d80f7-320d-4581-b881-2d74c6d0ebfc" class="anchor_target"></span><div class="mw_ws_accordion_container"><div class="accordion -presentation_expander -presentation_condensed"><div class="accordion-item"><span id="mw_7cd12e99-4052-4006-aafc-81199d0ad057" class="anchor_target"></span><div class="accordion-header"><button data-bs-toggle="collapse" data-bs-target="#expand_body_mw_7cd12e99-4052-4006-aafc-81199d0ad057_threadsupport" aria-controls="expand_body_mw_7cd12e99-4052-4006-aafc-81199d0ad057_threadsupport" class="accordion-button collapsed" aria-expanded="false"><h3 id="mw_7cd12e99-4052-4006-aafc-81199d0ad057_threadsupport">Thread-Based Environment<br/> <span class=" remove_bold add_font_color_general">Run code in the background using MATLAB&#174; <code class="function">backgroundPool</code> or accelerate code with Parallel Computing Toolbox&#8482; <code class="function">ThreadPool</code>.</span></h3></button></div><div id="expand_body_mw_7cd12e99-4052-4006-aafc-81199d0ad057_threadsupport" class="accordion-collapse collapsed collapse"><div class="accordion-body"><p>This function fully supports thread-based environments. For
                more information, see <a href="../matlab_prog/run-functions-on-threads.html" class="a">Run MATLAB Functions in Thread-Based Environment</a>.</p></div></div></div></div></div></div></div></div><div class="ref_sect"><h2 id="mw_d33b91eb-9494-4a70-ba4f-45579b670043">Version History</h2><strong>Introduced in R2019a</strong><div class="expandableContent"><p class="switch"><a href="javascript:void(0);" class="expandAllLink">expand all</a></p><div class="mw_ws_accordion_container"><div class="accordion -presentation_expander -presentation_condensed"><div class="accordion-item"><div class="accordion-header"><button data-bs-toggle="collapse" data-bs-target="#expand_body_mw_1e1b33f3-9bdf-4cf5-a6aa-f864d676bd74" aria-controls="expand_body_mw_1e1b33f3-9bdf-4cf5-a6aa-f864d676bd74" class="accordion-button collapsed" aria-expanded="false"><h3 id="mw_1e1b33f3-9bdf-4cf5-a6aa-f864d676bd74">R2022a: <span class="remove_bold">Specify output format</span></h3></button></div><div id="expand_body_mw_1e1b33f3-9bdf-4cf5-a6aa-f864d676bd74" class="accordion-collapse collapsed collapse"><div class="accordion-body"><p>Specify <code class="argument">outputForm</code> as <code class="literal">"vector"</code> or
          <code class="literal">"matrix"</code> to control whether <code class="function">equilibrate</code> returns
        the output arguments as vectors or matrices. For large factorizations, returning the outputs
        as vectors can save memory and improve efficiency.</p></div></div></div></div></div></div></div><div class="ref_sect"><h2 id="mw_7cd12e99-4052-4006-aafc-81199d0ad057_seealso">See Also</h2><p><span itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage/SeeAlso" itemprop="seealso"><a itemprop="url" href="matchpairs.html"><span itemprop="name"><code class="function">matchpairs</code></span></a></span> | <span itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage/SeeAlso" itemprop="seealso"><a itemprop="url" href="sprank.html"><span itemprop="name"><code class="function">sprank</code></span></a></span> | <span itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage/SeeAlso" itemprop="seealso"><a itemprop="url" href="ilu.html"><span itemprop="name"><code class="function">ilu</code></span></a></span> | <span itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage/SeeAlso" itemprop="seealso"><a itemprop="url" href="ichol.html"><span itemprop="name"><code class="function">ichol</code></span></a></span> | <span itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage/SeeAlso" itemprop="seealso"><a itemprop="url" href="balance.html"><span itemprop="name"><code class="function">balance</code></span></a></span> | <span itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage/SeeAlso" itemprop="seealso"><a itemprop="url" href="gmres.html"><span itemprop="name"><code class="function">gmres</code></span></a></span></p></div>
    </div></div></section><div xmlns="http://www.w3.org/1999/xhtml" class="clearfix"></div>
<div xmlns="http://www.w3.org/1999/xhtml" align="center" class="feedbackblock" id="mw_docsurvey"><script src="https://www.mathworks.com/help/docsurvey/docfeedback.js"></script>
<script>loadSurveyHidden();</script>
<link rel="stylesheet" href="https://www.mathworks.com/help/docsurvey/release/index-css.css" type="text/css">
<script src="https://www.mathworks.com/help/docsurvey/release/bundle.index.js"></script>

<script>initDocSurvey();</script></div></main>


</div>
</div>
</div>
</div><!--close_0960-->
<footer xmlns="http://www.w3.org/1999/xhtml" id="footer" class="bs-footer">
<div class="container-fluid">
<div class="footer">
<div class="row">
<div class="col-12">
<p class="copyright">© 1994-2025 The MathWorks, Inc.</p>
<ul class="footernav"><li class="footernav_help"><a href="matlab:web(matlab.internal.licenseAgreement)">Terms of Use</a></li><li class="footernav_patents"><a href="matlab:web([matlabroot '/patents.txt'])">Patents</a></li><li class="footernav_trademarks"><a href="matlab:web([matlabroot '/trademarks.txt'])">Trademarks</a></li><li class="footernav_piracy"><a href="matlab:web([docroot '/acknowledgments.html'])">Acknowledgments</a></li></ul></div>
</div>
</div>
</div>
</footer>
</div><!--close row-offcanvas-->
</div><!--close_0970-->
</body>
</html>
