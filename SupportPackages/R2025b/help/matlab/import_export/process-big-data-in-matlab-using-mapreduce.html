<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage">
<head>
<meta xmlns="http://www.w3.org/1999/xhtml" charset="utf-8">
<meta xmlns="http://www.w3.org/1999/xhtml" name="viewport" content="width=device-width, initial-scale=1.0">
<meta xmlns="http://www.w3.org/1999/xhtml" http-equiv="X-UA-Compatible" content="IE=edge">
<title>Analyze Big Data in MATLAB Using MapReduce</title>
<script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
      {
      "@context": "http://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement":
      [{
          "@type": "ListItem",
          "position": 1,

          "item": {
          "@id": "../index.html",
          "name": "MATLAB"
}

          } 
        ,
        {
          "@type": "ListItem",
          "position": 2,

          "item": {
          "@id": "../data-import-and-analysis.html",
          "name": "Data Import and Analysis"
}

          }
        ,
        {
          "@type": "ListItem",
          "position": 3,

          "item": {
          "@id": "../large-files-and-big-data.html",
          "name": "Large Files and Big Data"
}

          }
        ,
        {
          "@type": "ListItem",
          "position": 4,

          "item": {
          "@id": "../mapreduce.html",
          "name": "MapReduce"
}

          }]
      }</script><script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "ItemList",
          "name": "VisibleBreadcrumbs",

        "itemListElement":
        [
        "mapreduce"
        ],
        "itemListOrder": "http://schema.org/ItemListOrderAscending"
        }
        </script><script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "DigitalDocument",
          "headline": "Analyze Big Data in MATLAB Using MapReduce",
          "description": "Use the mapreduce function to process a large amount of file-based data. The MapReduce algorithm is a mainstay of many modern \"big data\" applications. This example operates on a single computer, but the code can scale up to use Hadoop&#174;.",
          "thumbnailURL": "../../examples/matlab/win64/AirlineMapReduceExample_01.png",
          "genre": "Live Script",
          "isBasedOn": {
          "@type": "Product",
          "name": "MATLAB"

        },
          "identifier": "matlab.AirlineMapReduceExample",
          "name": "AirlineMapReduceExample",
          "url": "process-big-data-in-matlab-using-mapreduce.html"

        }</script><script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "PropertyValue",
          "name": "open_command",
          "value": "matlab:openExample('matlab/AirlineMapReduceExample')"

        }</script><script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "ItemList",
          "name": "ExampleSourceFiles",

        "itemListElement":
        [
        "AirlineMapReduceExample.mlx",
        "airlineResults.mat",
        "airlinesmall.csv",
        "countFlightsMapper.m",
        "countFlightsReducer.m",
        "maxTimeMapper.m",
        "maxTimeReducer.m"
        ],
        "itemListOrder": "http://schema.org/ItemListOrderAscending"
        }
        </script><link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/bootstrap.min.css" rel="stylesheet" type="text/css">


  <meta xmlns="http://www.w3.org/1999/xhtml" http-equiv="Content-Script-Type" content="text/javascript">
<meta xmlns="http://www.w3.org/1999/xhtml" name="toctype" itemprop="pagetype" content="fe">
<meta xmlns="http://www.w3.org/1999/xhtml" name="infotype" itemprop="infotype" content="ex">

<meta xmlns="http://www.w3.org/1999/xhtml" name="description" itemprop="description" content="This example shows how to use the mapreduce function to process a large amount of file-based data."><meta xmlns="http://www.w3.org/1999/xhtml" content="../../examples/matlab/win64/AirlineMapReduceExample_01.png" itemprop="thumbnailUrl">
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/jquery/jquery-3.6.0.min.js"></script><script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/jquery/jquery-migrate.min.js"></script>
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6.css" rel="stylesheet" type="text/css">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_lg.css" rel="stylesheet" media="screen and (min-width: 1200px)">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_md.css" rel="stylesheet" media="screen and (min-width: 992px) and (max-width: 1199px)">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_sm+xs.css" rel="stylesheet" media="screen and (max-width: 991px)">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_sm.css" rel="stylesheet" media="screen and (min-width: 768px) and (max-width: 991px)">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_xs.css" rel="stylesheet" media="screen and (max-width: 767px)">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_offcanvas_v2.css" rel="stylesheet" type="text/css">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/shared/highlight/styles/mwdochighlight.min.css" rel="stylesheet" type="text/css">

<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/l10n.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/docscripts.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/f1help.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/docscripts.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/mw.imageanimation.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/jquery.highlight.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/underscore-min.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/use_platform_screenshots.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/suggest.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/overload.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/helpservices.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/productfilter.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/matlab_dialog_shared.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/highlight/highlight.min.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/localstorage.js"></script><script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/product_group.js"></script><script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/saxonjs/SaxonJS2.rt.js"></script><script xmlns="http://www.w3.org/1999/xhtml">
            window.history.replaceState(window.location.href, null, ""); // Initialize
            window.onload = function() {    
            mystylesheetLocation = "../../includes/shared/scripts/product_group-sef.json";
            mysourceLocation = "../../docset/docset.xml";
            product_help_location = "matlab";
            pagetype = "section";
            doccentertype = "product";
            langcode = "";
            getProductFilteredList(mystylesheetLocation, mysourceLocation, product_help_location, pagetype, doccentertype, langcode);  
            }
          </script>




<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/jquery/jquery.mobile.custom.min.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/bootstrap.bundle.min.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/global.js"></script>
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/doc_center_base.css" rel="stylesheet" type="text/css">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/doc_center_installed.css" rel="stylesheet" type="text/css">
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/doc_center_print.css" rel="stylesheet" type="text/css" media="print">
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/equationrenderer/release/MathRenderer.js"></script>
</head>
<body id="responsive_offcanvas">
<div xmlns="http://www.w3.org/1999/xhtml" id="doc_header_spacer" class="header"></div>
<div xmlns="http://www.w3.org/1999/xhtml" class="section_header level_3"><div class="container-fluid"><div class="row" id="mobile_search_row"><div class="col-sm-6 col-md-7 has_horizontal_local_nav" id="section_header_title"><div class="section_header_content"><div class="section_header_title"><h1><a href="../../documentation-center.html">Help Center</a></h1></div></div></div><div class="col-12 col-sm-6 col-md-5" id="mobile_search"><div class="search_nested_content_container"><form id="docsearch_form" name="docsearch_form" method="get" data-release="R2025b" data-language="en" action="../../templates/searchresults.html"><div class="input-group tokenized_search_field"><label class="visually-hidden form-label">Search Help</label><input type="text" class="form-control conjoined_search" autocomplete="off" name="qdoc" placeholder="Search Help" id="docsearch"> <div><button type="submit" name="submitsearch" id="submitsearch" class="btn icon-search btn_search_adjacent btn_search icon_16" tabindex="-1"></button></div></div></form></div><button class="btn icon-remove btn_search float-end icon_32 d-sm-none" data-bs-toggle="collapse" href="#mobile_search" aria-expanded="false" aria-controls="mobile_search"></button></div><div class="d-sm-none" id="search_actuator"><button class="btn icon-search btn_search float-end icon_16" data-bs-toggle="collapse" href="#mobile_search" aria-expanded="false" aria-controls="mobile_search"></button></div></div></div></div><div class="row-offcanvas row-offcanvas-left">
<div xmlns="http://www.w3.org/1999/xhtml" class="sidebar-offcanvas" id="sidebar">
<nav class="offcanvas_nav" role="navigation">
<div class="offcanvas_actuator" data-bs-toggle="offcanvas" data-bs-target="#sidebar" id="nav_toggle"><button type="button" class="btn"><span class="visually-hidden">Off-Canvas Navigation Menu Toggle
                  Off-Canvas Navigation Menu Toggle</span><span class="icon-menu"></span></button><span class="offcanvas_actuator_label" id="translation_icon-menu" tabindex="-1" aria-hidden="true"></span></div><div class="nav_list_wrapper" id="nav_list_wrapper"><nav class="offcanvas_nav" role="navigation"><ul class="nav_breadcrumb" id="ul_left_nav_ancestors"><li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../../documentation-center.html?s_tid=CRUX_lftnav" itemprop="url"><span itemprop="title">Documentation Home</span></a></li></ul>
<ul class="nav_disambiguation"><li><a href="../index.html?s_tid=CRUX_lftnav" id="index">MATLAB</a>
</li>
<li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../data-import-and-analysis.html?s_tid=CRUX_lftnav" itemprop="url"><span itemprop="title">Data Import and Analysis</span></a></li><li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../large-files-and-big-data.html?s_tid=CRUX_lftnav" itemprop="url"><span itemprop="title">Large Files and Big Data</span></a></li><li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../mapreduce.html?s_tid=CRUX_lftnav" itemprop="url" id="bugetb8-1"><span itemprop="title">MapReduce</span></a></li></ul><div class="search_refine_v4"><div id="facets_area"><ul class="nav_scrollspy nav list-unstyled" id="pnav">
<li class="nav_scrollspy_function nav-item"><a href="#responsive_offcanvas">Analyze Big Data in MATLAB Using MapReduce</a></li>
<li class="nav_scrollspy_title nav-item" id="SSPY810-section">On this page</li>
<!--ADD_REFENTRY_TITLE_HERE 11--><li class="nav-item"><a href="#AirlineMapReduceExample-1" class="nav-link intrnllnk">Introduction to Datastores</a></li><li class="nav-item"><a href="#AirlineMapReduceExample-2" class="nav-link intrnllnk">Scan for rows of interest</a></li><li class="nav-item"><a href="#AirlineMapReduceExample-3" class="nav-link intrnllnk">Introduction to mapreduce</a></li><li class="nav-item"><a href="#AirlineMapReduceExample-4" class="nav-link intrnllnk">Use mapreduce to perform a computation</a></li><li class="nav-item"><a href="#AirlineMapReduceExample-5" class="nav-link intrnllnk">Use of keys in mapreduce</a></li><li class="nav-item"><a href="#AirlineMapReduceExample-6" class="nav-link intrnllnk">Calculating group-wise metrics with mapreduce</a></li><li class="nav-item"><a href="#AirlineMapReduceExample-7" class="nav-link intrnllnk">Visualizing the results</a></li><li class="nav-item"><a href="#AirlineMapReduceExample-8" class="nav-link intrnllnk">Learning more</a></li><li class="nav-item"><a href="#d126e26026" class="nav-link intrnllnk">See Also</a></li></ul></div></div>
</nav></div></nav>
<script src="../../includes/product/scripts/offcanvas_v2.js"></script></div><!--END.CLASS sidebar-offcanvas-->
<div class="offcanvas_content_container">
<div xmlns="http://www.w3.org/1999/xhtml" class="sticky_header_container"><div class="horizontal_nav"><div class="horizontal_nav_container"><div class="offcanvas_horizontal_nav"><div class="container-fluid"><div class="row"><div class="col-sm-12 d-none d-sm-block"><nav class="navbar navbar-default" role="navigation" id="subnav"><div><ul class="nav navbar-nav crux_browse"><li id="crux_nav_documentation" class="crux_resource active">Documentation</li><li id="crux_nav_example" class="crux_resource"><a href="../examples.html?category=mapreduce&amp;s_tid=CRUX_topnav">Examples</a></li><li id="crux_nav_function" class="crux_resource"><a href="../referencelist.html?type=function&amp;category=mapreduce&amp;s_tid=CRUX_topnav">Functions</a></li><li id="crux_nav_app" class="crux_resource"><a href="../referencelist.html?type=app&amp;category=mapreduce&amp;s_tid=CRUX_topnav">Apps</a></li></ul></div></nav></div><div class="d-sm-none"><div class="container-fluid"><div class="row"><div class="col-9"><div class="mobile_crux_nav_trigger"><div class="btn-group"><button type="button" class="btn btn-default dropdown-toggle" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Resources</button><ul class="dropdown-menu"><li id="crux_nav_mobile_documentation" class="crux_resource active">Documentation</li><li id="crux_nav_mobile_example" class="crux_resource"><a href="../examples.html?category=mapreduce&amp;s_tid=CRUX_topnav">Examples</a></li><li id="crux_nav_mobile_function" class="crux_resource"><a href="../referencelist.html?type=function&amp;category=mapreduce&amp;s_tid=CRUX_topnav">Functions</a></li><li id="crux_nav_mobile_app" class="crux_resource"><a href="../referencelist.html?type=app&amp;category=mapreduce&amp;s_tid=CRUX_topnav">Apps</a></li></ul></div></div></div><div class="col-3"><div class="translate_placeholder"></div></div></div></div></div></div></div></div></div></div></div><div class="content_container" id="content_container" itemprop="content">
<div class="container-fluid">
<div class="row">
<div class="col-12">

<main id="skip_link_anchor" tabindex="-1">
<div xmlns="http://www.w3.org/1999/xhtml" id="product_info_alert"></div><section xmlns="http://www.w3.org/1999/xhtml" id="doc_center_content" lang="en" data-language="en"><div id="pgtype-example">
<section><div class="example_icon"></div><h1 class="r2025b" itemprop="title content" id="example-ex52301769">Analyze Big Data in MATLAB Using MapReduce</h1><div class="examples_short_list hidden_ios_android" data-products="ML"><div data-pane="metadata" class="card metadata_container"><div class="card-body metadata_content"><div class="d-grid"><a class="btn btn_color_blue" href="matlab:openExample('matlab/AirlineMapReduceExample')" data-ex-genre="Live Script">Open Live Script</a></div></div></div></div><div itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage/Example" itemprop="example" class="em_example"><meta itemprop="exampleid" content="matlab-AirlineMapReduceExample"><meta itemprop="exampletitle" content="Analyze Big Data in MATLAB Using MapReduce"></div><span id="AirlineMapReduceExample" class="anchor_target"></span><p class="shortdesc">This example shows how to use the <code class="literal">mapreduce</code> function to process a large amount of file-based data. The MapReduce algorithm is a mainstay of many modern "big data" applications. This example operates on a single computer, but the code can scale up to use Hadoop&#174;.</p><p>Throughout this example, the data set is a collection of records from the American Statistical Association for USA domestic airline flights between 1987 and 2008. If you have experimented with "big data" before, you may already be familiar with this data set. A small subset of this data set is included with MATLAB&#174; to allow you to run this and other examples.</p><div class="procedure"><h3 class="title" id="AirlineMapReduceExample-1">Introduction to Datastores</h3><p>Creating a datastore allows you to access a collection of data in a block-based manner. A datastore can process arbitrarily large amounts of data, and the data can even be spread across multiple files. You can create a datastore for many file types, including a collection of tabular text files (demonstrated here), a SQL database (Database Toolbox&#8482; required) or a Hadoop&#174; Distributed File System (HDFS&#8482;).</p><p>Create a datastore for a collection of tabular text files and preview the contents.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>ds = tabularTextDatastore(<span style="color:#A020F0">'airlinesmall.csv'</span>);
dsPreview = preview(ds);
dsPreview(:,10:15)</pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>ans=<span class="emphasis"><em>8×6 table</em></span>
    FlightNum    TailNum    ActualElapsedTime    CRSElapsedTime    AirTime    ArrDelay
    _________    _______    _________________    ______________    _______    ________

      1503       {'NA'}             53                 57          {'NA'}         8   
      1550       {'NA'}             63                 56          {'NA'}         8   
      1589       {'NA'}             83                 82          {'NA'}        21   
      1655       {'NA'}             59                 58          {'NA'}        13   
      1702       {'NA'}             77                 72          {'NA'}         4   
      1729       {'NA'}             61                 65          {'NA'}        59   
      1763       {'NA'}             84                 79          {'NA'}         3   
      1800       {'NA'}            155                143          {'NA'}        11   

</pre></div></div></div><p>The datastore automatically parses the input data and makes a best guess as to the type of data in each column. In this case, use the <code class="literal">'TreatAsMissing'</code> name-value pair argument to replace the missing values correctly. For numeric variables (such as <code class="literal">'AirTime'</code>), <code class="literal">tabularTextDatastore</code> replaces every instance of <code class="literal">'NA'</code> with a <code class="literal">NaN</code> value, which is the IEEE arithmetic representation for Not-a-Number.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>ds = tabularTextDatastore(<span style="color:#A020F0">'airlinesmall.csv'</span>, <span style="color:#A020F0">'TreatAsMissing'</span>, <span style="color:#A020F0">'NA'</span>);
ds.SelectedFormats{strcmp(ds.SelectedVariableNames, <span style="color:#A020F0">'TailNum'</span>)} = <span style="color:#A020F0">'%s'</span>;
ds.SelectedFormats{strcmp(ds.SelectedVariableNames, <span style="color:#A020F0">'CancellationCode'</span>)} = <span style="color:#A020F0">'%s'</span>;
dsPreview = preview(ds);
dsPreview(:,{<span style="color:#A020F0">'AirTime'</span>,<span style="color:#A020F0">'TaxiIn'</span>,<span style="color:#A020F0">'TailNum'</span>,<span style="color:#A020F0">'CancellationCode'</span>})</pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>ans=<span class="emphasis"><em>8×4 table</em></span>
    AirTime    TaxiIn    TailNum    CancellationCode
    _______    ______    _______    ________________

      NaN       NaN      {'NA'}          {'NA'}     
      NaN       NaN      {'NA'}          {'NA'}     
      NaN       NaN      {'NA'}          {'NA'}     
      NaN       NaN      {'NA'}          {'NA'}     
      NaN       NaN      {'NA'}          {'NA'}     
      NaN       NaN      {'NA'}          {'NA'}     
      NaN       NaN      {'NA'}          {'NA'}     
      NaN       NaN      {'NA'}          {'NA'}     

</pre></div></div></div><h3 class="title" id="AirlineMapReduceExample-2">Scan for rows of interest</h3><p>Datastore objects contain an internal pointer to keep track of which block of data the <code class="literal">read</code> function returns next. Use the <code class="literal">hasdata</code> and <code class="literal">read</code> functions to step through the entire data set, and filter the data set to only the rows of interest. In this case, the rows of interest are flights on United Airlines ("UA") departing from Boston ("BOS").</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>subset = [];

<span style="color:#0000FF">while</span> hasdata(ds)
    t = read(ds);
    t = t(strcmp(t.UniqueCarrier, <span style="color:#A020F0">'UA'</span>) &amp; strcmp(t.Origin, <span style="color:#A020F0">'BOS'</span>), :);
    subset = vertcat(subset, t);
<span style="color:#0000FF">end</span>

subset(1:10,[9,10,15:17])</pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>ans=<span class="emphasis"><em>10×5 table</em></span>
    UniqueCarrier    FlightNum    ArrDelay    DepDelay    Origin 
    _____________    _________    ________    ________    _______

       {'UA'}           121          -9           0       {'BOS'}
       {'UA'}          1021          -9          -1       {'BOS'}
       {'UA'}           519          15           8       {'BOS'}
       {'UA'}           354           9           8       {'BOS'}
       {'UA'}           701         -17           0       {'BOS'}
       {'UA'}           673          -9          -1       {'BOS'}
       {'UA'}            91          -3           2       {'BOS'}
       {'UA'}           335          18           4       {'BOS'}
       {'UA'}          1429           1          -2       {'BOS'}
       {'UA'}            53          52          13       {'BOS'}

</pre></div></div></div><h3 class="title" id="AirlineMapReduceExample-3">Introduction to <code class="literal">mapreduce</code></h3><p>MapReduce is an algorithmic technique to "divide and conquer" big data problems. In MATLAB,  <code class="literal">mapreduce</code> requires three input arguments:</p><div class="orderedlist"><ol style="list-style: decimal;"><li><p>A datastore to read data from</p></li><li><p>A "mapper" function that is given a subset of the data to operate on. The output of the map function is a partial calculation.  <code class="literal">mapreduce</code> calls the mapper function one time for each block in the datastore, with each call operating independently.</p></li><li><p>A "reducer" function that is given the aggregate outputs from the mapper function. The reducer function finishes the computation begun by the mapper function, and outputs the final answer.</p></li></ol></div><p>This is an over-simplification to some extent, since the output of a call to the mapper function can be shuffled and combined in interesting ways before being passed to the reducer function. This will be examined later in this example.</p><h3 class="title" id="AirlineMapReduceExample-4">Use <code class="literal">mapreduce</code> to perform a computation</h3><p>A simple use of <code class="literal">mapreduce</code> is to find the longest flight time in the entire airline data set. To do this:</p><div class="orderedlist"><ol style="list-style: decimal;"><li><p>The "mapper" function computes the maximum of each block from the datastore.</p></li><li><p>The "reducer" function then computes the maximum value among all of the maxima computed by the calls to the mapper function.</p></li></ol></div><p>First, reset the datastore and filter the variables to the one column of interest.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>reset(ds);
ds.SelectedVariableNames = {<span style="color:#A020F0">'ActualElapsedTime'</span>};</pre></div></div></div><p>Write the mapper function, <code class="literal">maxTimeMapper.m</code>. It takes three input arguments:</p><div class="orderedlist"><ol style="list-style: decimal;"><li><p>The input data, which is a table obtained by applying the <code class="literal">read</code> function to the datastore.</p></li><li><p>A collection of configuration and contextual information, <code class="literal">info</code>. This can be ignored in most cases, as it is here.</p></li><li><p>An intermediate data storage object, which records the results of the calculations from the mapper function. Use the <code class="literal">add</code> function to add Key/Value pairs to this intermediate output. In this example, the name of the key (<code class="literal">'MaxElapsedTime'</code>) is arbitrary.</p></li></ol></div><p>Save the following mapper function (<code class="literal">maxTimeMapper.m</code>) in your current folder.</p><div class="code_responsive"><pre id="d126e25896" class="programlisting"><span style="color:#0000FF">function</span> maxTimeMapper(data, ~, intermKVStore)
  maxElapsedTime = max(data{:,:});
  add(intermKVStore, <span style="color:#A020F0">"MaxElapsedTime"</span>, maxElapsedTime)
<span style="color:#0000FF">end</span>
</pre></div><p>Next, write the reducer function. It also takes three input arguments:</p><div class="orderedlist"><ol style="list-style: decimal;"><li><p>A set of input "keys". Keys will be discussed further below, but they can be ignored in some simple problems, as they are here.</p></li><li><p>An intermediate data input object that <code class="literal">mapreduce</code> passes to the reducer function. This data is in the form of Key/Value pairs, and you use the <code class="literal">hasnext</code> and <code class="literal">getnext</code> functions to iterate through the values for each key.</p></li><li><p>A final output data storage object. Use the <code class="literal">add</code> and <code class="literal">addmulti</code> functions to directly add Key/Value pairs to the output.</p></li></ol></div><p>Save the following reducer function (<code class="literal">maxTimeReducer.m</code>) in your current folder.</p><div class="code_responsive"><pre id="d126e25923" class="programlisting"><span style="color:#0000FF">function</span> maxTimeReducer(~, intermValsIter, outKVStore)
  maxElapsedTime = -Inf;
  <span style="color:#0000FF">while</span>(hasnext(intermValsIter))
    maxElapsedTime = max(maxElapsedTime, getnext(intermValsIter));
  <span style="color:#0000FF">end</span>
  add(outKVStore, <span style="color:#A020F0">"MaxElapsedTime"</span>, maxElapsedTime);
<span style="color:#0000FF">end</span>
</pre></div><p>Once the mapper and reducer functions are written and saved in your current folder, you can call <code class="literal">mapreduce</code> using the datastore, mapper function, and reducer function. If you have Parallel Computing Toolbox (PCT), MATLAB will automatically start a pool and parallelize execution. Use the <code class="literal">readall</code> function to display the results of the MapReduce algorithm.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>result = mapreduce(ds, @maxTimeMapper, @maxTimeReducer);</pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>********************************
*      MAPREDUCE PROGRESS      *
********************************
Map   0% Reduce   0%
Map  16% Reduce   0%
Map  32% Reduce   0%
Map  48% Reduce   0%
Map  65% Reduce   0%
Map  81% Reduce   0%
Map  97% Reduce   0%
Map 100% Reduce   0%
Map 100% Reduce 100%
</pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>readall(result)</pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>ans=<span class="emphasis"><em>1×2 table</em></span>
           Key             Value  
    __________________    ________

    {'MaxElaspedTime'}    {[1650]}

</pre></div></div></div><h3 class="title" id="AirlineMapReduceExample-5">Use of keys in <code class="literal">mapreduce</code></h3><p>The use of keys is an important and powerful feature of <code class="literal">mapreduce</code>. Each call to the mapper function adds intermediate results to one or more named "buckets", called keys. The number of calls to the mapper function by <code class="literal">mapreduce</code> corresponds to the number of blocks in the datastore.</p><p>If the mapper function adds values to multiple keys, this leads to multiple calls to the reducer function, with each call working on only one key's intermediate values. The <code class="literal">mapreduce</code> function automatically manages this data movement between the map and reduce phases of the algorithm.</p><p>This flexibility is useful in many contexts. The example below uses keys in a relatively obvious way for illustrative purposes.</p><h3 class="title" id="AirlineMapReduceExample-6">Calculating group-wise metrics with <code class="literal">mapreduce</code></h3><p>The behavior of the mapper function in this application is more complex. For every flight carrier found in the input data, use the <code class="literal">add</code> function to add a vector of values. This vector is a count of the number of flights for that carrier on each day in the 21+ years of data. The carrier code is the key for this vector of values. This ensures that all of the data for each carrier will be grouped together when <code class="literal">mapreduce</code> passes it to the reducer function.</p><p>Save the following mapper function (<code class="literal">countFlightsMapper.m</code>) in your current folder.</p><div class="code_responsive"><pre id="d126e25970" class="programlisting"><span style="color:#0000FF">function</span> countFlightsMapper(data, ~, intermKVStore)
  dayNumber = days((datetime(data.Year, data.Month, data.DayofMonth) - datetime(1987,10,1)))+1;
  daysSinceEpoch = days(datetime(2008,12,31) - datetime(1987,10,1))+1;
  [airlineName, ~, airlineIndex] = unique(data.UniqueCarrier, <span style="color:#A020F0">'stable'</span>);

  <span style="color:#0000FF">for</span> i = 1:numel(airlineName)
    dayTotals = accumarray(dayNumber(airlineIndex==i), 1, [daysSinceEpoch, 1]);
    add(intermKVStore, airlineName{i}, dayTotals);
  <span style="color:#0000FF">end</span>
<span style="color:#0000FF">end</span>
</pre></div><p>The reducer function is less complex. It simply iterates over the intermediate values and adds the vectors together. At completion, it outputs the values in this aggregate vector. Note that the reducer function does not need to sort or examine the <code class="literal">intermediateKeysIn</code> values; each call to the reducer function by <code class="literal">mapreduce</code> only passes the values for one airline carrier.</p><p>Save the following reducer function (<code class="literal">countFlightsReducer.m</code>) in your current folder.</p><div class="code_responsive"><pre id="d126e25982" class="programlisting"><span style="color:#0000FF">function</span> countFlightsReducer(intermKeysIn, intermValsIter, outKVStore)
  daysSinceEpoch = days(datetime(2008,12,31) - datetime(1987,10,1))+1;
  dayArray = zeros(daysSinceEpoch, 1);

  <span style="color:#0000FF">while</span> hasnext(intermValsIter)
    dayArray = dayArray + getnext(intermValsIter);
  <span style="color:#0000FF">end</span>
  add(outKVStore, intermKeysIn, dayArray);
<span style="color:#0000FF">end</span>
</pre></div><p>Reset the datastore and select the variables of interest. Once the mapper and reducer functions are written and saved in your current folder, you can call <code class="literal">mapreduce</code> using the datastore, mapper function, and reducer function.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>reset(ds);
ds.SelectedVariableNames = {<span style="color:#A020F0">'Year'</span>, <span style="color:#A020F0">'Month'</span>, <span style="color:#A020F0">'DayofMonth'</span>, <span style="color:#A020F0">'UniqueCarrier'</span>};
result = mapreduce(ds, @countFlightsMapper, @countFlightsReducer);</pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>********************************
*      MAPREDUCE PROGRESS      *
********************************
Map   0% Reduce   0%
Map  16% Reduce   0%
Map  32% Reduce   0%
Map  48% Reduce   0%
Map  65% Reduce   0%
Map  81% Reduce   0%
Map  97% Reduce   0%
Map 100% Reduce   0%
Map 100% Reduce  10%
Map 100% Reduce  21%
Map 100% Reduce  31%
Map 100% Reduce  41%
Map 100% Reduce  52%
Map 100% Reduce  62%
Map 100% Reduce  72%
Map 100% Reduce  83%
Map 100% Reduce  93%
Map 100% Reduce 100%
</pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>result = readall(result);</pre></div></div></div><p>In case this example was run with only the sample data set, load the results of the <code class="literal">mapreduce</code> algorithm run on the entire data set.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>load <span style="color:#A020F0">airlineResults</span></pre></div></div></div><h3 class="title" id="AirlineMapReduceExample-7">Visualizing the results</h3><p>Using only the top 7 carriers, smooth the data to remove the effects of weekend travel. This would otherwise clutter the visualization.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>lines = result.Value;
lines = horzcat(lines{:});
[~,sortOrder] = sort(sum(lines), <span style="color:#A020F0">'descend'</span>);
lines = lines(:,sortOrder(1:7));
result = result(sortOrder(1:7),:);

lines(lines==0) = nan;
lines = smoothdata(lines,<span style="color:#A020F0">'gaussian'</span>);</pre></div></div></div><p>Plot the data.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>figure(<span style="color:#A020F0">'Position'</span>,[1 1 800 600]);
plot(datetime(1987,10,1):caldays(1):datetime(2008,12,31),lines,<span style="color:#A020F0">'LineWidth'</span>,2)
title (<span style="color:#A020F0">'Domestic airline flights per day per carrier'</span>)
xlabel(<span style="color:#A020F0">'Date'</span>)
ylabel(<span style="color:#A020F0">'Flights per day'</span>)
legend(result.Key, <span style="color:#A020F0">'Location'</span>, <span style="color:#A020F0">'Best'</span>)</pre></div></div></div><div class="informalfigure"><div id="d126e26010" class="mediaobject"><p><img src="../../examples/matlab/win64/AirlineMapReduceExample_01.png" alt="Figure contains an axes object. The axes object with title Domestic airline flights per day per carrier, xlabel Date, ylabel Flights per day contains 7 objects of type line. These objects represent DL, WN, AA, US, UA, NW, CO." width="800"></p></div></div><p>The plot shows the emergence of Southwest Airlines (WN) during this time period.</p><h3 class="title" id="AirlineMapReduceExample-8">Learning more</h3><p>This example only scratches the surface of what is possible with <code class="literal">mapreduce</code>. See the documentation for <code class="literal">mapreduce</code> for more information, including information on using it with Hadoop and MATLAB&#174; Parallel Server&#8482;.</p></div>
      <h2 id="d126e26026">See Also</h2><p><span itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage/SeeAlso" itemprop="seealso"><a itemprop="url" href="../ref/mapreduce.html"><span itemprop="name"><code class="function">mapreduce</code></span></a></span> | <span itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage/SeeAlso" itemprop="seealso"><a itemprop="url" href="../ref/matlab.io.datastore.tabulartextdatastore.html"><span itemprop="name"><code class="function">tabularTextDatastore</code></span></a></span></p>
      <h3 id="d126e26035">Topics</h3><ul class="list-unstyled"><li><a href="getting-started-with-mapreduce.html" class="a">Getting Started with MapReduce</a></li></ul>
    </section>
    </div></section><div xmlns="http://www.w3.org/1999/xhtml" class="clearfix"></div>
<div xmlns="http://www.w3.org/1999/xhtml" align="center" class="feedbackblock" id="mw_docsurvey"><script src="https://www.mathworks.com/help/docsurvey/docfeedback.js"></script>
<script>loadSurveyHidden();</script>
<link rel="stylesheet" href="https://www.mathworks.com/help/docsurvey/release/index-css.css" type="text/css">
<script src="https://www.mathworks.com/help/docsurvey/release/bundle.index.js"></script>

<script>initDocSurvey();</script></div></main>


</div>
</div>
</div>
</div><!--close_0960-->
<footer xmlns="http://www.w3.org/1999/xhtml" id="footer" class="bs-footer">
<div class="container-fluid">
<div class="footer">
<div class="row">
<div class="col-12">
<p class="copyright">© 1994-2025 The MathWorks, Inc.</p>
<ul class="footernav"><li class="footernav_help"><a href="matlab:web(matlab.internal.licenseAgreement)">Terms of Use</a></li><li class="footernav_patents"><a href="matlab:web([matlabroot '/patents.txt'])">Patents</a></li><li class="footernav_trademarks"><a href="matlab:web([matlabroot '/trademarks.txt'])">Trademarks</a></li><li class="footernav_piracy"><a href="matlab:web([docroot '/acknowledgments.html'])">Acknowledgments</a></li></ul></div>
</div>
</div>
</div>
</footer>
</div><!--close row-offcanvas-->
</div><!--close_0970-->
</body>
</html>
